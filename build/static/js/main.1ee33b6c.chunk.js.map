{"version":3,"sources":["lib/db.ts","lib/theme.ts","lib/util.ts","actions/AppEventsActions.ts","actions/KanbanBoardActions.ts","dispatchers/AppEventsDispatcher.ts","lib/datetime.ts","data/initial-data.ts","states/KanbanBoardState.ts","actions/CalendarActions.ts","states/CalendarState.ts","states/AppEventsState.ts","store.ts","dispatchers/KanbanBoardDispatcher.ts","lib/gensym.ts","components/TextInputDialog.tsx","components/AppDrawer.tsx","components/ConfirmDialog.tsx","lib/csv.ts","components/KanbanDialog.tsx","views/KanbanBoardView.tsx","dispatchers/CalendarViewDispatcher.ts","views/CalendarView.tsx","lib/validation.ts","views/EditorView.tsx","views/SettingsView.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["dbBaseName","window","location","pathname","replace","PouchDB","plugin","PouchDBFind","require","remoteDb","rep","localDb","auto_compaction","localConfigDb","startSync","a","allDocs","localDocs","remoteDocs","idSet","Set","rows","doc","add","id","sync","live","retry","doc_ids","Array","from","values","on","change","info","err","restartSync","cancel","e","setRemoteDb","url","user","password","close","match","auth","username","getLocalDb","getLocalConfigDb","isDark","matchMedia","matches","theme","createMuiTheme","palette","type","primary","main","blue","secondary","pink","getCurrentView","history","currentView","startsWith","actionCreator","actionCreatorFactory","updateAppConfig","async","resetApplication","appEventsActions","showAlertDialog","closeAlertDialog","startUpdateAppConfig","started","doneUpdateAppConfig","done","failedUpdateAppConfig","failed","startResetApplication","doneResetApplication","failedResetApplication","addBoard","changeActiveBoard","updateBoardName","deleteBoard","addSticky","updateSticky","updateStickyLanes","archiveSticky","unarchiveSticky","deleteSticky","editBoardAndStickys","refreshActiveBoard","kanbanBoardActions","startAddBoard","doneAddBoard","failedAddBoard","startChangeActiveBoard","doneChangeActiveBoard","failedChangeActiveBoard","startUpdateBoardName","doneUpdateBoardName","failedUpdateBoardName","startDeleteBoard","doneDeleteBoard","failedDeleteBoard","startAddSticky","doneAddSticky","failedAddSticky","startUpdateSticky","doneUpdateSticky","failedUpdateSticky","startUpdateStickyLanes","doneUpdateStickyLanes","failedUpdateStickyLanes","startArchiveSticky","doneArchiveSticky","failedArchiveSticky","startUnarchiveSticky","doneUnarchiveSticky","failedUnarchiveSticky","startDeleteSticky","doneDeleteSticky","failedDeleteSticky","startEditBoardAndStickys","doneEditBoardAndStickys","failedEditBoardAndStickys","startRefreshActiveBoard","doneRefreshActiveBoard","failedRefreshActiveBoard","mapDispatchToProps","dispatch","v","boardId","mapStateToProps","appState","Object","assign","appEvents","formatDate","d","String","getFullYear","padStart","getMonth","getDate","parseISODate","s","m","Date","Number","boardNote","initialData","kanbanBoardReducer","getKanbanBoardReducer","db","resp","include_docs","length","data","bulkDocs","boards","map","x","postRespBoards","now","records","rec","dueDate","filter","taken","sort","b","name","toLocaleLowerCase","console","table","dup","i","log","i1","v1","push","key","boardIds","forEach","index","_id","remove","find","board","initialState","activeBoard","activeBoardId","activeBoardIndex","getKanbanBoardStateFromDb","state","get","selector","docs","Math","max","findIndex","slice","concat","reducerWithInitialState","case","payload","boardName","taskStatuses","teamOrStories","tags","displayBarcode","displayMemo","displayFlags","displayTags","preferArchive","boardStyle","calendarStyle","post","then","saved","_rev","rev","getConstructedAppStore","params","result","setTimeout","catch","error","open","title","message","singleButton","colorIsSecondary","onClose","arg","alert","newState","dbBoard","put","record","description","barcode","memo","flags","taskStatus","value","teamOrStory","kanbanId","taskStatusValue","teamOrStoryValue","recordsNew","recDb","recNew","calendarActions","showToday","showNextMonth","showPreviousMonth","showNextYear","showPreviousYear","calendarReducer","getCalendarReducer","activeMonth","appEventsReducer","getAppEventsReducer","confDb","defaultAppConfig","remote","endpointUrl","display","autoUpdate","autoUpdateInterval","alertDialog","appConfig","newConf","destroy","createHashHistory","hashType","store","getAppStore","createStore","combineReducers","connectRouter","router","kanbanBoard","calendar","compose","applyMiddleware","routerMiddleware","gensymSeed","gensym","TextInputDialog","props","useTheme","React","useState","setOpen","setValue","formDialogTitleId","handleCancelClick","Dialog","aria-labelledby","DialogTitle","DialogContent","DialogContentText","TextField","autoFocus","margin","label","fieldLabel","fullWidth","validator","onChange","event","target","DialogActions","Button","variant","color","onClick","style","marginLeft","spacing","cancelButtonCaption","disabled","applyButtonCaption","useStyles","makeStyles","drawer","width","flexShrink","whiteSpace","drawerOpen","transition","transitions","create","easing","sharp","duration","enteringScreen","drawerClose","leavingScreen","overflowX","breakpoints","up","nested","paddingLeft","withRouter","connect","classes","trim","apply","setTextInputOpen","textInputOpen","boardsOpen","setBoardsOpen","matchesPrint","useMediaQuery","handleChangeView","viewName","Drawer","className","clsx","paper","anchor","IconButton","Divider","List","component","subheader","ListSubheader","ListItem","button","Collapse","in","timeout","unmountOnExit","disablePadding","selected","fontWeight","ev","view","handleClickChangeActiveBoard","ListItemText","ListItemIcon","ConfirmDialog","inputValue","setInputValue","fab","textAlign","split","arr","confirmingTextValue","confirmingTextLabel","marginRight","marginBottom","$s","getStringParsers","rawToToken","rawToken","concatTokens","tokens","reduce","seq","cls","notCls","cat","repeat","end","first","combine","erase","trans","ahead","makeProgram","quoted","input","spaceWithinSingleLine","nakid","cell","row","newline","parse","z","parserInput","succeeded","Error","formatErrorMessage","formControl","minWidth","icon","fontSize","fabDelete","position","right","top","KanbanDialog","confirmOpen","setConfirmOpen","setDescription","setBarcode","setMemo","includes","join","setTags","setFlags","setDueDate","setTaskStatus","setTeamOrStory","taskStatusesId","teamOrStoryId","archived","onCancel","handleTagsChange","handleFlagsChange","paddingBottom","Typography","utils","DateFnsUtils","multiline","rowsMax","helperText","format","KeyboardButtonProps","date","FormControl","marginTop","InputLabel","htmlFor","Select","inputProps","MenuItem","caption","tagsTrimmed","tagsParsed","parseCsv","flagsTrimmed","flagsParsed","onApply","isNaN","getTime","Fab","size","aria-label","onUnarchive","onArchive","onDelete","DOMPurify","createDOMPurify","root","smallIcon","height","mapNeverStateToProps","firefox","navigator","userAgent","toLowerCase","indexOf","Sticky","today","expired","completed","data-record-id","draggable","onDragStart","dataTransfer","setData","matched","q","dangerouslySetInnerHTML","__html","sanitize","marked","Qr","fill","fillColor","cellSize","unit","toImgTag","Stickys","filtered","data-status","data-team-or-story","onDragOver","preventDefault","onDrop","elId","getData","el","document","getElementById","dataset","recordId","currentState","getState","align","cursor","textDecoration","padding","kanbanBoardState","flexGrow","backgroundColor","border","borderCollapse","tableLayout","calendarTitle","calendarTitleToolBar","left","overflow","calendarTopLeftHeader","calendarDaysHeader","calendarSundayHeader","calendarSaturdayHeader","calendarCell","verticalAlign","calendarWeekendCell","calendarCellCaptionToday","borderRadius","chip","textOverflow","paddingRight","chipWrap","CalendarItem","month","firstDateOfMonth","lastDateOfMonth","firstDateOfCal","getDay","lastDateOfCal","nextCalDate","dates","week","wd","stickys","toLocaleDateString","userLanguage","language","browserLanguage","year","next","toISOString","paddingTop","minHeight","pickEditableBoardProps","sticky","checkStyleXSS","text","validateBoardProps","isArray","validateStickyProps","header","codemirror","fabSave","confirmDeletingOpen","setConfirmDeletingOpen","editorValue","setEditorValue","editCount","setEditCount","jsYaml","safeLoad","safeDump","lineWidth","options","mode","lineNumbers","lineWrapping","editor","conf","confirmResetAppOpen","setConfirmResetAppOpen","goAround","validateConfigProps","app","callback","delay","savedCallback","useRef","useEffect","current","setInterval","clearInterval","useInterval","nextActiveBoardId","CssBaseline","ThemeProvider","path","exact","KanbanBoardView","CalendarView","EditorView","SettingsView","isLocalhost","Boolean","hostname","registerValidSW","swUrl","config","serviceWorker","register","registration","onupdatefound","installingWorker","installing","onstatechange","controller","onUpdate","onSuccess","ReactDOM","render","URL","process","href","origin","addEventListener","fetch","response","contentType","headers","status","ready","unregister","reload","checkValidServiceWorker"],"mappings":"qXAQMA,EAAaC,OAAOC,SAASC,SAASC,QAAQ,MAAO,KAE3DC,IAAQC,OAAOC,KACfF,IAAQC,OAAOE,EAAQ,MAEvB,IAAIC,EAAoC,KACpCC,EAA2C,KACzCC,EAAU,IAAIN,IAAJ,0BAA+BL,GAAc,CAAEY,iBAAiB,IAC1EC,EAAgB,IAAIR,IAAJ,iCAAsCL,GAAc,CAAEY,iBAAiB,I,SAG9EE,I,2EAAf,wDAAAC,EAAA,0DACQN,EADR,iCAEgCE,EAAQK,QAAQ,IAFhD,UAEcC,EAFd,QAG2BR,EAH3B,iCAG4CA,EAASO,QAAQ,IAH7D,gDAGmE,KAHnE,QAKQ,IAFME,EAHd,KAIcC,EAAQ,IAAIC,IAJ1B,6BAKQ,EAAkBH,EAAUI,KAA5B,+CAAWC,EAAuB,QAC9BH,EAAMI,IAAID,EAAIE,IAN1B,8OAQYN,EARZ,iBASY,IATZ,6BASY,EAAkBA,EAAWG,KAA7B,+CAAWC,EAAwB,QAC/BH,EAAMI,IAAID,EAAIE,IAV9B,0OAcQd,EAAMC,EAAQc,KAAKhB,EAAU,CACzBiB,MAAM,EACNC,OAAO,EACPC,QAASC,MAAMC,KAAKX,EAAMY,YAEzBC,GAAG,UAAU,SAAAC,OAGbD,GAAG,UAAU,SAAAE,OAGbF,GAAG,UAAiB,SAAAE,OAIpBF,GAAG,YAAY,SAAAE,OAGfF,GAAG,SAAS,SAAAG,OAhCzB,wG,sBAuCO,SAAeC,IAAtB,+B,4CAAO,sBAAArB,EAAA,sDACH,GAAIL,EAAK,CACL,IACIA,EAAI2B,SACN,MAAOC,IAGT5B,EAAM,KAPP,gBAUGI,IAVH,4C,sBAcA,SAAeyB,EAAtB,sC,4CAAO,WAA2BC,EAAaC,EAAcC,GAAtD,SAAA3B,EAAA,sDACH,GAAIL,EAAK,CACL,IACIA,EAAI2B,SACN,MAAOC,IAGT5B,EAAM,KAPP,IASCD,EATD,0CAWWA,EAASkC,QAXpB,6DAeClC,EAAW,KAfZ,YAkBC+B,IAAOA,EAAII,MAAM,gBAlBlB,wBAmBCnC,EAAW,IAAIJ,IAAQmC,EAAK,CACxBK,KAAM,CACFC,SAAUL,EACVC,SAAUA,KAtBnB,UA0BO5B,IA1BP,0D,sBA+BA,SAASiC,IACZ,OAAOpC,EAGJ,SAASqC,IACZ,OAAOnC,E,gFCnGEoC,EAAShD,OAAOiD,WAAW,gCAAgCC,QAE3DC,EAAQC,YAAe,CAChCC,QAASL,EAAS,CACdM,KAAM,OACNC,QAAS,CACLC,KAAMC,IAAK,MAEfC,UAAW,CACPF,KAAMG,IAAK,OAEf,CACAL,KAAM,QACNC,QAAS,CACLC,KAAMC,IAAK,MAEfC,UAAW,CACPF,KAAMG,IAAK,SClBhB,SAASC,EAAeC,GAC3B,IAAIC,EAAc,GAYlB,OAXID,EAAQ5D,SAASC,WACb2D,EAAQ5D,SAASC,SAAS6D,WAAW,YACrCD,EAAc,SACPD,EAAQ5D,SAASC,SAAS6D,WAAW,cAC5CD,EAAc,WACPD,EAAQ5D,SAASC,SAAS6D,WAAW,UAC5CD,EAAc,OACPD,EAAQ5D,SAASC,SAAS6D,WAAW,cAC5CD,EAAc,WAGfA,E,qBCULE,EAAgBC,MAGhBC,EACFF,EAAcG,MAAwC,6BACpDC,EACFJ,EAAcG,MAAmC,6BAGxCE,EAAmB,CAC5BC,gBAAiBN,EAAkC,6BACnDO,iBAAkBP,EAAoB,8BAEtCQ,qBAAsBN,EAAgBO,QACtCC,oBAAqBR,EAAgBS,KACrCC,sBAAuBV,EAAgBW,OAEvCC,sBAAuBV,EAAiBK,QACxCM,qBAAsBX,EAAiBO,KACvCK,uBAAwBZ,EAAiBS,QCCvCb,EAAgBC,MAGhBgB,EACFjB,EAAcG,MAAoD,qBAChEe,EACFlB,EAAcG,MAAkD,+BAC9DgB,EACFnB,EAAcG,MAAqE,6BACjFiB,EACFpB,EAAcG,MAAkD,wBAE9DkB,EACFrB,EAAcG,MAAmC,sBAC/CmB,EACFtB,EAAcG,MAA6C,yBACzDoB,EACFvB,EAAcG,MAAyD,+BACrEqB,EACFxB,EAAcG,MAAmD,0BAC/DsB,EACFzB,EAAcG,MAAmD,4BAC/DuB,GACF1B,EAAcG,MAAmD,yBAE/DwB,GACF3B,EAAcG,MAAkD,kCAE9DyB,GACF5B,EAAcG,MAAmC,gCAGxC0B,GAAqB,CAC9BC,cAAeb,EAASR,QACxBsB,aAAcd,EAASN,KACvBqB,eAAgBf,EAASJ,OAEzBoB,uBAAwBf,EAAkBT,QAC1CyB,sBAAuBhB,EAAkBP,KACzCwB,wBAAyBjB,EAAkBL,OAE3CuB,qBAAsBjB,EAAgBV,QACtC4B,oBAAqBlB,EAAgBR,KACrC2B,sBAAuBnB,EAAgBN,OAEvC0B,iBAAkBnB,EAAYX,QAC9B+B,gBAAiBpB,EAAYT,KAC7B8B,kBAAmBrB,EAAYP,OAE/B6B,eAAgBrB,EAAUZ,QAC1BkC,cAAetB,EAAUV,KACzBiC,gBAAiBvB,EAAUR,OAE3BgC,kBAAmBvB,EAAab,QAChCqC,iBAAkBxB,EAAaX,KAC/BoC,mBAAoBzB,EAAaT,OAEjCmC,uBAAwBzB,EAAkBd,QAC1CwC,sBAAuB1B,EAAkBZ,KACzCuC,wBAAyB3B,EAAkBV,OAE3CsC,mBAAoB3B,EAAcf,QAClC2C,kBAAmB5B,EAAcb,KACjC0C,oBAAqB7B,EAAcX,OAEnCyC,qBAAsB7B,EAAgBhB,QACtC8C,oBAAqB9B,EAAgBd,KACrC6C,sBAAuB/B,EAAgBZ,OAEvC4C,kBAAmB/B,GAAajB,QAChCiD,iBAAkBhC,GAAaf,KAC/BgD,mBAAoBjC,GAAab,OAEjC+C,yBAA0BjC,GAAoBlB,QAC9CoD,wBAAyBlC,GAAoBhB,KAC7CmD,0BAA2BnC,GAAoBd,OAE/CkD,wBAAyBnC,GAAmBnB,QAC5CuD,uBAAwBpC,GAAmBjB,KAC3CsD,yBAA0BrC,GAAmBf,QC9G1C,SAASqD,GAAmBC,GAC/B,MAAO,CACH7D,gBAAiB,SAAC8D,GAAD,OACbD,EAAS9D,EAAiBC,gBAAgB8D,KAC9C7D,iBAAkB,kBACd4D,EAAS9D,EAAiBE,qBAE9BL,gBAAiB,SAACkE,GAAD,OACbD,EAAS9D,EAAiBG,qBAAqB4D,KACnDhE,iBAAkB,kBACd+D,EAAS9D,EAAiBS,0BAG9BI,kBAAmB,SAACmD,GAAD,OACfF,EAAStC,GAAmBI,uBAAuB,CAAEoC,cACzDzC,mBAAoB,kBAChBuC,EAAStC,GAAmBkC,wBAAwB,OAKzD,SAASO,GAAgBC,GAC5B,OAAOC,OAAOC,OAAO,GAAIF,EAASG,W,2DCpC/B,SAASC,GAAWC,GACvB,MAAM,GAAN,OAAUC,OAAOD,EAAEE,eAAeC,SAAS,EAAG,KAA9C,YACIF,OAAOD,EAAEI,WAAa,GAAGD,SAAS,EAAG,KADzC,YAEIF,OAAOD,EAAEK,WAAWF,SAAS,EAAG,MAGjC,SAASG,GAAaC,GACzB,IAAMC,EAAID,EAAExG,MAAM,iEAClB,OAAIyG,EACO,IAAIC,KAAKC,OAAOF,EAAE,IAAKE,OAAOF,EAAE,IAAM,EAAGE,OAAOF,EAAE,KAElD,KCXR,IAuFMG,GAAS,sGAMTC,GAAc,CACvB,OAAU,CAAC,CACP,KAAQ,cACR,KAAQ,gBACR,aAAgB,CAAC,CACb,MAAS,UACT,QAAW,uBACX,UAAa,kBACd,CACC,MAAS,OACT,QAAW,oBACX,UAAa,eACd,CACC,MAAS,aACT,QAAW,oBACX,UAAa,qBACd,CACC,MAAS,UACT,QAAW,uBACX,UAAa,kBACd,CACC,MAAS,OACT,QAAW,oBACX,UAAa,cACb,WAAa,IAEjB,cAAiB,CAAC,CACd,MAAS,SACT,QAAW,sBACX,UAAa,wBACd,CACC,MAAS,SACT,QAAW,sBACX,UAAa,wBACd,CACC,MAAS,SACT,QAAW,sBACX,UAAa,yBAEjB,KAAQ,CAAC,CACL,MAAS,MACT,UAAa,WACd,CACC,MAAS,KACT,UAAa,UACd,CACC,MAAS,KACT,UAAa,UACd,CACC,MAAS,KACT,UAAa,UACd,CACC,MAAS,WACT,UAAa,gBACd,CACC,MAAS,UACT,UAAa,eACd,CACC,MAAS,SACT,UAAa,cACd,CACC,MAAS,WACT,UAAa,gBACd,CACC,MAAS,OACT,UAAa,YACd,CACC,MAAS,WACT,UAAa,gBACd,CACC,MAAS,MACT,UAAa,WACd,CACC,MAAS,SACT,UAAa,YACd,CACC,MAAS,eACT,UAAa,YACd,CACC,MAAS,qBACT,UAAa,aAEjB,gBAAkB,EAClB,aAAe,EACf,cAAgB,EAChB,aAAe,EACf,eAAiB,EACjB,WApLe,i+DAqLf,cAtGkB,qIAuGlB,UAAa,KAEjB,QAAW,IC7JXC,GAAyE,KAEtE,SAAeC,KAAtB,gC,8CAAO,sBAAA5I,EAAA,yDACE2I,GADF,yCAAA3I,EAAA,sFAAAA,EAAA,6DAEO6I,EAAK7G,IAGP8G,EAA2D,KALhE,SAOcD,EAAG5I,QAAQ,CACpB8I,cAAc,IARnB,UAW0B,KAJzBD,EAPD,QAWUxI,KAAK0I,OAXf,wBAYWC,EAA+BP,GAZ1C,SAckCG,EAAGK,SAAH,aACtBD,EAAKE,OAAOC,KAAI,SAAAC,GAAC,OAAI3B,OAAOC,OAAO,GAAI0B,EAAG,CAAEZ,mBAChD,IAhBR,OAmBK,IALMa,EAdX,OAkBWC,EAAM,IAAIhB,KAlBrB,6BAmBK,EAAkBU,EAAKO,QAAvB,gDAAWC,EAAqB,SACxBC,QAAU7B,GAAW0B,GACzBE,EAAIlC,QAAU+B,EAAe,GAAG7I,GArBzC,2PAuBWoI,EAAGK,SAAH,aACCD,EAAKO,SACT,IAzBR,yBA2BkBX,EAAG5I,QAAQ,CACpB8I,cAAc,IA5BvB,QA2BKD,EA3BL,eA4CC,IAZIK,EAA8BL,EAAKxI,KAClCqJ,QAAO,SAACN,GAAD,OAAYA,EAAE9I,KAAsB,gBAAf8I,EAAE9I,IAAIiC,QAClC4G,KAAI,SAACC,GAAkC,OAArBA,EAAE9I,IAAIqJ,OAAQ,EAAcP,EAAE9I,OAChDsJ,MAAK,SAAC7J,EAAQ8J,GAAT,OACF/B,OAAO/H,EAAE+J,MAAMC,qBAAuBjC,OAAO+B,EAAEC,MAAMC,oBAChDjC,OAAO/H,EAAE+J,QAAUhC,OAAO+B,EAAEC,MAAQ,EAAI,GAAM,KAG3DE,QAAQC,MAAM,aAAcf,GAGtBgB,EAAW,GACRC,EAAI,EAAGA,EAAIjB,EAAOH,SAAUoB,EAGjC,IAFI9C,EAAI6B,EAAOiB,GACfH,QAAQI,IAAI/C,GACHgD,EAAK,EAAGA,EAAKnB,EAAOH,SAAUsB,EAC/BC,EAAUpB,EAAOmB,GACjBF,IAAME,IACNL,QAAQI,IAAI,gBAAkB/C,EAAEyC,KAAOQ,EAAGR,MACtCzC,EAAEyC,OAASQ,EAAGR,OACdI,EAAI7C,EAAEyC,MAAQI,EAAI7C,EAAEyC,MAAQI,EAAI7C,EAAEyC,MAAQ,GACrCQ,EAAGX,QACJK,QAAQI,IAAI,SAAWE,EAAGR,MAC1BQ,EAAGX,OAAQ,IAEE,IAAbW,EAAGX,QACHK,QAAQI,IAAI,QAAUE,EAAGR,MACzBQ,EAAGX,OAAQ,EACXO,EAAI7C,EAAEyC,MAAMS,KAAKD,MASrC,IAAWE,KAHXR,QAAQC,MAAM,WAAYC,GAlE3B,WAqEYM,GACPR,QAAQC,MAAMO,EAAKN,EAAIM,IAEvB,IAAMC,EAAkB,GACxBP,EAAIM,GAAKE,SAAQ,SAACtB,EAAQuB,GACtBF,EAASF,KAAKnB,EAAEwB,KACF,IAAVD,GACA/B,EAAGiC,OAAOzB,MAGlBY,QAAQC,MAAM,MAAOQ,GAErB,IAjFL,eAiFcN,GAjFd,MAkFSH,QAAQC,MAAM,aAAcQ,EAASK,MAAK,SAAAtK,GAItC,OAHAwJ,QAAQI,IAAI5J,GACZwJ,QAAQI,IAAKvB,EAAKxI,KAAK8J,GAAG7J,IAAqBgH,SAC/C0C,QAAQI,IAAI,SACL5J,IAAQqI,EAAKxI,KAAK8J,GAAG7J,IAAqBgH,YAEjDuB,EAAKxI,KAAK8J,GAAG7J,KAAkC,YAA3B,UAAAuI,EAAKxI,KAAK8J,GAAG7J,WAAb,eAAkBiC,OACtCkI,EAASK,MAAK,SAAAtK,GAAE,OAAIA,IAAQqI,EAAKxI,KAAK8J,GAAG7J,IAAqBgH,aAC9D0C,QAAQC,MAAM,iBAAmBpB,EAAKxI,KAAK8J,GAAG7J,IAAqBgH,SAClEuB,EAAKxI,KAAK8J,GAAG7J,IAAqBgH,QAAUmD,EAAS,KAVrDN,EAAI,EAAGA,EAAItB,EAAKxI,KAAK0I,SAAUoB,EAAI,EAAnCA,IAZKD,EAAM,EAAbM,GAoCX,IAzGD,8CAyGYO,EAzGZ,QA0GWxB,EAA0BV,EAAKxI,KAChCqJ,QAAO,SAAAN,GAAC,OAAIA,EAAE9I,KAAsB,WAAf8I,EAAE9I,IAAIiC,MACvB6G,EAAE9I,IAAqBgH,UAAYyD,EAAMH,OAC7CzB,KAAI,SAAAC,GAAC,OAAIA,EAAE9I,OAChByK,EAAMxB,QAAUA,GALpB,EAAoBL,EAApB,+CAA6B,IAzG9B,2PAkHON,EAAGK,SACLJ,EAAKxI,KAAK8I,KAAI,SAACC,GAAD,OAAYA,EAAE9I,OAC1B,IApHP,QAsHC0J,QAAQC,MAAM,MAAOpB,EAAKxI,MAEpB2K,EAAiC,CACnCC,YAAa/B,EAAO,GACpBA,OAAQA,EACRgC,cAAehC,EAAO,GAAG0B,IACzBO,iBAAkB,GAGhBC,EA/HP,+BAAArL,EAAA,MA+HmC,WAAOsL,EAAyB/D,GAAhC,qBAAAvH,EAAA,sEACV6I,EAAG0C,IAAuBhE,EAAS,IADzB,UACxByD,EADwB,gDAGnBM,GAHmB,uBAKSzC,EAAGkC,KAAK,CAC3CS,SAAU,CACNhJ,KAAM,SACN+E,QAASyD,EAAMH,OARO,cAKxBrB,EALwB,OAU1BiC,KAEJT,EAAMxB,QAAUA,EACVoB,EAAQc,KAAKC,IAAI,EAAGL,EAAMnC,OAAOyC,WAAU,SAAAvC,GAAC,OAAIA,EAAEwB,MAAQG,EAAMH,QAChE1B,EAASmC,EAAMnC,OAAO0C,MAAM,EAAGjB,GAAOkB,OACxC,CAACd,GACDM,EAAMnC,OAAO0C,MAAMjB,EAAQ,IAhBD,kBAmBtBlD,OAAOC,OAAO,GAAI2D,EAAO,CAC7BnC,SACAgC,cAAeH,EAAMH,IACrBK,YAAaF,EACbI,iBAAkBR,KAvBQ,4CA/HnC,wDA0JCjC,GAAqBoD,mCAAwBd,GAExCe,KAAKjH,GAAmBC,eAAe,SAACsG,EAAOW,GAC5C,IAAMhD,EAA+BP,GAC/BsC,EAAqC,CACvCxI,KAAM,cACNuH,KAAMkC,EAAQC,UACdC,aAAclD,EAAKE,OAAO,GAAGgD,aAC7BC,cAAenD,EAAKE,OAAO,GAAGiD,cAC9BC,KAAMpD,EAAKE,OAAO,GAAGkD,KACrBC,eAAgBrD,EAAKE,OAAO,GAAGmD,eAC/BC,YAAatD,EAAKE,OAAO,GAAGoD,YAC5BC,aAAcvD,EAAKE,OAAO,GAAGqD,aAC7BC,YAAaxD,EAAKE,OAAO,GAAGsD,YAC5BC,cAAezD,EAAKE,OAAO,GAAGuD,cAC9BC,WAAY1D,EAAKE,OAAO,GAAGwD,WAC3BC,cAAe3D,EAAKE,OAAO,GAAGyD,cAC9BnE,UAAWQ,EAAKE,OAAO,GAAGV,WAiC9B,OA/BAI,EAAGgE,KAAK7B,EAAO,IACV8B,MAAK,SAAAxF,GACF,IAAMyF,EAA2B/B,EACjC+B,EAAMlC,IAAMvD,EAAE7G,GACdsM,EAAMC,KAAO1F,EAAE2F,IACfF,EAAMvD,QAAU,GAChB8B,EAAMnC,OAASmC,EAAMnC,OAAO2C,OAAO,CAACiB,IACpCG,KAAyB7F,SAAStC,GAAmBE,aAAa,CAC9DkI,OAAQlB,EACRmB,OAAQ1F,OAAOC,OAAO,GAAI2D,EAAO,CAAEH,cAAe7D,EAAE7G,GAAIyK,YAAa6B,OAEzEM,YAAW,WACPH,KAAyB7F,SAASmD,aAAK,WAAD,OAAYlD,EAAE7G,QACrD,OAEN6M,OAAM,SAAAlM,GACH8L,KAAyB7F,SAAStC,GAAmBG,eAAe,CAChEiI,OAAQlB,EACRsB,MAAOnM,KAEXiM,YAAW,WACPH,KAAyB7F,SAAS9D,EAAiBC,gBAAgB,CAC/DgK,MAAM,EACNC,MAAO,QACPC,QAAS,wBAA0BtM,EAAIsM,QACvCC,cAAc,EACdC,kBAAkB,EAClBC,QAAS,kBAAMX,KAAyB7F,SAAS9D,EAAiBE,0BAEvE,OAEJ6H,KAEVU,KAAKjH,GAAmBE,cAAc,SAACqG,EAAOwC,GAS3C,OARAT,YAAW,WACPhM,IACKyL,MAAK,eAEHQ,OAAM,SAAAlM,GACL2M,MAAM3M,EAAIsM,cAEnB,MACII,EAAIV,UAEdpB,KAAKjH,GAAmBG,gBAAgB,SAACoG,EAAOwC,GAC7C,OAAOxC,KAIVU,KAAKjH,GAAmBI,wBAAwB,SAACmG,EAAOW,GA+BrD,OA9BA,sBAAC,4BAAAjM,EAAA,+EAE8BqL,EAA0BC,EAAOW,EAAQ1E,SAFvE,OAEayG,EAFb,OAIOd,KAAyB7F,SAAStC,GAAmBK,sBAAsB,CACvE+H,OAAQlB,EACRmB,OAAQY,KANnB,gDASOd,KAAyB7F,SAAStC,GAAmBM,wBAAwB,CACzE8H,OAAQlB,EACRsB,MAAM,EAAD,MAETF,YAAW,WACPH,KAAyB7F,SAAS9D,EAAiBC,gBAAgB,CAC/DgK,MAAM,EACNC,MAAO,QACPC,QAAS,kCAAoC,KAAEA,QAC/CC,cAAc,EACdC,kBAAkB,EAClBC,QAAS,WACLX,KAAyB7F,SAAS9D,EAAiBE,oBACnD4J,YAAW,WACPH,KAAyB7F,SAASmD,aAAK,eACxC,WAGZ,IA3BV,wDAAD,GA8BOc,KAEVU,KAAKjH,GAAmBK,uBAAuB,SAACkG,EAAOwC,GACpD,OAAOA,EAAIV,UAEdpB,KAAKjH,GAAmBM,yBAAyB,SAACiG,EAAOwC,GACtD,OAAOxC,KAIVU,KAAKjH,GAAmBO,sBAAsB,SAACgG,EAAOW,GAuDnD,OAtDA,sBAAC,wCAAAjM,EAAA,+EAE6B6I,EAAG0C,IAAuBU,EAAQ1E,SAF/D,UAEa0G,EAFb,gDAIkB3C,GAJlB,uBAM8CzC,EAAGkC,KAAK,CAC3CS,SAAU,CACNhJ,KAAM,SACN+E,QAAS0G,EAAQpD,OAThC,cAMarB,EANb,OAWWiC,KAEEvK,EAASwG,OAAOC,OAAO,GAAIsG,EAAS,CAAElE,KAAMkC,EAAQC,YAbjE,UAc2BrD,EAAGqF,IAAIhN,EAAQ,IAd1C,QAca6L,EAdb,OAgBO7L,EAAOsI,QAAUA,EACjBtI,EAAO2J,IAAMkC,EAAMtM,GACnBS,EAAO8L,KAAOD,EAAME,IAEdrC,EAAQU,EAAMnC,OAAOyC,WAAU,SAAAvC,GAAC,OAAIA,EAAEwB,MAAQoB,EAAQ1E,WACtDyD,EAAQtD,OAAOC,OAAO,GAAI2D,EAAMnC,OAAOyB,IAAU,GAAI1J,GAErDiI,EAASyB,GAAS,EACpBU,EAAMnC,OAAO0C,MAAM,EAAGjB,GAAOkB,OACzB,CAACd,GACDM,EAAMnC,OAAO0C,MAAMjB,EAAQ,IAC3BU,EAAMnC,OAEd+D,KAAyB7F,SAAStC,GAAmBQ,oBAAoB,CACrE4H,OAAQlB,EACRmB,OAAQ1F,OAAOC,OAAO,GAAI2D,EAAO,CAC7BnC,SACAgC,cAAeH,EAAMH,IACrBK,YAAaF,OAlC5B,kDAsCOkC,KAAyB7F,SAAStC,GAAmBS,sBAAsB,CACvE2H,OAAQlB,EACRsB,MAAM,EAAD,MAETF,YAAW,WACPH,KAAyB7F,SAAS9D,EAAiBC,gBAAgB,CAC/DgK,MAAM,EACNC,MAAO,QACPC,QAAS,gCAAkC,KAAEA,QAC7CC,cAAc,EACdC,kBAAkB,EAClBC,QAAS,kBAAMX,KAAyB7F,SAAS9D,EAAiBE,0BAEvE,IAnDV,yDAAD,GAsDO6H,KAEVU,KAAKjH,GAAmBQ,qBAAqB,SAAC+F,EAAOwC,GAClD,OAAOA,EAAIV,UAEdpB,KAAKjH,GAAmBS,uBAAuB,SAAC8F,EAAOwC,GACpD,OAAOxC,KAIVU,KAAKjH,GAAmBU,kBAAkB,SAAC6F,EAAOW,GA2E/C,OA1EA,sBAAC,kDAAAjM,EAAA,oEAEWsL,EAAMnC,OAAOH,QAAU,GAFlC,yCAGkBsC,GAHlB,uBAK6BzC,EAAG0C,IAAyBU,EAAQ1E,SALjE,UAKa0G,EALb,gDAOkB3C,GAPlB,wBAU8CzC,EAAGkC,KAAK,CAC3CS,SAAU,CACNhJ,KAAM,SACN+E,QAAS0E,EAAQ1E,WAbhC,QAUaiC,EAVb,OAeWiC,KAfX,+BAiB4BjC,EAjB5B,0EAiBkB2E,EAjBlB,kBAkBiBtF,EAAGiC,OAAOqD,EAAQ,IAlBnC,gSAqBatF,EAAGiC,OAAOmD,EAAS,IArBhC,eAuBa9C,EAAgBG,EAAMH,gBAAkBc,EAAQ1E,QAClD+D,EAAMnC,OAAO,GAAG0B,IAAMS,EAAMH,cAxBvC,UAyB8BE,EAA0BC,EAAOH,GAzB/D,QAyBa6C,EAzBb,OA2BapD,EAAQoD,EAAS7E,OAAOyC,WAAU,SAAAvC,GAAC,OAAIA,EAAEwB,MAAQoB,EAAQ1E,WAEzD4B,EAASyB,GAAS,EACpBoD,EAAS7E,OAAO0C,MAAM,EAAGjB,GAAOkB,OAC5BkC,EAAS7E,OAAO0C,MAAMjB,EAAQ,IAC9BoD,EAAS7E,OAEjBkE,YAAW,WACPH,KAAyB7F,SAAStC,GAAmBW,gBAAgB,CACjEyH,OAAQlB,EACRmB,OAAQ1F,OAAOC,OAAO,GAAI2D,EAAO,CAC7BnC,SACAgC,gBACAD,YAAa8C,EAAS9C,YACtBE,iBAAkB4C,EAAS7E,OAAOyC,WAAU,SAAAvC,GAAC,OAAIA,EAAEwB,MAAQM,UAGnEkC,YAAW,WACPH,KAAyB7F,SAASmD,aAAK,WAAD,OAAYW,KAClDkC,YAAW,WACPH,KAAyB7F,SAAS9D,EAAiBC,gBAAgB,CAC/DgK,MAAM,EACNC,MAAO,OACPC,QAAS,gCACTC,cAAc,EACdE,QAAS,kBAAMX,KAAyB7F,SAAS9D,EAAiBE,0BAEvE,MACJ,MACJ,IAxDV,kDA0DOyJ,KAAyB7F,SAAStC,GAAmBY,kBAAkB,CACnEwH,OAAQlB,EACRsB,MAAM,EAAD,MAETF,YAAW,WACPH,KAAyB7F,SAAS9D,EAAiBC,gBAAgB,CAC/DgK,MAAM,EACNC,MAAO,QACPC,QAAS,2BAA6B,KAAEA,QACxCC,cAAc,EACdC,kBAAkB,EAClBC,QAAS,kBAAMX,KAAyB7F,SAAS9D,EAAiBE,0BAEvE,IAvEV,mFAAD,GA0EO6H,KAEVU,KAAKjH,GAAmBW,iBAAiB,SAAC4F,EAAOwC,GAC9C,OAAOA,EAAIV,UAEdpB,KAAKjH,GAAmBY,mBAAmB,SAAC2F,EAAOwC,GAChD,OAAOxC,KAIVU,KAAKjH,GAAmBa,gBAAgB,SAAC0F,EAAOW,GAC7C,IAAM1C,EAAM,IAAIhB,KAGVrH,EAAuB,CACzBsB,KAAM,SACNkH,QAAS7B,GAJC,IAAIU,KAAKgB,EAAIvB,cAAeuB,EAAIrB,WAAYqB,EAAIpB,YAK1DiG,YAAa,aACbC,QAAS,GACTC,KAAM,GACNC,MAAO,GACPlC,KAAM,GACN9E,QAAS+D,EAAMH,cACfqD,WAAYlD,EAAMJ,YAAYiB,aAAa,GAAGsC,MAC9CC,YAAapD,EAAMJ,YAAYkB,cAAc,GAAGqC,OAG9CjF,EAAU8B,EAAMJ,YAAY1B,QAAQsC,OAAO,CAAC5K,IAC5CgK,EAAcxD,OAAOC,OAAO,GAAI2D,EAAMJ,YAAa,CAAE1B,YA4B3D,OA1BAX,EAAGgE,KAAK3L,EAAQ,IACX4L,MAAK,SAAAxF,GACFpG,EAAO2J,IAAMvD,EAAE7G,GACfS,EAAO8L,KAAO1F,EAAE2F,IAChBC,KAAyB7F,SAAStC,GAAmBc,cAAc,CAC/DsH,OAAQlB,EACRmB,OAAQ1F,OAAOC,OAAO,GAAI2D,EAAO,CAAEJ,sBAG1CoC,OAAM,SAAAlM,GACH8L,KAAyB7F,SAAStC,GAAmBe,gBAAgB,CACjEqH,OAAQlB,EACRsB,MAAOnM,KAEXiM,YAAW,WACPH,KAAyB7F,SAAS9D,EAAiBC,gBAAgB,CAC/DgK,MAAM,EACNC,MAAO,QACPC,QAAS,yBAA2BtM,EAAIsM,QACxCC,cAAc,EACdC,kBAAkB,EAClBC,QAAS,kBAAMX,KAAyB7F,SAAS9D,EAAiBE,0BAEvE,OAGJ6H,KAEVU,KAAKjH,GAAmBc,eAAe,SAACyF,EAAOwC,GAS5C,OARAT,YAAW,WACPhM,IACKyL,MAAK,eAEHQ,OAAM,SAAAlM,GACL2M,MAAM3M,EAAIsM,cAEnB,MACII,EAAIV,UAEdpB,KAAKjH,GAAmBe,iBAAiB,SAACwF,EAAOwC,GAC9C,OAAOxC,KAIVU,KAAKjH,GAAmBgB,mBAAmB,SAACuF,EAAOW,GAChD,IAAMrB,EAAQU,EAAMJ,YAAY1B,QAAQoC,WAAU,SAAAvC,GAAC,OAAIA,EAAEwB,MAAQoB,EAAQpB,OACzE,GAAID,EAAQ,EACR,OAAOU,EAGX,IAAMpK,EAASwG,OAAOC,OAAO,GAAI2D,EAAMJ,YAAY1B,QAAQoB,GAAQ,CAC/DlB,QAASuC,EAAQvC,QACjB0E,YAAanC,EAAQmC,YACrBC,QAASpC,EAAQoC,QACjBC,KAAMrC,EAAQqC,KACdjC,KAAMJ,EAAQI,KACdkC,MAAOtC,EAAQsC,MACfC,WAAYvC,EAAQuC,WACpBE,YAAazC,EAAQyC,cAGnBlF,EAAU8B,EAAMJ,YAAY1B,QAAQqC,MAAM,EAAGjB,GAAOkB,OACtD,CAAC5K,GACDoK,EAAMJ,YAAY1B,QAAQqC,MAAMjB,EAAQ,IAEtCM,EAAcxD,OAAOC,OAAO,GAAI2D,EAAMJ,YAAa,CAAE1B,YA4B3D,OA1BAX,EAAGqF,IAAIhN,EAAQ,IACV4L,MAAK,SAAAxF,GACFpG,EAAO2J,IAAMvD,EAAE7G,GACfS,EAAO8L,KAAO1F,EAAE2F,IAChBC,KAAyB7F,SAAStC,GAAmBiB,iBAAiB,CAClEmH,OAAQlB,EACRmB,OAAQ1F,OAAOC,OAAO,GAAI2D,EAAO,CAAEJ,sBAG1CoC,OAAM,SAAAlM,GACH8L,KAAyB7F,SAAStC,GAAmBkB,mBAAmB,CACpEkH,OAAQlB,EACRsB,MAAOnM,KAEXiM,YAAW,WACPH,KAAyB7F,SAAS9D,EAAiBC,gBAAgB,CAC/DgK,MAAM,EACNC,MAAO,QACPC,QAAS,8BAAgCtM,EAAIsM,QAC7CC,cAAc,EACdC,kBAAkB,EAClBC,QAAS,kBAAMX,KAAyB7F,SAAS9D,EAAiBE,0BAEvE,OAGJ6H,KAEVU,KAAKjH,GAAmBiB,kBAAkB,SAACsF,EAAOwC,GAC/C,OAAOA,EAAIV,UAEdpB,KAAKjH,GAAmBkB,oBAAoB,SAACqF,EAAOwC,GACjD,OAAOxC,KAIVU,KAAKjH,GAAmBmB,wBAAwB,SAACoF,EAAOW,GACrD,IAAMrB,EAAQU,EAAMJ,YAAY1B,QAAQoC,WAAU,SAAAvC,GAAC,OAAIA,EAAEwB,MAAQoB,EAAQ0C,YACzE,GAAI/D,EAAQ,EACR,OAAOU,EAGX,IAAMpK,EAASwG,OAAOC,OAAO,GAAI2D,EAAMJ,YAAY1B,QAAQoB,GAAQ,CAC/D4D,WAAYvC,EAAQ2C,gBACpBF,YAAazC,EAAQ4C,mBAGnBrF,EAAU8B,EAAMJ,YAAY1B,QAAQqC,MAAM,EAAGjB,GAAOkB,OACtD,CAAC5K,GACDoK,EAAMJ,YAAY1B,QAAQqC,MAAMjB,EAAQ,IAEtCM,EAAcxD,OAAOC,OAAO,GAAI2D,EAAMJ,YAAa,CAAE1B,YA4B3D,OA1BAX,EAAGqF,IAAIhN,EAAQ,IACV4L,MAAK,SAAAxF,GACFpG,EAAO2J,IAAMvD,EAAE7G,GACfS,EAAO8L,KAAO1F,EAAE2F,IAChBC,KAAyB7F,SAAStC,GAAmBoB,sBAAsB,CACvEgH,OAAQlB,EACRmB,OAAQ1F,OAAOC,OAAO,GAAI2D,EAAO,CAAEJ,sBAG1CoC,OAAM,SAAAlM,GACH8L,KAAyB7F,SAAStC,GAAmBqB,wBAAwB,CACzE+G,OAAQlB,EACRsB,MAAOnM,KAEXiM,YAAW,WACPH,KAAyB7F,SAAS9D,EAAiBC,gBAAgB,CAC/DgK,MAAM,EACNC,MAAO,QACPC,QAAS,8BAAgCtM,EAAIsM,QAC7CC,cAAc,EACdC,kBAAkB,EAClBC,QAAS,kBAAMX,KAAyB7F,SAAS9D,EAAiBE,0BAEvE,OAGJ6H,KAEVU,KAAKjH,GAAmBoB,uBAAuB,SAACmF,EAAOwC,GACpD,OAAOA,EAAIV,UAEdpB,KAAKjH,GAAmBqB,yBAAyB,SAACkF,EAAOwC,GACtD,OAAOxC,KAIVU,KAAKjH,GAAmBsB,oBAAoB,SAACiF,EAAOW,GACjD,IAAMrB,EAAQU,EAAMJ,YAAY1B,QAAQoC,WAAU,SAAAvC,GAAC,OAAIA,EAAEwB,MAAQoB,EAAQ0C,YACzE,GAAI/D,EAAQ,EACR,OAAOU,EAGX,IAAMpK,EAASwG,OAAOC,OAAO,GAAI2D,EAAMJ,YAAY1B,QAAQoB,IAC3D1J,EAAOqN,OAASrN,EAAOqN,OAAS,IAAI5E,QAAO,SAAAN,GAAC,MAAU,aAANA,KAChDnI,EAAOqN,MAAM/D,KAAK,YAElB,IAAMhB,EAAU8B,EAAMJ,YAAY1B,QAAQqC,MAAM,EAAGjB,GAAOkB,OACtD,CAAC5K,GACDoK,EAAMJ,YAAY1B,QAAQqC,MAAMjB,EAAQ,IAEtCM,EAAcxD,OAAOC,OAAO,GAAI2D,EAAMJ,YAAa,CAAE1B,YA4B3D,OA1BAX,EAAGqF,IAAIhN,EAAQ,IACV4L,MAAK,SAAAxF,GACFpG,EAAO2J,IAAMvD,EAAE7G,GACfS,EAAO8L,KAAO1F,EAAE2F,IAChBC,KAAyB7F,SAAStC,GAAmBuB,kBAAkB,CACnE6G,OAAQlB,EACRmB,OAAQ1F,OAAOC,OAAO,GAAI2D,EAAO,CAAEJ,sBAG1CoC,OAAM,SAAAlM,GACH8L,KAAyB7F,SAAStC,GAAmBwB,oBAAoB,CACrE4G,OAAQlB,EACRsB,MAAOnM,KAEXiM,YAAW,WACPH,KAAyB7F,SAAS9D,EAAiBC,gBAAgB,CAC/DgK,MAAM,EACNC,MAAO,QACPC,QAAS,iCAAmCtM,EAAIsM,QAChDC,cAAc,EACdC,kBAAkB,EAClBC,QAAS,kBAAMX,KAAyB7F,SAAS9D,EAAiBE,0BAEvE,OAGJ6H,KAEVU,KAAKjH,GAAmBuB,mBAAmB,SAACgF,EAAOwC,GAChD,OAAOA,EAAIV,UAEdpB,KAAKjH,GAAmBwB,qBAAqB,SAAC+E,EAAOwC,GAClD,OAAOxC,KAIVU,KAAKjH,GAAmByB,sBAAsB,SAAC8E,EAAOW,GACnD,IAAMrB,EAAQU,EAAMJ,YAAY1B,QAAQoC,WAAU,SAAAvC,GAAC,OAAIA,EAAEwB,MAAQoB,EAAQ0C,YACzE,GAAI/D,EAAQ,EACR,OAAOU,EAGX,IAAMpK,EAASwG,OAAOC,OAAO,GAAI2D,EAAMJ,YAAY1B,QAAQoB,IAC3D1J,EAAOqN,OAASrN,EAAOqN,OAAS,IAAI5E,QAAO,SAAAN,GAAC,MAAU,aAANA,KAEhD,IAAMG,EAAU8B,EAAMJ,YAAY1B,QAAQqC,MAAM,EAAGjB,GAAOkB,OACtD,CAAC5K,GACDoK,EAAMJ,YAAY1B,QAAQqC,MAAMjB,EAAQ,IAEtCM,EAAcxD,OAAOC,OAAO,GAAI2D,EAAMJ,YAAa,CAAE1B,YA4B3D,OA1BAX,EAAGqF,IAAIhN,EAAQ,IACV4L,MAAK,SAAAxF,GACFpG,EAAO2J,IAAMvD,EAAE7G,GACfS,EAAO8L,KAAO1F,EAAE2F,IAChBC,KAAyB7F,SAAStC,GAAmB0B,oBAAoB,CACrE0G,OAAQlB,EACRmB,OAAQ1F,OAAOC,OAAO,GAAI2D,EAAO,CAAEJ,sBAG1CoC,OAAM,SAAAlM,GACH8L,KAAyB7F,SAAStC,GAAmB2B,sBAAsB,CACvEyG,OAAQlB,EACRsB,MAAOnM,KAEXiM,YAAW,WACPH,KAAyB7F,SAAS9D,EAAiBC,gBAAgB,CAC/DgK,MAAM,EACNC,MAAO,QACPC,QAAS,mCAAqCtM,EAAIsM,QAClDC,cAAc,EACdC,kBAAkB,EAClBC,QAAS,kBAAMX,KAAyB7F,SAAS9D,EAAiBE,0BAEvE,OAGJ6H,KAEVU,KAAKjH,GAAmB0B,qBAAqB,SAAC6E,EAAOwC,GAClD,OAAOA,EAAIV,UAEdpB,KAAKjH,GAAmB2B,uBAAuB,SAAC4E,EAAOwC,GACpD,OAAOxC,KAIVU,KAAKjH,GAAmB4B,mBAAmB,SAAC2E,EAAOW,GAChD,IAAMrB,EAAQU,EAAMJ,YAAY1B,QAAQoC,WAAU,SAAAvC,GAAC,OAAIA,EAAEwB,MAAQoB,EAAQ0C,YACzE,GAAI/D,EAAQ,EACR,OAAOU,EAGX,IAAMpK,EAASoK,EAAMJ,YAAY1B,QAAQoB,GAEnCpB,EAAU8B,EAAMJ,YAAY1B,QAAQqC,MAAM,EAAGjB,GAAOkB,OACtDR,EAAMJ,YAAY1B,QAAQqC,MAAMjB,EAAQ,IAEtCM,EAAcxD,OAAOC,OAAO,GAAI2D,EAAMJ,YAAa,CAAE1B,YA0B3D,OAxBAX,EAAGiC,OAAO5J,EAAQ,IACb4L,MAAK,SAAAxF,GACF4F,KAAyB7F,SAAStC,GAAmB6B,iBAAiB,CAClEuG,OAAQlB,EACRmB,OAAQ1F,OAAOC,OAAO,GAAI2D,EAAO,CAAEJ,sBAG1CoC,OAAM,SAAAlM,GACH8L,KAAyB7F,SAAStC,GAAmB8B,mBAAmB,CACpEsG,OAAQlB,EACRsB,MAAOnM,KAEXiM,YAAW,WACPH,KAAyB7F,SAAS9D,EAAiBC,gBAAgB,CAC/DgK,MAAM,EACNC,MAAO,QACPC,QAAS,gCAAkCtM,EAAIsM,QAC/CC,cAAc,EACdC,kBAAkB,EAClBC,QAAS,kBAAMX,KAAyB7F,SAAS9D,EAAiBE,0BAEvE,OAGJ6H,KAEVU,KAAKjH,GAAmB6B,kBAAkB,SAAC0E,EAAOwC,GAC/C,OAAOA,EAAIV,UAEdpB,KAAKjH,GAAmB8B,oBAAoB,SAACyE,EAAOwC,GACjD,OAAOxC,KAIVU,KAAKjH,GAAmB+B,0BAA0B,SAACwE,EAAOW,GAuGvD,OAtGA,sBAAC,gEAAAjM,EAAA,qEAEa4K,EAAQU,EAAMnC,OAAOyC,WAAU,SAAAvC,GAAC,OAAIA,EAAEwB,MAAQoB,EAAQpB,QAChD,GAHnB,yCAIkBS,GAJlB,cAOapK,EAASwG,OAAOC,OAAO,GAAI2D,EAAMnC,OAAOyB,GAAQ,CAClDb,KAAMkC,EAAQlC,MAAQ,WACtBoC,aAAcF,EAAQE,cAAgBzD,GAAYS,OAAO,GAAGgD,aAC5DC,cAAeH,EAAQG,eAAiB1D,GAAYS,OAAO,GAAGiD,cAC9DC,KAAMJ,EAAQI,MAAQ,GACtBC,iBAAkBL,EAAQK,eAC1BC,cAAeN,EAAQM,YACvBC,eAAgBP,EAAQO,aACxBC,cAAeR,EAAQQ,YACvBC,gBAAiBT,EAAQS,cACzBC,WAAYV,EAAQU,YAAc,GAClCC,cAAeX,EAAQW,eAAiB,GACxCnE,UAAWwD,EAAQxD,WAAa,KAnB3C,SAsBuBI,EAAGqF,IAAIhN,EAAQ,IAtBtC,cAsBaoG,EAtBb,OAuBOpG,EAAO2J,IAAMvD,EAAE7G,GACfS,EAAO8L,KAAO1F,EAAE2F,IAEV9D,EAASmC,EAAMnC,OAAO0C,MAAM,EAAGjB,GAAOkB,OACxC,CAAC5K,GACDoK,EAAMnC,OAAO0C,MAAMjB,EAAQ,IAE3BM,EAAchK,EAAO2J,MAAQS,EAAMJ,YAAYL,IAAM3J,EAASoK,EAAMJ,YA9B/E,UAiC8CrC,EAAGkC,KAAK,CAC3CS,SAAU,CACNhJ,KAAM,SACN+E,QAASrG,EAAO2J,OApC/B,QAiCarB,EAjCb,OAsCWiC,KAEEqD,EAA6B,GAxC1C,iCAAA9O,EAAA,0CAAAA,EAAA,yDAyCkByJ,EAzClB,QA0CiBsF,EAAQvF,EAAQuB,MAAK,SAAA1B,GAAC,OAAIA,EAAEwB,MAAQpB,EAAIoB,OAC1CmE,EAAuB,MACvBD,EA5Cf,wBA6CeC,EAAStH,OAAOC,OAAO,GAAI8B,EAAK,CAAEjH,KAAM,SAAU+E,QAASrG,EAAO2J,IAAKmC,KAAM+B,EAAM/B,OA7ClG,SA8CkCnE,EAAGqF,IAAIc,EAAQ,IA9CjD,OA8CqBlG,EA9CrB,OA+CekG,EAAOnE,IAAM/B,EAAKrI,GAClBuO,EAAOhC,KAAOlE,EAAKmE,IAhDlC,sCAkDe+B,EAAStH,OAAOC,OAAO,GAAI8B,EAAK,CAAEjH,KAAM,SAAU+E,QAASrG,EAAO2J,OACpDA,WACPmE,EAAOhC,KApD7B,UAqDkCnE,EAAGgE,KAAKmC,EAAQ,IArDlD,QAqDqBlG,EArDrB,OAsDekG,EAAOnE,IAAM/B,EAAKrI,GAClBuO,EAAOhC,KAAOlE,EAAKmE,IAvDlC,QAyDW6B,EAAWtE,KAAKwE,GAzD3B,8CAyCyB/C,EAAQzC,SAAW,IAzC5C,uZAAAxJ,EAAA,kCAAAA,EAAA,yDA2DkB+O,EA3DlB,QA4D0BD,EAAW/D,MAAK,SAAA1B,GAAC,OAAIA,EAAEwB,MAAQkE,EAAMlE,OA5D/D,gCA8DqBhC,EAAGiC,OAAOiE,EAAO,IA9DtC,4CA2D2BvF,EA3D3B,sXAiEOtI,EAAOsI,QAAUsF,EAEjB5B,KAAyB7F,SAAStC,GAAmBgC,wBAAwB,CACzEoG,OAAQlB,EACRmB,OAAQ1F,OAAOC,OAAO,GAAI2D,EAAO,CAC7BnC,SACAgC,cAAeD,EAAYL,IAC3BK,YAAaA,OAGrBmC,YAAW,WACPH,KAAyB7F,SAAS9D,EAAiBC,gBAAgB,CAC/DgK,MAAM,EACNC,MAAO,OACPC,QAAS,8BACTC,cAAc,EACdE,QAAS,kBAAMX,KAAyB7F,SAAS9D,EAAiBE,0BAEvE,IAnFV,kDAqFOyJ,KAAyB7F,SAAStC,GAAmBiC,0BAA0B,CAC3EmG,OAAQlB,EACRsB,MAAM,EAAD,MAETF,YAAW,WACPH,KAAyB7F,SAAS9D,EAAiBC,gBAAgB,CAC/DgK,MAAM,EACNC,MAAO,QACPC,QAAS,6BAA+B,KAAEA,QAC1CC,cAAc,EACdC,kBAAkB,EAClBC,QAAS,kBAAMX,KAAyB7F,SAAS9D,EAAiBE,0BAEvE,IAlGV,6GAAD,GAsGO6H,KAEVU,KAAKjH,GAAmBgC,yBAAyB,SAACuE,EAAOwC,GAStD,OARAT,YAAW,WACPhM,IACKyL,MAAK,eAEHQ,OAAM,SAAAlM,GACL2M,MAAM3M,EAAIsM,cAEnB,MACII,EAAIV,UAEdpB,KAAKjH,GAAmBiC,2BAA2B,SAACsE,EAAOwC,GACxD,OAAOxC,KAIVU,KAAKjH,GAAmBkC,yBAAyB,SAACqE,EAAOW,GAgBtD,OAfA,sBAAC,4BAAAjM,EAAA,+EAE8BqL,EAA0BC,EAAOA,EAAMJ,YAAYL,KAFjF,OAEamD,EAFb,OAIOd,KAAyB7F,SAAStC,GAAmBmC,uBAAuB,CACxEiG,OAAQlB,EACRmB,OAAQY,KANnB,gDASOd,KAAyB7F,SAAStC,GAAmBoC,yBAAyB,CAC1EgG,OAAQlB,EACRsB,MAAM,EAAD,MAXhB,wDAAD,GAeOjC,KAEVU,KAAKjH,GAAmBmC,wBAAwB,SAACoE,EAAOwC,GACrD,OAAOA,EAAIV,UAEdpB,KAAKjH,GAAmBoC,0BAA0B,SAACmE,EAAOwC,GACvD,OAAOxC,KAl3BhB,gJAs3BI3C,IAt3BJ,4C,sBCUP,IAAMzF,GAAgBC,MAET8L,GAAkB,CAC3BC,UAAWhM,GAAoB,sBAC/BiM,cAAejM,GAAoB,2BACnCkM,kBAAmBlM,GAAoB,+BACvCmM,aAAcnM,GAAoB,0BAClCoM,iBAAkBpM,GAAoB,+BCzCtCqM,GAAgE,KAE7D,SAAeC,KAAtB,gC,8CAAO,4BAAAxP,EAAA,6DACEuP,KACKtE,EAA8B,CAChCwE,YAAa,IAAIlH,MAErBgH,GAAkBxD,mCAAwBd,GACrCe,KAAKiD,GAAgBC,WAAW,SAAC5D,GAC9B,IAAM/B,EAAM,IAAIhB,KACVD,EAAI,IAAIC,KAAKgB,EAAIvB,cAAeuB,EAAIrB,WAAY,GACtD,OAAOR,OAAOC,OAAO,GAAI2D,EAAO,CAAEmE,YAAanH,OAElD0D,KAAKiD,GAAgBE,eAAe,SAAC7D,GAClC,IAAM/B,EAAM+B,EAAMmE,YACZnH,EAAI,IAAIC,KAAKgB,EAAIvB,cAAeuB,EAAIrB,WAAa,EAAG,GAC1D,OAAOR,OAAOC,OAAO,GAAI2D,EAAO,CAAEmE,YAAanH,OAElD0D,KAAKiD,GAAgBG,mBAAmB,SAAC9D,GACtC,IAAM/B,EAAM+B,EAAMmE,YACZnH,EAAI,IAAIC,KAAKgB,EAAIvB,cAAeuB,EAAIrB,WAAa,EAAG,GAC1D,OAAOR,OAAOC,OAAO,GAAI2D,EAAO,CAAEmE,YAAanH,OAElD0D,KAAKiD,GAAgBI,cAAc,SAAC/D,GACjC,IAAM/B,EAAM+B,EAAMmE,YACZnH,EAAI,IAAIC,KAAKgB,EAAIvB,cAAgB,EAAGuB,EAAIrB,WAAY,GAC1D,OAAOR,OAAOC,OAAO,GAAI2D,EAAO,CAAEmE,YAAanH,OAElD0D,KAAKiD,GAAgBK,kBAAkB,SAAChE,GACrC,IAAM/B,EAAM+B,EAAMmE,YACZnH,EAAI,IAAIC,KAAKgB,EAAIvB,cAAgB,EAAGuB,EAAIrB,WAAY,GAC1D,OAAOR,OAAOC,OAAO,GAAI2D,EAAO,CAAEmE,YAAanH,QA7BxD,kBAiCIiH,IAjCJ,4C,oCCMHG,GAAmE,KAEhE,SAAeC,KAAtB,gC,8CAAO,oCAAA3P,EAAA,yDACE0P,GADF,wBAEOE,EAAS3N,IACT4G,EAAK7G,IAGP8G,EAAyC,KAN9C,SAQc8G,EAAO3P,QAAQ,CACxB8I,cAAc,IATnB,UAQCD,EARD,OAYO+G,EAAmB,CACrBC,OAAQ,CACJC,YAAa,yCACbrO,KAAM,QACNC,SAAU,YAEdqO,QAAS,CACLC,YAAY,EACZC,mBAAoB,KAIH,IAArBpH,EAAKxI,KAAK0I,OAxBf,kCAyBW4G,EAAO/C,KAAP,cACFrK,KAAM,aACHqN,GACJ,IA5BR,yBA8BkBD,EAAO3P,QAAQ,CACxB8I,cAAc,IA/BvB,QA8BKD,EA9BL,gBAmCOmC,EAA+B,CACjCkF,YAAa,CACT3C,MAAM,EACNC,MAAO,GACPC,QAAS,GACTG,QAAS,cAEbuC,UAAU,gBACHP,EADE,GAEF/G,EAAKxI,KAAK,GAAGC,OAIP6P,UAAUN,QAAU7E,EAAamF,UAAUN,OAAOC,YAC/DvO,EACIyJ,EAAamF,UAAUN,OAAOC,YAC9B9E,EAAamF,UAAUN,OAAOpO,MAAQ,GACtCuJ,EAAamF,UAAUN,OAAOnO,UAAY,IAEzCmL,MAAK,eAGLQ,OAAM,SAAAlM,GACH2M,MAAM,uCAAyC3M,EAAIsM,YAG3DlM,EAAY,GAAI,GAAI,IACfsL,MAAK,eAGLQ,OAAM,SAAAlM,GACH2M,MAAM,uCAAyC3M,EAAIsM,YAI/DgC,GAAmB3D,mCAAwBd,GACtCe,KAAKzI,EAAiBC,iBAAiB,SAAC8H,EAAOW,GAC5C,OAAOvE,OAAOC,OAAO,GAAI2D,EAAO,CAC5B6E,YAAalE,OAGpBD,KAAKzI,EAAiBE,kBAAkB,SAAC6H,GACtC,OAAO5D,OAAOC,OAAO,GAAI2D,EAAO,CAC5B6E,YAAalF,OAKpBe,KAAKzI,EAAiBG,sBAAsB,SAAC4H,EAAOW,GACjD,IAAMoE,EAAU3I,OAAOC,OAAO,GAAI2D,EAAM8E,UACpCnE,EAAQ6D,QAAU7D,EAAQ6D,OAAOC,YAC7B,CAAED,OAAQ7D,EAAQ6D,QAClB,CAAEA,OAAQD,EAAiBC,QAC/B7D,EAAQ+D,QACJ,CAAEA,QAAS/D,EAAQ+D,SACnB,CAAEA,QAASH,EAAiBG,UA4DpC,OAzDAJ,EAAO1B,IAAImC,EAAS,IACfvD,MAAK,SAAAxF,GACF+I,EAAQxF,IAAMvD,EAAE7G,GAChB4P,EAAQrD,KAAO1F,EAAE2F,IAEjBC,KAAyB7F,SAAS9D,EAAiBK,oBAAoB,CACnEuJ,OAAQlB,EACRmB,OAAQ1F,OAAOC,OAAO,GAAI2D,EAAO,CAAE8E,UAAWC,OAElDhD,YAAW,WACPH,KAAyB7F,SAAS9D,EAAiBC,gBAAgB,CAC/DgK,MAAM,EACNC,MAAO,OACPC,QAAS,iCACTC,cAAc,EACdE,QAAS,kBAAMX,KAAyB7F,SAAS9D,EAAiBE,0BAEvE,IAEC4M,EAAQP,OAAOC,aACfvO,EACI6O,EAAQP,OAAOC,YACfM,EAAQP,OAAOpO,KACf2O,EAAQP,OAAOnO,UAEdmL,MAAK,eAGLQ,OAAM,SAAAlM,GACH8L,KAAyB7F,SAAS9D,EAAiBC,gBAAgB,CAC/DgK,MAAM,EACNC,MAAO,QACPC,QAAS,uCAAyCtM,EAAIsM,QACtDC,cAAc,EACdC,kBAAkB,EAClBC,QAAS,kBAAMX,KAAyB7F,SAAS9D,EAAiBE,8BAKrF6J,OAAM,SAAAlM,GACH8L,KAAyB7F,SAAS9D,EAAiBO,sBAAsB,CACrEqJ,OAAQlB,EACRsB,MAAOnM,KAEXiM,YAAW,WACPH,KAAyB7F,SAAS9D,EAAiBC,gBAAgB,CAC/DgK,MAAM,EACNC,MAAO,QACPC,QAAS,8BAAgCtM,EAAIsM,QAC7CC,cAAc,EACdC,kBAAkB,EAClBC,QAAS,kBAAMX,KAAyB7F,SAAS9D,EAAiBE,0BAEvE,OAGJ6H,KAEVU,KAAKzI,EAAiBK,qBAAqB,SAAC0H,EAAOwC,GAChD,OAAOA,EAAIV,UAEdpB,KAAKzI,EAAiBO,uBAAuB,SAACwH,EAAOwC,GAClD,OAAOxC,KAIVU,KAAKzI,EAAiBS,uBAAuB,SAACsH,GAgC3C,OA/BA,sBAAC,sBAAAtL,EAAA,wFAGiBwB,EAAY,GAAI,GAAI,IAHrC,sDAKWuM,MAAM,EAAD,IALhB,iCAQiBlF,EAAGyH,QAAQ,IAR5B,0DAUWvC,MAAM,EAAD,IAVhB,mCAaiB6B,EAAOU,QAAQ,IAbhC,2DAeWvC,MAAM,EAAD,IAfhB,QAkBOA,MAAM,oEAENb,KAAyB7F,SAAS9D,EAAiBU,qBAAqB,CACpEmJ,OAAQ9B,KArBnB,kDAwBOyC,MAAM,EAAD,IACLb,KAAyB7F,SAAS9D,EAAiBW,uBAAuB,CACtEqJ,MAAM,EAAD,MA1BhB,8EAAD,GA+BOjC,KAEVU,KAAKzI,EAAiBK,qBAAqB,SAAC0H,EAAOwC,GAChD,OAAOA,EAAIV,UAEdpB,KAAKzI,EAAiBO,uBAAuB,SAACwH,EAAOwC,GAClD,OAAOxC,KAtMhB,iCA0MIoE,IA1MJ,6C,sBCDA,IAAM3M,GAAUwN,aAAkB,CACrCC,SAAU,UAIVC,GAAoC,KAGjC,SAASvD,KACZ,OAAOuD,GAII,SAAeC,KAA9B,gC,8CAAe,sBAAA1Q,EAAA,yDACNyQ,GADM,6BAECE,KAFD,KAGHC,KAHG,KAISC,YAAc9N,IAJvB,SAKkB4M,KALlB,mCAMoB/G,KANpB,oCAOiB4G,KAPjB,0BAICsB,OAJD,KAKClJ,UALD,KAMCmJ,YAND,KAOCC,SAPD,+BASHC,aACIC,aACIC,aAAiBpO,MAT7B0N,IAFO,oDAgBJA,IAhBI,6C,iWCXR,SAASrJ,GAAmBC,GAC/B,MAAO,CACHlD,SAAU,SAAC+H,GAAD,OACN7E,EAAStC,GAAmBC,cAAc,CAAEkH,gBAChD9H,kBAAmB,SAACmD,GAAD,OACfF,EAAStC,GAAmBI,uBAAuB,CAAEoC,cACzDlD,gBAAiB,SAACiD,GAAD,OACbD,EAAStC,GAAmBO,qBAAqBgC,KACrDhD,YAAa,SAACiD,GAAD,OACTF,EAAStC,GAAmBU,iBAAiB,CAAE8B,cAEnDhD,UAAW,kBACP8C,EAAStC,GAAmBa,eAAe,MAC/CpB,aAAc,SAAC8C,GAAD,OACVD,EAAStC,GAAmBgB,kBAAkBuB,KAClD7C,kBAAmB,SAAC6C,GAAD,OACfD,EAAStC,GAAmBmB,uBAAuBoB,KACvD5C,cAAe,SAACiK,GAAD,OACXtH,EAAStC,GAAmBsB,mBAAmB,CAAEsI,eACrDhK,gBAAiB,SAACgK,GAAD,OACbtH,EAAStC,GAAmByB,qBAAqB,CAAEmI,eACvD/J,aAAc,SAAC+J,GAAD,OACVtH,EAAStC,GAAmB4B,kBAAkB,CAAEgI,eAEpD9J,oBAAqB,SAACyC,GAAD,OACjBD,EAAStC,GAAmB+B,yBAAyBQ,KAEzDxC,mBAAoB,kBAChBuC,EAAStC,GAAmBkC,wBAAwB,MAGxDzD,gBAAiB,SAAC8D,GAAD,OACbD,EAAS9D,EAAiBC,gBAAgB8D,KAC9C7D,iBAAkB,kBACd4D,EAAS9D,EAAiBE,sBAK/B,SAAS+D,GAAgBC,GAC5B,OAAOC,OAAOC,OAAO,GAAIF,EAASsJ,a,2HCxDlCK,GAAa,EAEF,SAASC,KACpB,MAAM,+BAAN,OAAsCD,KAAtC,MCWJ,IAyDeE,GAzDyC,SAACC,GACrD,IAAMlP,EAAQmP,eADiD,EAEvCC,IAAMC,SAASH,EAAM/D,MAFkB,oBAExDA,EAFwD,KAElDmE,EAFkD,OAGrCF,IAAMC,SAASH,EAAM9C,OAHgB,oBAGxDA,EAHwD,KAGjDmD,EAHiD,KAKzDC,EAAoBR,KAE1B,SAASS,IACLH,GAAQ,GACRJ,EAAM1D,SAAQ,GAYlB,OACI,kBAACkE,GAAA,EAAD,CAAQvE,KAAMA,EAAMK,QAASiE,EAAmBE,kBAAiBH,GAC7D,kBAACI,GAAA,EAAD,CAAaxR,GAAIoR,GAAoBN,EAAM9D,OAC3C,kBAACyE,GAAA,EAAD,KACKX,EAAM7D,QACH,kBAACyE,GAAA,EAAD,KAAoBZ,EAAM7D,SAC1B,qCAEJ,kBAAC0E,GAAA,EAAD,CACIC,WAAS,EACTC,OAAO,QACPC,MAAOhB,EAAMiB,WACbC,WAAS,EACThE,MAAOA,EACPlB,QAAOgE,EAAMmB,WAAYnB,EAAMmB,UAAUjE,GACzCkE,SAnBhB,SAA2BC,GACvBhB,EAASgB,EAAMC,OAAOpE,WAqBlB,kBAACqE,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CACIC,QAAQ,WACRC,MAAM,UACNC,QAASpB,GACT,kBAAC,KAAD,MAAc,0BAAMqB,MAAO,CAACC,WAAY/Q,EAAMgR,QAAQ,MAAQ9B,EAAM+B,qBAAuB,UAE/F,kBAACP,GAAA,EAAD,CACIC,QAAQ,YACRC,MAAO1B,EAAM3D,iBAAmB,YAAc,UAC9C2F,WAAUhC,EAAMmB,WAAYnB,EAAMmB,UAAUjE,GAC5CyE,QAtChB,WACIvB,GAAQ,GACRJ,EAAM1D,SAAQ,EAAMY,KAqCR,kBAAC,KAAD,MAAa,0BAAM0E,MAAO,CAACC,WAAY/Q,EAAMgR,QAAQ,MAAQ9B,EAAMiC,oBAAsB,YCvBvGC,GAAYC,aAAW,SAAArR,GAAK,MAAK,CACnCsR,OAAQ,CACJC,MAJY,IAKZC,WAAY,EACZC,WAAY,UAEhBC,WAAY,CACRH,MATY,IAUZI,WAAY3R,EAAM4R,YAAYC,OAAO,QAAS,CAC1CC,OAAQ9R,EAAM4R,YAAYE,OAAOC,MACjCC,SAAUhS,EAAM4R,YAAYI,SAASC,kBAG7CC,YAAY,cACRP,WAAY3R,EAAM4R,YAAYC,OAAO,QAAS,CAC1CC,OAAQ9R,EAAM4R,YAAYE,OAAOC,MACjCC,SAAUhS,EAAM4R,YAAYI,SAASG,gBAEzCC,UAAW,SACXb,MAAOvR,EAAMgR,QAAQ,GAAK,GACzBhR,EAAMqS,YAAYC,GAAG,MAAQ,CAC1Bf,MAAOvR,EAAMgR,QAAQ,GAAK,IAGlCuB,OAAQ,CACJC,YAAaxS,EAAMgR,QAAQ,QA6LnByB,eAAWC,YAAQvN,GAAiBJ,GAAzB2N,EAxLiB,SAACxD,GAAW,IAAD,IAC7CyD,EAAUvB,KADmC,EAE3BhC,IAAMC,UAAS,GAFY,oBAE5ClE,EAF4C,KAEtCmE,EAFsC,OAGTF,IAAMC,SAAS,CACrDlE,MAAM,EACNC,MAAO,GACPC,QAAS,GACT8E,WAAY,GACZ/D,MAAO,GACPiE,UAAW,SAACjE,GAAD,OAAmBA,EAAMwG,OAAOjM,QAAU,GACrD6E,QA+BJ,SAAsCqH,EAAgBzG,GAClD0G,EAAiBzN,OAAOC,OAAO,GAAIyN,EAAe,CAAE5H,MAAM,KACtD0H,GAASzG,GACT8C,EAAMpN,SAASsK,MA5C4B,oBAG5C2G,EAH4C,KAG7BD,EAH6B,OAYf1D,IAAMC,UAAS,GAZA,oBAY5C2D,EAZ4C,KAYhCC,EAZgC,KAa7CC,EAAeC,aAAc,SAmCnC,SAASC,EAAiBC,EAAkBjV,GACpCA,IAAO8Q,EAAMpG,eACboG,EAAMxO,QAAQyH,KAAd,WAAuBkL,EAAvB,YAAmCjV,IAQ3C,IAAIuC,EAAcF,EAAeyO,EAAMxO,SAEvC,OACI,oCACMwS,EA0GE,qCAzGA,kBAACI,GAAA,EAAD,CACI3C,QAAQ,YACR4C,UAAWC,YAAKb,EAAQrB,QAAT,oBACVqB,EAAQjB,WAAavG,GADX,eAEVwH,EAAQT,aAAe/G,GAFb,IAIfwH,QAAS,CACLc,MAAOD,aAAI,oBACNb,EAAQjB,WAAavG,GADf,eAENwH,EAAQT,aAAe/G,GAFjB,KAKfuI,OAAO,OACPvI,KAAMA,GAEN,yBAAKoI,UAAW,IACZ,kBAACI,GAAA,EAAD,CAAY9C,QAhEhC,WACIvB,GAASnE,KAgEYA,EAAO,kBAAC,KAAD,MAAsB,kBAAC,KAAD,QAGtC,kBAACyI,GAAA,EAAD,MACCzI,EACG,oCACI,kBAAC0I,GAAA,EAAD,CACIC,UAAU,MACVnE,kBAAgB,wBAChBoE,UACI,kBAACC,GAAA,EAAD,CAAeF,UAAU,MAAM1V,GAAG,yBAAlC,WAIJ,kBAAC6V,GAAA,EAAD,CAAUC,QAAM,EACZrD,QAzChC,WACIoC,GAAeD,KAyCcA,EAAa,kBAAC,KAAD,MAAqB,kBAAC,KAAD,OAEtC9D,EAAMpG,cACH,oCACI,kBAACqL,GAAA,EAAD,CAAUC,GAAIpB,EAAYqB,QAAQ,OAAOC,eAAa,GAClD,kBAACT,GAAA,EAAD,CAAMC,UAAU,MAAMS,gBAAc,GAC/BrF,EAAMpI,OAAOC,KAAI,SAAAC,GAAC,OACf,kBAACiN,GAAA,EAAD,CAAUC,QAAM,EACZ9L,IAAKpB,EAAEwB,IACPgM,SAAUxN,EAAEwB,MAAQ0G,EAAMpG,cAC1ByK,UAAWC,YAAKb,EAAQJ,QACxBzB,MAAO,CAAE2D,WAAYzN,EAAEwB,MAAQ0G,EAAMpG,cAAgB,OAAS,UAC9D+H,QAAS,SAAA6D,GAAE,OAzF/D,SAAsCtW,GAClC,IAAIuW,EAAO,SACPzF,EAAMxO,QAAQ5D,SAASC,WACnBmS,EAAMxO,QAAQ5D,SAASC,SAAS6D,WAAW,cAC3C+T,EAAO,WACAzF,EAAMxO,QAAQ5D,SAASC,SAAS6D,WAAW,YAClD+T,EAAO,SAGfzF,EAAMxO,QAAQyH,KAAd,WAAuBwM,EAAvB,YAA+BvW,IAgFgCwW,CAA6B5N,EAAEwB,OAC9C,kBAACqM,GAAA,EAAD,CACIzU,QAAS4G,EAAEU,cAMnC,sCAGR,kBAACuM,GAAA,EAAD,CAAUC,QAAM,EACZrD,QAzF5B,WACIiC,EAAiBzN,OAAOC,OAAO,GAAIyN,EAAe,CAC9C5H,MAAM,EACNC,MAAO,YACPC,QAAS,GACT8E,WAAY,aACZ/D,MAAO,QAoFa,kBAAC0I,GAAA,EAAD,KAAc,kBAAC,KAAD,OACd,kBAACD,GAAA,EAAD,CAAczU,QAAQ,kBAE1B,kBAACwT,GAAA,EAAD,OAEJ,qCAEJ,kBAACC,GAAA,EAAD,KAEI,kBAACI,GAAA,EAAD,CAAUC,QAAM,EACZM,SAA0B,WAAhB7T,GAA4C,KAAhBA,EACtCkQ,QAAS,SAAA6D,GAAE,OAAItB,EAAiB,SAAUlE,EAAMpG,iBAChD,kBAACgM,GAAA,EAAD,KAAc,kBAAC,KAAD,OACb3J,EAAO,kBAAC0J,GAAA,EAAD,CAAczU,QAAQ,WAAc,sCAEhD,kBAAC6T,GAAA,EAAD,CAAUC,QAAM,EACZM,SAA0B,aAAhB7T,EACVkQ,QAAS,SAAA6D,GAAE,OAAItB,EAAiB,WAAYlE,EAAMpG,iBAClD,kBAACgM,GAAA,EAAD,KAAc,kBAAC,KAAD,OACb3J,EAAO,kBAAC0J,GAAA,EAAD,CAAczU,QAAQ,aAAgB,sCAElD,kBAAC6T,GAAA,EAAD,CAAUC,QAAM,EACZM,SAA0B,SAAhB7T,EACVkQ,QAAS,SAAA6D,GAAE,OAAItB,EAAiB,OAAQlE,EAAMpG,iBAC9C,kBAACgM,GAAA,EAAD,KAAc,kBAAC,KAAD,OACb3J,EAAO,kBAAC0J,GAAA,EAAD,CAAczU,QAAQ,WAAc,uCAGnD+K,EACG,oCACI,kBAACyI,GAAA,EAAD,MACA,kBAACK,GAAA,EAAD,CAAUC,QAAM,EACZM,SAA0B,WAAhB7T,EACVkQ,QAAS,SAAA6D,GAAE,OAAIxF,EAAMxO,QAAQyH,KAAd,cACf,kBAAC2M,GAAA,EAAD,KAAc,kBAAC,KAAD,OACb3J,EAAO,kBAAC0J,GAAA,EAAD,CAAczU,QAAQ,aAAgB,sCAElD,kBAACyT,GAAA,EAAD,KACI,kBAACI,GAAA,EAAD,CAAUC,QAAM,GACZ,kBAACY,GAAA,EAAD,KAAc,kBAAC,KAAD,OACb3J,EAAO,kBAAC0J,GAAA,EAAD,CAAczU,QAAQ,SAAY,wCAItD,sCAKX2S,EAAc5H,KACX,kBAAC,GAAD,CACIA,MAAM,EACNC,MAAO2H,EAAc3H,MACrBC,QAAS0H,EAAc1H,QACvB8E,WAAY4C,EAAc5C,WAC1B/D,MAAO2G,EAAc3G,MACrBiE,UAAW0C,EAAc1C,UACzB7E,QAASuH,EAAcvH,UAC3B,0C,0MCvKDuJ,GAtEqC,SAAC7F,GACjD,IAAMlP,EAAQmP,eAD6C,EAEnCC,IAAMC,SAASH,EAAM/D,MAFc,oBAEpDA,EAFoD,KAE9CmE,EAF8C,OAGvBF,IAAMC,SAAS,IAHQ,oBAGpD2F,EAHoD,KAGxCC,EAHwC,KAKrDzF,EAAoBR,KAE1B,SAASS,IACLH,GAAQ,GACRJ,EAAM1D,SAAQ,GAelB,OACI,kBAACkE,GAAA,EAAD,CAAQvE,KAAMA,EAAMK,QAASiE,EAAmBE,kBAAiBH,GAC5DN,EAAMgG,IAAMhG,EAAMgG,IAAM,qCACzB,kBAACtF,GAAA,EAAD,CAAaxR,GAAIoR,EAAmBsB,MAAO,CAACqE,UAAW,WAAYjG,EAAM9D,OACzE,kBAACyE,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAmBgB,MAAO,CAACqE,UAAW,YAChCjG,EAAM7D,SAAW,IAAI+J,MAAM,MAAMrO,KAAI,SAACC,EAAGuB,EAAO8M,GAAX,OACnC,0BAAMjN,IAAK,WAAaG,GACnBvB,EACAuB,GAAU8M,EAAI1O,OAAS,EAAK,6BAAQ,2CAKpDuI,EAAMoG,oBACH,kBAACvF,GAAA,EAAD,CACIC,WAAS,EACTC,OAAO,QACPC,MAAOhB,EAAMqG,oBACbnJ,MAAO4I,EACP1E,SAxBhB,SAA2BC,GACvB0E,EAAc1E,EAAMC,OAAOpE,QAwBf0E,MAAO,CAACC,WAAY/Q,EAAMgR,QAAQ,GAAIwE,YAAaxV,EAAMgR,QAAQ,GAAIyE,aAAczV,EAAMgR,QAAQ,MAEjG,qCAER,kBAACP,GAAA,EAAD,CAAeK,MAAO,CAACb,OAAQ,SACzBf,EAAM5D,aAOJ,qCANA,kBAACoF,GAAA,EAAD,CACIC,QAAQ,WACRC,MAAM,UACNC,QAASpB,GACT,kBAAC,KAAD,MAAc,0BAAMqB,MAAO,CAACC,WAAY/Q,EAAMgR,QAAQ,MAAQ9B,EAAM+B,qBAAuB,UAInG,kBAACP,GAAA,EAAD,CACIC,QAAQ,YACRC,MAAO1B,EAAM3D,iBAAmB,YAAc,UAC9C2F,WAAUhC,EAAMoG,qBAAsBN,IAAe9F,EAAMoG,oBAC3DzE,QAnDhB,WACQ3B,EAAMoG,qBAAuBpG,EAAMoG,sBAAwBN,IAG/D1F,GAAQ,GACRJ,EAAM1D,SAAQ,MA+CF,kBAAC,KAAD,MAAa,0BAAMsF,MAAO,CAACC,WAAY/Q,EAAMgR,QAAQ,MAAQ9B,EAAMiC,oBAAsB,Y,4BCrEvGuE,GAAKC,aAA2B,CAClCC,WAAY,SAAAC,GAAQ,OAAIA,GACxBC,aAAc,SAAAC,GAAM,OAAKA,EAAOpP,OAC5B,CAACoP,EAAOC,QAAO,SAACrY,EAAG8J,GAAJ,OAAU9J,EAAc8J,MAAgB,MAGxDwO,GAEgBP,GAFhBO,IAAKC,GAEWR,GAFXQ,IAAKC,GAEMT,GAFNS,OAAQxD,GAEF+C,GAFE/C,QAASyD,GAEXV,GAFWU,IAC1BC,GACeX,GADfW,OAAQC,GACOZ,GADPY,IAAKC,GACEb,GADFa,MAAOC,GACLd,GADKc,QAASC,GACdf,GADce,MAAOC,GACrBhB,GADqBgB,MAAOC,GAC5BjB,GAD4BiB,MAC3CC,GAAelB,GAAfkB,YAGFC,GAASH,IAAM,SAAAI,GAAK,OAAIA,EAAMnQ,OAASmQ,EAAQ,CAAC,MAAvCJ,CACXD,GAAMJ,GAAO1D,GAAQoE,uBAAwBb,GAAI,MACjDE,GAAIC,GAAOE,GACPG,IAAM,SAAAI,GAAK,MAAI,CAAC,OAAhBJ,CAAsBT,GAAI,OAC1BE,GAAO,QACXM,GAAMP,GAAI,KAAMG,GAAOI,GAAM9D,GAAQoE,0BAEnCC,GAAQN,IAAM,SAAAI,GAAK,OAAIA,EAAMnQ,OAASmQ,EAAQ,CAAC,MAAvCJ,CACVD,GAAMJ,GAAO1D,GAAQoE,wBACrBX,GAAIC,GAAOE,GACPE,GAAM9D,GAAQoE,sBAAuBJ,GAAMT,GAAI,IAAK,OAAQ,KAAM,QAClEC,GAAO,IAAK,OAAQ,KAAM,UAE5Bc,GAAOV,GAAMM,GAAQG,IAErBE,GAAMR,IAAM,SAAAI,GAAK,MAAI,CAACA,KAAhBJ,CACRO,GACAZ,GAAOG,GAAQC,GAAMR,GAAI,MAAOgB,MAE9BhZ,GAAO2Y,GAAYJ,GACrBU,GACAb,GAAOG,GAAQC,GAAM9D,GAAQwE,SAAUD,KACvCZ,OAGG,SAASc,GAAMpR,GAClB,IAAMqR,EAAIpZ,GAAKqZ,aAAYtR,IAC3B,IAAMqR,EAAEE,UACJ,MAAM,IAAIC,MAAMC,aAAmBJ,IAEvC,OAAOA,EAAEtB,OCjBb,IAAM3E,GAAYC,aAAW,SAAArR,GAAK,MAAK,CACnC0X,YAAa,CACTC,SAAU,KAEdC,KAAM,CACF3H,OAAQjQ,EAAMgR,QAAQ,GACtB6G,SAAU,IAEdC,UAAW,CACPC,SAAU,WACV9H,OAAQjQ,EAAMgR,QAAQ,GACtBgH,MAAOhY,EAAMgR,QAAQ,GACrBiH,IAAKjY,EAAMgR,QAAQ,QAoUZkH,GA/TmC,SAAChJ,GAC/C,IAAMyD,EAAUvB,KACVpR,EAAQmP,eAF2C,EAIjCC,IAAMC,SAASH,EAAM/D,MAJY,oBAIlDA,EAJkD,KAI5CmE,EAJ4C,OAKnBF,IAAMC,UAAS,GALI,oBAKlD8I,EALkD,KAKrCC,EALqC,OAMnBhJ,IAAMC,SAASH,EAAMpD,OAAOC,aANT,oBAMlDA,EANkD,KAMrCsM,EANqC,OAO3BjJ,IAAMC,SAASH,EAAMpD,OAAOE,SAPD,oBAOlDA,EAPkD,KAOzCsM,EAPyC,OAQjClJ,IAAMC,SAASH,EAAMpD,OAAOG,MARK,oBAQlDA,EARkD,KAQ5CsM,EAR4C,OASjCnJ,IAAMC,SAASH,EAAMpD,OAAO9B,KAChDkF,EAAMpD,OAAO9B,KAAKjD,KAAI,SAAAC,GAAC,OAAIA,EAAEwR,SAAS,KAAX,WAAsBxR,EAAEhK,QAAQ,KAAM,MAAtC,KAAiDgK,KAAGyR,KAAK,MAAQ,IAVvC,oBASlDzO,EATkD,KAS5C0O,EAT4C,OAW/BtJ,IAAMC,SAASH,EAAMpD,OAAOI,MAClDgD,EAAMpD,OAAOI,MAAMnF,KAAI,SAAAC,GAAC,OAAIA,EAAEwR,SAAS,KAAX,WAAsBxR,EAAEhK,QAAQ,KAAM,MAAtC,KAAiDgK,KAAGyR,KAAK,MAAQ,IAZxC,oBAWlDvM,EAXkD,KAW3CyM,EAX2C,OAa3BvJ,IAAMC,SAAgCtJ,GAAamJ,EAAMpD,OAAOzE,UAbrC,oBAalDA,EAbkD,KAazCuR,EAbyC,OAcrBxJ,IAAMC,SAASH,EAAMpD,OAAOK,YAdP,oBAclDA,EAdkD,KActC0M,EAdsC,OAenBzJ,IAAMC,SAASH,EAAMpD,OAAOO,aAfT,oBAelDA,EAfkD,KAerCyM,EAfqC,KAiBnDtJ,EAAoBR,KACpB+J,EAAiB/J,KACjBgK,EAAgBhK,KAEhBiK,IAAW/J,EAAMpD,OAAOI,OAAQgD,EAAMpD,OAAOI,MAAMsM,SAAS,YAElE,SAAS/I,IACLH,GAAQ,GACRJ,EAAMgK,WAkDV,SAASC,EAAiB5I,GACtBmI,EAAQnI,EAAMC,OAAOpE,OAGzB,SAASgN,EAAkB7I,GACvBoI,EAASpI,EAAMC,OAAOpE,OAmC1B,OACI,oCACI,kBAACsD,GAAA,EAAD,CAAQvE,KAAMA,EAAMK,QAASiE,EAAmBE,kBAAiBH,GAC7D,kBAACI,GAAA,EAAD,CAAaxR,GAAIoR,EAAmBsB,MAAO,CAACuI,cAAe,MAA3D,cAEI,kBAAC3I,GAAA,EAAD,CACI6C,UAAWC,YAAKb,EAAQmF,WACxBnH,QAAQ,WACRC,MAAO1B,EAAMvG,MAAM0B,cAAgB,UAAY,YAC/CwG,QA3EpB,WACIuH,GAAe,KA2EElJ,EAAMvG,MAAM0B,cACR4O,EAAW,kBAAC,KAAD,MAAoB,kBAAC,KAAD,MAChC,kBAAC,KAAD,CAAYrI,MAAM,cACtB,kBAAC0I,GAAA,EAAD,CAAY3I,QAAQ,QAAQC,MAAO1B,EAAMvG,MAAM0B,cAAgB,UAAY,YACvEyG,MAAO,CAACC,WAAY/Q,EAAMgR,QAAQ,KACjC9B,EAAMvG,MAAM0B,cACR4O,EAAW,YAAc,UAC1B,YAIhB,kBAACpJ,GAAA,EAAD,KACI,kBAAC,KAAD,CAAyB0J,MAAOC,MAC5B,6BACI,kBAACzJ,GAAA,EAAD,CACIE,OAAO,QACPC,MAAM,cACNuJ,WAAS,EACTxb,KAAM,EACNyb,QAAS,GACTtJ,WAAS,EACThE,MAAOL,EACPuE,SA9F5B,SAAiCC,GAC7B8H,EAAe9H,EAAMC,OAAOpE,QA8FJuN,WAAW,kCAGnB,6BACI,kBAAC,KAAD,CACI1J,OAAO,QACPC,MAAM,WACN0J,OAAO,aACPC,oBAAqB,CACjB,aAAc,eAElBzN,MAAO/E,EACPiJ,SAvG5B,SAA6BwJ,GACzBlB,EAAWkB,OAyGK,6BACI,kBAACC,GAAA,EAAD,CAAaxG,UAAWC,YAAKb,EAAQ+E,aAAc5G,MAAO,CAACkJ,UAAW,QAClE,kBAACC,GAAA,EAAD,CAAYC,QAASnB,GAArB,UACA,kBAACoB,GAAA,EAAD,CACI/N,MAAOD,EACPmE,SA3GhC,SAAgCC,GACtBA,EAAMC,OAAO9I,MAGnBmR,EAActI,EAAMC,OAAOpE,QAwGCgO,WAAY,CACR1S,KAAM,aACNtJ,GAAI2a,IAGP7J,EAAMpF,aAAa/C,KAAI,SAAAC,GAAC,OACrB,kBAACqT,GAAA,EAAD,CAAUjS,IAAKpB,EAAEoF,MAAOA,MAAOpF,EAAEoF,OAAQpF,EAAEsT,SAAWtT,EAAEoF,YAIpE,kBAAC2N,GAAA,EAAD,CAAaxG,UAAWC,YAAKb,EAAQ+E,aAAc5G,MAAO,CAACC,WAAY/Q,EAAMgR,QAAQ,GAAIgJ,UAAW,QAChG,kBAACC,GAAA,EAAD,CAAYC,QAASlB,GAArB,gBACA,kBAACmB,GAAA,EAAD,CACI/N,MAAOC,EACPiE,SAnHhC,SAAiCC,GACvBA,EAAMC,OAAO9I,MAGnBoR,EAAevI,EAAMC,OAAOpE,QAgHAgO,WAAY,CACR1S,KAAM,cACNtJ,GAAI4a,IAGP9J,EAAMnF,cAAchD,KAAI,SAAAC,GAAC,OACtB,kBAACqT,GAAA,EAAD,CAAUjS,IAAKpB,EAAEoF,MAAOA,MAAOpF,EAAEoF,OAAQpF,EAAEsT,SAAWtT,EAAEoF,aAKvE8C,EAAMvG,MAAMyB,aAAe8E,EAAMvG,MAAMwB,aACpC,6BACI,kBAAC4P,GAAA,EAAD,CAAaxG,UAAWC,YAAKb,EAAQ+E,aAAc5G,MAAO,CAACkJ,UAAW,QAClE,kBAACjK,GAAA,EAAD,CACIE,OAAO,QACPC,MAAM,OACN9D,MAAOpC,EACPsG,SAAU6I,EACVQ,WAAW,6CAGnB,kBAACI,GAAA,EAAD,CAAaxG,UAAWC,YAAKb,EAAQ+E,aAAc5G,MAAO,CAACC,WAAY/Q,EAAMgR,QAAQ,GAAIgJ,UAAW,QAChG,kBAACjK,GAAA,EAAD,CACIE,OAAO,QACPC,MAAM,QACN9D,MAAOF,EACPoE,SAAU8I,EACVO,WAAW,8CAIvB,qCAEHzK,EAAMvG,MAAMyB,cAAgB8E,EAAMvG,MAAMwB,aACrC,6BACI,kBAAC4F,GAAA,EAAD,CACIE,OAAO,QACPC,MAAM,OACNE,WAAS,EACThE,MAAOpC,EACPsG,SAAU6I,EACVQ,WAAW,6CAGnB,qCAEHzK,EAAMvG,MAAMwB,eAAiB+E,EAAMvG,MAAMyB,YACtC,6BACI,kBAAC2F,GAAA,EAAD,CACIE,OAAO,QACPC,MAAM,QACNE,WAAS,EACThE,MAAOF,EACPoE,SAAU8I,EACVO,WAAW,6CAGnB,qCAEHzK,EAAMvG,MAAMsB,eACT,6BACI,kBAAC8F,GAAA,EAAD,CACIE,OAAO,QACPC,MAAM,UACNuJ,WAAS,EACTxb,KAAM,EACNyb,QAAS,GACTtJ,WAAS,EACThE,MAAOJ,EACPsE,SA3KhC,SAA6BC,GACzB+H,EAAW/H,EAAMC,OAAOpE,WA6KJ,qCAEH8C,EAAMvG,MAAMuB,YACT,6BACI,kBAAC6F,GAAA,EAAD,CACIE,OAAO,QACPC,MAAM,OACNuJ,WAAS,EACTxb,KAAM,EACNyb,QAAS,GACTtJ,WAAS,EACThE,MAAOH,EACPqE,SAtLhC,SAA0BC,GACtBgI,EAAQhI,EAAMC,OAAOpE,WAwLD,uCAIZ,kBAACqE,GAAA,EAAD,KACI,kBAACC,GAAA,EAAD,CAAQG,QAASpB,EAAmBkB,QAAQ,WAAWC,MAAM,WACzD,kBAAC,KAAD,MAAc,0BAAME,MAAO,CAACC,WAAY/Q,EAAMgR,QAAQ,MAD1D,UAGA,kBAACN,GAAA,EAAD,CAAQG,QA5PxB,WACIvB,GAAQ,GAER,IAAMiL,EAAcvQ,EAAK4I,OACnB4H,EAAaD,EAAcE,GAASF,GAAe,GAEnDG,EAAexO,EAAM0G,OACrB+H,EAAcD,EAAeD,GAASC,GAAgB,GAE5DxL,EAAM0L,QAAQvV,OAAOC,OAAO,GAAI4J,EAAMpD,OAAQ,CAC1CC,cACAC,UACAC,OACAjC,MAAOwQ,EAAW,IAAM,IAAIzT,KAAI,SAAAC,GAAC,OAAIA,EAAE4L,UAAQtL,QAAO,SAAAN,GAAC,OAAIA,EAAEL,OAAS,KACtEuF,OAAQyO,EAAY,IAAM,IAAI5T,KAAI,SAAAC,GAAC,OAAIA,EAAE4L,UAAQtL,QAAO,SAAAN,GAAC,OAAIA,EAAEL,OAAS,KACxEU,QAAUA,IAAYlB,OAAO0U,MAAMxT,EAAQyT,WAActV,GAAW6B,GAAW,GAC/E8E,aACAE,kBA2O2CsE,QAAQ,YAAYC,MAAM,WACzD,kBAAC,KAAD,MAAa,0BAAME,MAAO,CAACC,WAAY/Q,EAAMgR,QAAQ,MADzD,WAKPmH,EACG,kBAAC,GAAD,CACIhN,MAAM,EACNC,MAAO8D,EAAMvG,MAAM0B,cACd4O,EAAW,mBAAqB,iBACjC,gBACJ5N,QAAO,+BAA0B6D,EAAMvG,MAAM0B,cACxC4O,EAAW,YAAc,UAC1B,SAFG,gBAGP1N,kBAAkB2D,EAAMvG,MAAM0B,cAC9B8G,mBAAoBjC,EAAMvG,MAAM0B,cAC3B4O,EAAW,YAAc,UAC1B,SACJ/D,IAAKhG,EAAMvG,MAAM0B,cACZ4O,EACG,kBAAC8B,GAAA,EAAD,CAAKC,KAAK,QAAQrK,QAAQ,QAAQsK,aAAW,YAAYnK,MAAO,CAACb,OAAQ,SACrE,kBAAC,KAAD,OAEJ,kBAAC8K,GAAA,EAAD,CAAKC,KAAK,QAAQrK,QAAQ,QAAQsK,aAAW,UAAUnK,MAAO,CAACb,OAAQ,SACnE,kBAAC,KAAD,OAGR,kBAAC8K,GAAA,EAAD,CAAKC,KAAK,QAAQrK,QAAQ,QAAQsK,aAAW,SAASrK,MAAM,YAAYE,MAAO,CAACb,OAAQ,SACpF,kBAAC,KAAD,OAGRzE,QAAS0D,EAAMvG,MAAM0B,cAChB4O,EArNrB,SAAkCpG,GAC9BuF,GAAe,GACXvF,IACAvD,GAAQ,GACRJ,EAAMgM,YAAYhM,EAAMpD,OAAOtD,OAZvC,SAAgCqK,GAC5BuF,GAAe,GACXvF,IACAvD,GAAQ,GACRJ,EAAMiM,UAAUjM,EAAMpD,OAAOtD,OAYrC,SAA+BqK,GAC3BuF,GAAe,GACXvF,IACAvD,GAAQ,GACRJ,EAAMkM,SAASlM,EAAMpD,OAAOtD,SA2MxB,uCC1TV6S,I,OAAYC,KAAgBze,SAG5BuU,GAAYC,aAAW,SAAArR,GAAK,MAAK,CACnCub,KAAM,GACNC,UAAW,CACPjK,MAAO,OACPkK,OAAQ,YAKVC,GAAuB,iBAAO,IAG9BC,IAAyC,IADjC9e,OAAO+e,UAAUC,UAAUC,cAClBC,QAAQ,WAyGzBC,GAAStJ,YAAQgJ,GAAsB3W,GAA9B2N,EAtGwB,SAACxD,GAAW,IAAD,EACtBE,IAAMC,UAAS,GADO,oBACvClE,EADuC,KACjCmE,EADiC,KAGxCpI,EAAM,IAAIhB,KACV+V,EAAQ,IAAI/V,KAAKgB,EAAIvB,cAAeuB,EAAIrB,WAAYqB,EAAIpB,WACxDuB,EAAU6H,EAAMpD,OAAOzE,QAAUtB,GAAamJ,EAAMpD,OAAOzE,SAAW,KACtE6U,GAAahN,EAAM/C,WAAWgQ,aAC/B9U,GAAUA,EAAU4U,EA8BzB,OACI,oCAEI,uBACI7d,GAAI4Q,KACJoN,iBAAgBlN,EAAMpD,OAAOtD,KAAO,GACpC+K,UAAU,8BACV8I,WAAS,EACTxL,QAAS,SAAA6D,GAAE,OAAIpF,GAAQ,IACvBgN,YArCZ,SAA2B5H,GACvBA,EAAG6H,aAAaC,QAAQ,OAAS9H,EAAGlE,OAAepS,MAqC3C,yBACImV,UAAW,+BAAiC2I,EAAU,WAAa,KAClEhN,EAAMvG,MAAMyB,aAAe8E,EAAMpD,OAAO9B,KAAKrD,OAC1C,wBAAI4M,UAAU,+BACVrE,EAAMpD,OAAO9B,KAAKjD,KAAI,SAACC,EAAGuB,GACtB,IACMkU,GADOvN,EAAMvG,MAAMqB,MAAQ,IACZtB,MAAK,SAAAgU,GAAC,OAAIA,EAAEtQ,QAAUpF,KAC3C,OACI,wBAAIoB,IAAK8G,EAAMpD,OAAOtD,IAAM,QAAUD,EAClCgL,UAAWkJ,EAAUA,EAAQlJ,UAAY,IAAKvM,OAI9D,qCAEJ,yBACIuM,UAAU,qCACVoJ,wBAAyB,CAACC,OAAQvB,GAAUwB,SAASC,KAAO5N,EAAMpD,OAAOC,iBAC5EmD,EAAMvG,MAAMsB,gBAAkBiF,EAAMpD,OAAOE,QACxC,yBAAKuH,UAAU,iCACXoJ,wBAAyB,CAACC,OAAQ,IAAIG,KAAG,CACzCC,MAAM,EACNC,UAAWpd,EAAS,OAAS,OAC7Bqd,SAAU,EACVC,KAAM,KACNvW,KAAMsI,EAAMpD,OAAOE,UACpBoR,cACD,qCAELlO,EAAMpD,OAAOI,MAAMsM,SAAS,UACzB,yBAAKjF,UAAU,UAAU,gBACzB,qCAEHrE,EAAMpD,OAAOzE,QACV,yBAAKkM,UAAU,aAAa2I,EAAU,eAAO,UAAQhN,EAAMpD,OAAOzE,SAClE,uCAIX8D,EACG,kBAAC,GAAD,CACIA,MAAM,EACNW,OAAQoD,EAAMpD,OACd/B,cAAemF,EAAMnF,cACrBD,aAAcoF,EAAMpF,aACpBnB,MAAOuG,EAAMvG,MACbiS,QAhFhB,SAAyBxT,GACrB8H,EAAM/M,aAAaiF,GACnBkI,GAAQ,IA+EI6L,UA5EhB,SAAuB/c,GACnB8Q,EAAM7M,cAAcjE,GACpBkR,GAAQ,IA2EI4L,YAxEhB,SAAyB9c,GACrB8Q,EAAM5M,gBAAgBlE,GACtBkR,GAAQ,IAuEI8L,SApEhB,SAAsBhd,GAClB8Q,EAAM3M,aAAanE,GACnBkR,GAAQ,IAmEI4J,SAhEhB,WACI5J,GAAQ,MA+DqC,yCA2D/C+N,GAAU3K,YAAQgJ,GAAsB3W,GAA9B2N,EAnDyB,SAACxD,GAoBtC,IAAMoO,EAAWpO,EAAM/H,QAAQG,QAAO,SAAAN,GAAC,OAAKA,EAAEkF,QAAUlF,EAAEkF,MAAMsM,SAAS,eAEzE,OACI,yBACIjF,UACI,gCACCrE,EAAM7C,YAAYkH,WAAa,IAAM,KACrCrE,EAAM/C,WAAWoH,WAAa,IACnCgK,cAAarO,EAAM/C,WAAWC,MAC9BoR,qBAAoBtO,EAAM7C,YAAYD,MACtCqR,WA7BR,SAA0B/I,GACtBA,EAAGgJ,kBA6BCC,OA1BR,SAAsBjJ,GAClB,IACI,IAAMkJ,EAAOlJ,EAAG6H,aAAasB,QAAQ,QAC/BC,EAAKC,SAASC,eAAeJ,GACnC1O,EAAM9M,kBAAkB,CACpBkK,SAAWwR,EAAWG,QAAQC,SAC9B3R,gBAAiB2C,EAAM/C,WAAWC,MAClCI,iBAAkB0C,EAAM7C,YAAYD,QAE1C,MAAOlN,GACLwM,MAAMxM,EAAEmM,SAEZqJ,EAAGgJ,mBAgBEJ,EAASvW,KAAI,SAAA+E,GAAM,OAChB,kBAACkQ,GAAD,CACI5T,IAAK0D,EAAOtD,KAAOwG,KACnB3C,YAAa6C,EAAM7C,YACnBF,WAAY+C,EAAM/C,WAClBpC,cAAemF,EAAMnF,cACrBD,aAAcoF,EAAMpF,aACpBnB,MAAOuG,EAAMvG,MACbmD,OAAQA,OAEd6P,IAA+B,IAApB2B,EAAS3W,OAElB,yBAAKmK,MAAO,CAACS,MAAO,OAAQkK,OAAQ,SAApC,QACA,yCA6ID/I,eAAQvN,GAAiBJ,GAAzB2N,EArIyC,SAACxD,GACrD,IAAMyD,EAAUvB,KACVpR,EAAQmP,eAFiD,EAGrBC,IAAMC,SAAS,CACrDlE,MAAM,EACNC,MAAO,GACPC,QAAS,GACT8E,WAAY,GACZ/D,MAAO,GACPiE,UAAW,SAACjE,GAAD,OAAmBA,EAAMwG,OAAOjM,QAAU,GACrD6E,QAcJ,SAAwCqH,EAAgBzG,GAEpD,GADA0G,EAAiBzN,OAAOC,OAAO,GAAIyN,EAAe,CAAE5H,MAAM,KACtD0H,GAASzG,EAAO,CAChB,IAAM+R,EAAetT,KAAyBuT,WAC9ClP,EAAMlN,gBAAgB,CAAEkD,QAASiZ,EAAazP,YAAY5F,cAAee,UAAWuC,QA5B7B,oBAGxD2G,EAHwD,KAGzCD,EAHyC,KAgC/D,GAAI5D,EAAM1P,MAAMsL,OAAO1M,IACf8Q,EAAMrG,YAAYL,MAAQ0G,EAAM1P,MAAMsL,OAAO1M,GAAI,CACjD,IAAMmK,EAAQ2G,EAAMpI,OAAOyC,WAAU,SAAAvC,GAAC,OAAIA,EAAEwB,MAAQ0G,EAAM1P,MAAMsL,OAAO1M,MAEvE,OADA8Q,EAAMnN,kBAAkBmN,EAAM1P,MAAMsL,OAAO1M,IAEvC,yBAAKmV,UAAU,2BACVhL,EAAQ,EACL,oCACI,kBAAC+Q,GAAA,EAAD,CACIxI,MAAO,CAACkJ,UAAWha,EAAMgR,QAAQ,KACjCL,QAAQ,KAAK0N,MAAM,UAFvB,oBAKA,kBAAC/E,GAAA,EAAD,CACIxI,MAAO,CAACkJ,UAAWha,EAAMgR,QAAQ,GAAIsN,OAAQ,UAAWC,eAAgB,aACxE5N,QAAQ,QAAQ0N,MAAM,SACtBxN,QAAS,SAAA6D,GAAOxF,EAAMxO,QAAQyH,KAAK,OAHvC,mCAOJ,sCAOpB,OACI,yBAAKoL,UAAU,2BACX,2BAAOoJ,wBAAyB,CAACC,OAAQ1N,EAAMrG,YAAYyB,cAC3D,kBAACgP,GAAA,EAAD,CACI3I,QAAQ,KAAK0N,MAAM,SAASvN,MAAO,CAACwN,OAAQ,WAC5CzN,QAnDZ,WACI,IAAMsN,EAAetT,KAAyBuT,WAC9CtL,EAAiBzN,OAAOC,OAAO,GAAIyN,EAAe,CAC9C5H,MAAM,EACNC,MAAO,kBACPC,QAAS,GACT8E,WAAY,aACZ/D,MAAO+R,EAAazP,YAAY7F,YAAYnB,UA4CHwH,EAAMrG,YAAYnB,MAC3D,2BAAO6L,UAAU,yBACb,+BACI,4BACI,wBAAIA,UAAU,0CACV,kBAACI,GAAA,EAAD,CAAY7C,MAAO,CAACb,OAAQ,EAAGuO,QAAS,GAC5B3N,QAAS,SAAA6D,GAAE,OAAIxF,EAAMhN,cAC7B,kBAAC,KAAD,CAAYqR,UAAWC,YAAKb,EAAQ6I,eAG3CtM,EAAMrG,YAAYiB,aAAa/C,KAAI,SAAAoF,GAAU,OAC1C,wBAAI/D,IAAK+D,EAAWC,MAChBmH,UACI,8CACCpH,EAAWoH,WAAa,KAC5BpH,EAAWmO,SAAWnO,EAAWC,YAKlD,+BACK8C,EAAMrG,YAAYkB,cAAchD,KAAI,SAAAsF,GAAW,OAC5C,wBAAIjE,IAAKiE,EAAYD,OACjB,wBAAImH,UACA,gDACClH,EAAYkH,WAAa,KACzBlH,EAAYiO,SAAWjO,EAAYD,OAEvC8C,EAAMrG,YAAYiB,aAAa/C,KAAI,SAAAoF,GAAU,OAC1C,wBAAI/D,IAAK+D,EAAWC,MAChBmH,WACKlH,EAAYkH,WAAa,IAAM,KAC/BpH,EAAWoH,WAAa,KAC7B,kBAAC8J,GAAD,CACIhR,YAAaA,EACbF,WAAYA,EACZpC,cAAemF,EAAMrG,YAAYkB,cACjCD,aAAcoF,EAAMrG,YAAYiB,aAChCnB,MAAOuG,EAAMrG,YACb1B,QAAS+H,EAAMrG,YAAY1B,QAAQG,QAC/B,SAAAN,GAAC,OAAIA,EAAEqF,cAAgBA,EAAYD,OAC9BpF,EAAEmF,aAAgBA,EAAWC,qBAOjE8C,EAAMrG,YAAYzC,UACf,yBAAKmN,UAAU,mCACX,yBAAKA,UAAU,6BACXoJ,wBAAyB,CAACC,OAASvB,GAAUwB,SAASC,KAAO5N,EAAMrG,YAAYzC,gBAEvF,qCAEH2M,EAAc5H,KACX,kBAAC,GAAD,CACIA,MAAM,EACNC,MAAO2H,EAAc3H,MACrBC,QAAS0H,EAAc1H,QACvB8E,WAAY4C,EAAc5C,WAC1B/D,MAAO2G,EAAc3G,MACrBiE,UAAW0C,EAAc1C,UACzB7E,QAASuH,EAAcvH,UAC3B,yC,0CClVT,SAASzG,GAAmBC,GAC/B,MAAO,CACH6H,UAAW,kBACP7H,EAAS4H,GAAgBC,cAC7BC,cAAe,kBACX9H,EAAS4H,GAAgBE,kBAC7BC,kBAAmB,kBACf/H,EAAS4H,GAAgBG,sBAC7BC,aAAc,kBACVhI,EAAS4H,GAAgBI,iBAC7BC,iBAAkB,kBACdjI,EAAS4H,GAAgBK,qBAG7B9L,gBAAiB,SAAC8D,GAAD,OACbD,EAAS9D,EAAiBC,gBAAgB8D,KAC9C7D,iBAAkB,kBACd4D,EAAS9D,EAAiBE,qBAG9BW,kBAAmB,SAACmD,GAAD,OACfF,EAAStC,GAAmBI,uBAAuBuC,OAAOC,OAAO,GAAI,CAAEJ,WAAW,CAAEF,gBACxFhD,gBAAiB,SAACiD,GAAD,OACbD,EAAStC,GAAmBO,qBAAqBgC,KACrD9C,aAAc,SAAC8C,GAAD,OACVD,EAAStC,GAAmBgB,kBAAkB2B,OAAOC,OAAO,GAAIL,EAAG,CAAED,gBACzE3C,cAAe,SAACiK,GAAD,OACXtH,EAAStC,GAAmBsB,mBAAmB,CAAEsI,eACrDhK,gBAAiB,SAACgK,GAAD,OACbtH,EAAStC,GAAmByB,qBAAqB,CAAEmI,eACvD/J,aAAc,SAAC+J,GAAD,OACVtH,EAAStC,GAAmB4B,kBAAkBe,OAAOC,OAAO,GAAI,CAAEgH,YAAY,CAAEtH,iBAKrF,SAASG,GAAgBC,GAC5B,OAAOC,OAAOC,OAAO,GAAI,CAAEmZ,iBAAkBrZ,EAASsJ,aAAetJ,EAASuJ,U,WChB5EyC,GAAYC,aAAW,SAAArR,GAAK,MAAK,CACnCub,KAAM,CACFmD,SAAU,EACV9N,MAAO,yBACP+N,gBAAiB,wBAErBhQ,SAAU,CACN4C,MAAO,oBACPkK,OAAQ,OACRxL,OAAQ,OACR2O,OAAQ,mCACRC,eAAgB,WAChBC,YAAa,SAEjBC,cAAe,CACXhH,SAAU,WACV0D,OAAQ,QAEZuD,qBAAsB,CAClBjH,SAAU,WACVE,IAAK,EACLgH,KAAM,EACNhP,OAAQ,kBACRiP,SAAU,SACV3N,MAAO,oBACPkK,OAAQ,QAEZ0D,sBAAuB,CACnBP,OAAQ,mCACRC,eAAgB,WAChBL,QAAS,OAEbY,mBAAoB,CAChBR,OAAQ,mCACRC,eAAgB,WAChBL,QAAS,MACTjN,MAAO,OAEX8N,qBAAsB,CAClBT,OAAQ,mCACRC,eAAgB,WAChBL,QAAS,MACTjN,MAAO,MACPoN,gBAAiB,8BACjB/N,MAAO,gCAEX0O,uBAAwB,CACpBV,OAAQ,mCACRC,eAAgB,WAChBL,QAAS,MACTjN,MAAO,MACPoN,gBAAiB,8BACjB/N,MAAO,kCAEX2O,aAAc,CACVX,OAAQ,mCACRC,eAAgB,WAChBL,QAAS,MACTgB,cAAe,OAEnBC,oBAAqB,CACjBb,OAAQ,mCACRC,eAAgB,WAChBL,QAAS,MACTgB,cAAe,MACfb,gBAAiB,6BAErBe,yBAA0B,CACtB9O,MAAO,8BACP+N,gBAAiB,iCACjBgB,aAAc,OACdf,OAAQ,8CAEZgB,KAAM,CACF/H,SAAU,UACV8H,aAAc,MACdhB,gBAAgB,2BAChB/N,MAAO,yBACPW,MAAO,OACP2N,SAAU,SACVzN,WAAY,SACZoO,aAAc,WACdpK,aAAc,MACdjD,YAAa,MACbsN,aAAc,OAElBC,SAAU,CACN,UAAW,CACPzB,OAAQ,gBA0Ed0B,GAAetN,YAAQvN,GAAiBJ,GAAzB2N,EApE8B,SAACxD,GAChD,IAAMyD,EAAUvB,KAD0C,EAElChC,IAAMC,UAAS,GAFmB,oBAEnDlE,EAFmD,KAE7CmE,EAF6C,KAIpDjD,EAAc6C,EAAMvG,MAAMoB,cAAcrB,MAAK,SAAA1B,GAAC,OAAIA,EAAEoF,QAAU8C,EAAMpD,OAAOO,eAC3EF,EAAa+C,EAAMvG,MAAMmB,aAAapB,MAAK,SAAA1B,GAAC,OAAIA,EAAEoF,QAAU8C,EAAMpD,OAAOK,cAEzEjF,EAAM,IAAIhB,KACV+V,EAAQ,IAAI/V,KAAKgB,EAAIvB,cAAeuB,EAAIrB,WAAYqB,EAAIpB,WACxDuB,EAAU6H,EAAMpD,OAAOzE,QAAUtB,GAAamJ,EAAMpD,OAAOzE,SAAW,KACtE6U,IAAc/P,GAAcA,EAAWgQ,cACxC9U,GAAUA,EAAU4U,EACnBhD,EAAW/J,EAAMpD,OAAOI,OAASgD,EAAMpD,OAAOI,MAAMsM,SAAS,YA0BnE,OACI,oCAEI,uBACIjF,UAAWC,YAAKb,EAAQoN,UACxBlP,QAAS,SAAA6D,GAAE,OAAIpF,GAAQ,KACvB,yBAAKiE,UAAWC,YAAKb,EAAQiN,MAAQ,2BAChCvT,EAAc,IAAMA,EAAYkH,UAAY,KAC5CpH,EAAa,IAAMA,EAAWoH,UAAY,KAC1C2I,EAAU,WAAa,KACvBjD,EAAW,YAAc,KACzB/J,EAAMpD,OAAOC,YAAY6G,OAAO5V,QAAQ,MAAO,KAAKA,QAAQ,MAAO,IAAI4V,SAG/EzH,EACG,kBAAC,GAAD,CACIA,MAAM,EACNW,OAAQoD,EAAMpD,OACd/B,cAAemF,EAAMuP,iBAAiB5V,YAAYkB,cAClDD,aAAcoF,EAAMuP,iBAAiB5V,YAAYiB,aACjDnB,MAAOuG,EAAMvG,MACbiS,QA7ChB,SAAyBxT,GACrB8H,EAAM/M,aAAaiF,GACnBkI,GAAQ,IA4CI6L,UAzChB,SAAuB/c,GACnB8Q,EAAM7M,cAAcjE,GACpBkR,GAAQ,IAwCI4L,YArChB,SAAyB9c,GACrB8Q,EAAM5M,gBAAgBlE,GACtBkR,GAAQ,IAoCI8L,SAjChB,SAAsBhd,GAClB8Q,EAAM3M,aAAanE,GACnBkR,GAAQ,IAgCI4J,SA7BhB,WACI5J,GAAQ,MA4BqC,yCA2MtCoD,eAAQvN,GAAiBJ,GAAzB2N,EApMmC,SAACxD,GAC/C,IAAMyD,EAAUvB,KACVpR,EAAQmP,eAF2C,EAGfC,IAAMC,SAAS,CACrDlE,MAAM,EACNC,MAAO,GACPC,QAAS,GACT8E,WAAY,GACZ/D,MAAO,GACPiE,UAAW,SAACjE,GAAD,OAAmBA,EAAMwG,OAAOjM,QAAU,GACrD6E,QAcJ,SAAwCqH,EAAgBzG,GAEpD,GADA0G,EAAiBzN,OAAOC,OAAO,GAAIyN,EAAe,CAAE5H,MAAM,KACtD0H,GAASzG,EAAO,CAChB,IAAM+R,EAAetT,KAAyBuT,WAC9ClP,EAAMlN,gBAAgB,CAAEkD,QAASiZ,EAAazP,YAAY5F,cAAee,UAAWuC,QA5BnC,oBAGlD2G,EAHkD,KAGnCD,EAHmC,KAgCzD,GAAI5D,EAAM1P,MAAMsL,OAAO1M,IACf8Q,EAAMuP,iBAAiB5V,YAAYL,MAAQ0G,EAAM1P,MAAMsL,OAAO1M,GAAI,CAClE,IAAMmK,EAAQ2G,EAAMuP,iBAAiB3X,OAAOyC,WAAU,SAAAvC,GAAC,OAAIA,EAAEwB,MAAQ0G,EAAM1P,MAAMsL,OAAO1M,MAExF,OADA8Q,EAAMnN,kBAAkBmN,EAAM1P,MAAMsL,OAAO1M,IAEvC,yBAAKmV,UAAWZ,EAAQ4I,MACnBhT,EAAQ,EACL,oCACI,kBAAC+Q,GAAA,EAAD,CACIxI,MAAO,CAACkJ,UAAWha,EAAMgR,QAAQ,KACjCL,QAAQ,KAAK0N,MAAM,UAFvB,oBAKA,kBAAC/E,GAAA,EAAD,CACIxI,MAAO,CAACkJ,UAAWha,EAAMgR,QAAQ,GAAIsN,OAAQ,UAAWC,eAAgB,aACxE5N,QAAQ,QAAQ0N,MAAM,SACtBxN,QAAS,SAAA6D,GAAOxF,EAAMxO,QAAQyH,KAAK,OAHvC,mCAOJ,sCAOpB,IAAMjB,EAAM,IAAIhB,KACV+V,EAAQ,IAAI/V,KAAKgB,EAAIvB,cAAeuB,EAAIrB,WAAYqB,EAAIpB,WAExDma,EAAQ/Q,EAAM9B,YAEd8S,EAAmB,IAAIha,KAAK+Z,EAAMta,cAAesa,EAAMpa,WAAY,GACnEsa,EAAkB,IAAIja,KAAK+Z,EAAMta,cAAesa,EAAMpa,WAAa,EAAG,GACtEua,EAAiB,IAAIla,KACvBga,EAAiBva,cAAeua,EAAiBra,WACjD,EAAIqa,EAAiBG,UACnBC,EAAgB,IAAIpa,KACtBia,EAAgBxa,cAAewa,EAAgBta,WAC/Csa,EAAgBra,WAAa,EAAIqa,EAAgBE,WAC/CE,EAAc,IAAIra,KACpBoa,EAAc3a,cAAe2a,EAAcza,WAC3Cya,EAAcxa,UAAY,GAExB0a,EAAuB,GACzBC,EAAe,GACnBD,EAAMrY,KAAKsY,GACX,IAAK,IAAIC,EAAKN,EACNM,EAAG5F,WAAawF,EAAcxF,UAC9B4F,EAAK,IAAIxa,KAAKwa,EAAG/a,cAAe+a,EAAG7a,WAAY6a,EAAG5a,UAAY,GAC9D,GAAK2a,EAAK9Z,SACV8Z,EAAO,GACPD,EAAMrY,KAAKsY,IAEfA,EAAKtY,KAAKuY,GAGd,IAAMC,EAAUzR,EAAMuP,iBAAiB5V,YAAY1B,QAAQG,QAAO,SAAAN,GAC9D,IAAKA,EAAEK,QACH,OAAO,EAEX,IAAM5B,EAAI,IAAIS,KAAKc,EAAEK,SACrB,OAAI+Y,GAAkB3a,GAAKA,EAAI8a,KAOnC,OACI,yBAAKhN,UAAWC,YAAKb,EAAQ4I,OACzB,2BAAOoB,wBAAyB,CAACC,OAAQ1N,EAAMuP,iBAAiB5V,YAAY0B,iBAC5E,yBAAKgJ,UAAWC,YAAKb,EAAQoM,gBACzB,yBAAKxL,UAAWC,YAAKb,EAAQqM,uBACzB,kBAACrL,GAAA,EAAD,CAAY9C,QAAS,SAAA6D,GAAE,OAAIxF,EAAMrC,cAC7B,kBAAC,KAAD,MAAqB,kBAACyM,GAAA,EAAD,CAAY3I,QAAQ,UAAUG,MAAO,CAACC,WAAY,QAAlD,UAEzB,kBAAC4C,GAAA,EAAD,CAAY9C,QAAS,SAAA6D,GAAE,OAAIxF,EAAMjC,qBAC7B,kBAAC,KAAD,OAEJ,kBAAC0G,GAAA,EAAD,CAAY9C,QAAS,SAAA6D,GAAE,OAAIxF,EAAMnC,sBAC7B,kBAAC,KAAD,OAEJ,kBAAC4G,GAAA,EAAD,CAAY9C,QAAS,SAAA6D,GAAE,OAAIxF,EAAMpC,kBAC7B,kBAAC,KAAD,OAEJ,kBAAC6G,GAAA,EAAD,CAAY9C,QAAS,SAAA6D,GAAE,OAAIxF,EAAMlC,iBAC7B,kBAAC,KAAD,OAEJ,kBAACsM,GAAA,EAAD,CAAY3I,QAAQ,KAAKhD,QAAQ,SAASmD,MAAO,CAACC,WAAY,QAC1D7B,EAAM9B,YAAYwT,mBACbhF,UAAkBiF,cAAgBjF,UAAUkF,UAAalF,UAAkBmF,iBAAmB,KAC/F,CAACC,KAAM,UAAWf,MAAO,UAEjC,kBAAC3G,GAAA,EAAD,CAAY3I,QAAQ,KAAKhD,QAAQ,SAASmD,MAAO,CAACC,WAAY,MAAOuN,OAAQ,WACzEzN,QAlHpB,WACI,IAAMsN,EAAetT,KAAyBuT,WAC9CtL,EAAiBzN,OAAOC,OAAO,GAAIyN,EAAe,CAC9C5H,MAAM,EACNC,MAAO,kBACPC,QAAS,GACT8E,WAAY,aACZ/D,MAAO+R,EAAazP,YAAY7F,YAAYnB,UA4GhCwH,EAAMuP,iBAAiB5V,YAAYnB,QAG/C,2BAAO6L,UAAWC,YAAKb,EAAQhE,WAC3B,+BACI,4BACI,wBAAI4E,UAAWC,YAAKb,EAAQwM,yBAC5B,wBAAI5L,UAAWC,YAAKb,EAAQ0M,uBAA5B,OACA,wBAAI9L,UAAWC,YAAKb,EAAQyM,qBAA5B,OACA,wBAAI7L,UAAWC,YAAKb,EAAQyM,qBAA5B,OACA,wBAAI7L,UAAWC,YAAKb,EAAQyM,qBAA5B,OACA,wBAAI7L,UAAWC,YAAKb,EAAQyM,qBAA5B,OACA,wBAAI7L,UAAWC,YAAKb,EAAQyM,qBAA5B,OACA,wBAAI7L,UAAWC,YAAKb,EAAQ2M,yBAA5B,SAGR,+BACKkB,EAAMzZ,KAAI,SAAA0Z,GAAI,OACX,wBAAIrY,IAAKqY,EAAK,GAAG3F,WACb,wBAAIvH,UAAWC,YAAKb,EAAQ4M,gBAC3BkB,EAAK1Z,KAAI,SAAC2Z,EAAUnY,GACjB,IAAM0Y,EAAO,IAAI/a,KAAKwa,EAAG/a,cAAe+a,EAAG7a,WAAY6a,EAAG5a,UAAY,GACtE,OACI,wBAAIsC,IAAKsY,EAAGQ,cACR3N,UAAWC,YAAe,IAAVjL,GAAyB,IAAVA,EAAcoK,EAAQ8M,oBAAqB9M,EAAQ4M,eAClF,yBAAKzO,MAAO,CAACiH,SAAU,aACnB,yBACIxE,UAAWmN,GAAMzE,GAASA,EAAQgF,EAAOzN,YAAKb,EAAQ+M,0BAA4B,GAClF5O,MAAO,CAACiH,SAAU,WAAYE,IAAK,IAAKD,MAAO,MAC9C0I,EAAG5a,WAER,yBAAKgL,MAAO,CAACqQ,WAAY,OAAQC,UAAW,SACvCT,EAAQrZ,QAAO,SAAAN,GACZ,IAAMvB,EAAI,IAAIS,KAAKc,EAAEK,SACrB,OAAIqZ,GAAMjb,GAAKA,EAAIwb,KAKpBla,KAAI,SAAAC,GAAC,OACJ,kBAACgZ,GAAD,CACIrX,MAAOuG,EAAMuP,iBAAiB5V,YAC9BT,IAAKpB,EAAEwB,IACPsD,OAAQ9E,mBAWnD+L,EAAc5H,KACX,kBAAC,GAAD,CACIA,MAAM,EACNC,MAAO2H,EAAc3H,MACrBC,QAAS0H,EAAc1H,QACvB8E,WAAY4C,EAAc5C,WAC1B/D,MAAO2G,EAAc3G,MACrBiE,UAAW0C,EAAc1C,UACzB7E,QAASuH,EAAcvH,UAC3B,yC,qDCrXT,SAAS6V,GAAuB1Y,GACnC,MAAQ,CACJjB,KAAMiB,EAAMjB,MAAQ,GACpBoC,aAAcnB,EAAMmB,cAAgB,GACpCC,cAAepB,EAAMoB,eAAiB,GACtCC,KAAMrB,EAAMqB,MAAQ,GACpBC,iBAAkBtB,EAAMsB,eACxBC,cAAevB,EAAMuB,YACrBC,eAAgBxB,EAAMwB,aACtBC,cAAezB,EAAMyB,YACrBC,gBAAiB1B,EAAM0B,cACvBC,WAAY3B,EAAM2B,YAAc,GAChCC,cAAe5B,EAAM4B,eAAiB,GACtCnE,UAAWuC,EAAMvC,WAAa,GAC9Be,QAAUwB,EAAMxB,SAAWwB,EAAMxB,QAAQJ,KAAI,SAAAC,GAAC,OA5Bdsa,EA4B0Cta,EA3BtE3B,OAAOC,OAAOgc,EAAO9Y,IAAM,CAAEA,IAAK8Y,EAAO9Y,KAAQ,GAAI,CACzDnB,QAASia,EAAOja,SAAW,GAC3B8E,WAAYmV,EAAOnV,YAAc,GACjCE,YAAaiV,EAAOjV,aAAe,GACnCH,MAAOoV,EAAOpV,OAAS,GACvBlC,KAAMsX,EAAOtX,MAAQ,GACrB+B,YAAauV,EAAOvV,aAAe,GACnCC,QAASsV,EAAOtV,SAAW,GAC3BC,KAAMqV,EAAOrV,MAAQ,KATtB,IAAiCqV,MA4BkD,IA8C1F,SAASC,GAAcC,GACnB,GAAIA,EAAKhiB,MAAM,kBAAoBgiB,EAAKhiB,MAAM,cAC1C,MAAM,IAAIgY,MAAM,0BAKjB,SAASiK,GAAmB9Y,GAC/B,GAA0B,kBAAfA,EAAMjB,KACb,MAAM,IAAI8P,MAAM,uCAEpB,IAAI7O,EAAMmB,eAAgBrL,MAAMijB,QAAQ/Y,EAAMmB,cAgB1C,MAAM,IAAI0N,MAAM,8CAEpB,GAjBI7O,EAAMmB,aAAaxB,SAAQ,SAAAtB,GACvB,GAAkB,OAAdA,EAAEsT,cAAkC,IAAdtT,EAAEsT,SAA2C,kBAAdtT,EAAEsT,QACvD,MAAM,IAAI9C,MAAM,wDAEpB,GAAoB,OAAhBxQ,EAAEuM,gBAAsC,IAAhBvM,EAAEuM,WAA+C,kBAAhBvM,EAAEuM,UAC3D,MAAM,IAAIiE,MAAM,0DAEpB,GAAoB,OAAhBxQ,EAAEmV,gBAAsC,IAAhBnV,EAAEmV,WAA+C,mBAAhBnV,EAAEmV,UAC3D,MAAM,IAAI3E,MAAM,2DAEpB,GAAuB,kBAAZxQ,EAAEoF,MACT,MAAM,IAAIoL,MAAM,4DAMxB7O,EAAMoB,gBAAiBtL,MAAMijB,QAAQ/Y,EAAMoB,eAa3C,MAAM,IAAIyN,MAAM,+CAEpB,GAdI7O,EAAMoB,cAAczB,SAAQ,SAAAtB,GACxB,GAAkB,OAAdA,EAAEsT,cAAkC,IAAdtT,EAAEsT,SAA2C,kBAAdtT,EAAEsT,QACvD,MAAM,IAAI9C,MAAM,yDAEpB,GAAoB,OAAhBxQ,EAAEuM,gBAAsC,IAAhBvM,EAAEuM,WAA+C,kBAAhBvM,EAAEuM,UAC3D,MAAM,IAAIiE,MAAM,2DAEpB,GAAuB,kBAAZxQ,EAAEoF,MACT,MAAM,IAAIoL,MAAM,6DAMxB7O,EAAMqB,OAAQvL,MAAMijB,QAAQ/Y,EAAMqB,MAUlC,MAAM,IAAIwN,MAAM,sCAEpB,GAXI7O,EAAMqB,KAAK1B,SAAQ,SAAAtB,GACf,GAAoB,OAAhBA,EAAEuM,gBAAsC,IAAhBvM,EAAEuM,WAA+C,kBAAhBvM,EAAEuM,UAC3D,MAAM,IAAIiE,MAAM,kDAEpB,GAAuB,kBAAZxQ,EAAEoF,MACT,MAAM,IAAIoL,MAAM,mDAMQ,mBAAzB7O,EAAMsB,eACb,MAAM,IAAIuN,MAAM,kDAEpB,GAAiC,mBAAtB7O,EAAMuB,YACb,MAAM,IAAIsN,MAAM,+CAEpB,GAAkC,mBAAvB7O,EAAMwB,aACb,MAAM,IAAIqN,MAAM,gDAEpB,GAAiC,mBAAtB7O,EAAMyB,YACb,MAAM,IAAIoN,MAAM,+CAEpB,GAAmC,mBAAxB7O,EAAM0B,cACb,MAAM,IAAImN,MAAM,iDAEpB,GAAgC,kBAArB7O,EAAM2B,WACb,MAAM,IAAIkN,MAAM,6CAGpB,GADA+J,GAAc5Y,EAAM2B,YACe,kBAAxB3B,EAAM4B,cACb,MAAM,IAAIiN,MAAM,gDAGpB,GADA+J,GAAc5Y,EAAM4B,eACW,kBAApB5B,EAAMvC,UACb,MAAM,IAAIoR,MAAM,4CAGpB,IAAI7O,EAAMxB,UAAW1I,MAAMijB,QAAQ/Y,EAAMxB,SAGrC,MAAM,IAAIqQ,MAAM,yCAGpB,OALI7O,EAAMxB,QAAQmB,SAAQ,SAAAtB,GAAC,OA7HxB,SAA6Bsa,GAChC,GAA8B,kBAAnBA,EAAOja,QACd,MAAM,IAAImQ,MAAM,0CAEpB,GAAiC,kBAAtB8J,EAAOnV,WACd,MAAM,IAAIqL,MAAM,6CAEpB,GAAkC,kBAAvB8J,EAAOjV,YACd,MAAM,IAAImL,MAAM,8CAEpB,IAAI8J,EAAOpV,QAASzN,MAAMijB,QAAQJ,EAAOpV,OAOrC,MAAM,IAAIsL,MAAM,uCAEpB,GARI8J,EAAOpV,MAAM5D,SAAQ,SAAAtB,GACjB,GAAiB,kBAANA,EACP,MAAM,IAAIwQ,MAAM,6CAMxB8J,EAAOtX,OAAQvL,MAAMijB,QAAQJ,EAAOtX,MAOpC,MAAM,IAAIwN,MAAM,sCAEpB,GARI8J,EAAOtX,KAAK1B,SAAQ,SAAAtB,GAChB,GAAiB,kBAANA,EACP,MAAM,IAAIwQ,MAAM,2CAMM,kBAAvB8J,EAAOvV,YACd,MAAM,IAAIyL,MAAM,8CAEpB,GAA8B,kBAAnB8J,EAAOtV,QACd,MAAM,IAAIwL,MAAM,0CAEpB,GAA2B,kBAAhB8J,EAAOrV,KACd,MAAM,IAAIuL,MAAM,uCAEpB,OAAO8J,EAwFwBK,CAAoB3a,MAK5C2B,E,WC5ILyI,GAAYC,aAAW,SAAArR,GAAK,MAAK,CACnCub,KAAM,CACFmD,SAAU,EACV9N,MAAO,yBACP+N,gBAAiB,uBACjBpN,MAAO,OACPkK,OAAQ,QAEZmG,OAAQ,CACJnG,OAAQ,OACR1D,SAAU,YAEd8J,WAAY,CACRlU,QAAS,OACT4D,MAAO,oBACPkK,OAAQ,sBAEZqG,QAAS,CACL/J,SAAU,WACV9H,OAAQjQ,EAAMgR,QAAQ,GACtBiO,KAAMjf,EAAMgR,QAAQ,GACpBiH,IAAKjY,EAAMgR,QAAQ,GAAK,IAE5B8G,UAAW,CACPC,SAAU,WACV9H,OAAQjQ,EAAMgR,QAAQ,GACtBgH,MAAOhY,EAAMgR,QAAQ,GACrBiH,IAAKjY,EAAMgR,QAAQ,GAAK,QAgJjB0B,eAAQvN,GAAiBJ,GAAzB2N,EA3I+B,SAACxD,GAC3C,IAAMyD,EAAUvB,KACVpR,EAAQmP,eAFuC,EAGCC,IAAMC,UAAS,GAHhB,oBAG9C0S,EAH8C,KAGzBC,EAHyB,OAIf5S,IAAMC,SAAS,IAJA,oBAI9C4S,EAJ8C,KAIjCC,EAJiC,OAKnB9S,IAAMC,SAAS,GALI,oBAK9C8S,EAL8C,KAKnCC,EALmC,KA0CrD,GAAIlT,EAAM1P,MAAMsL,OAAO1M,IACf8Q,EAAMrG,YAAYL,MAAQ0G,EAAM1P,MAAMsL,OAAO1M,GAAI,CACjD,IAAMmK,EAAQ2G,EAAMpI,OAAOyC,WAAU,SAAAvC,GAAC,OAAIA,EAAEwB,MAAQ0G,EAAM1P,MAAMsL,OAAO1M,MAQvE,OAPA8Q,EAAMnN,kBAAkBmN,EAAM1P,MAAMsL,OAAO1M,IAG3C4M,YAAW,WACPoX,EAAa,KACd,IAGC,yBAAK7O,UAAWZ,EAAQ4I,MACnBhT,EAAQ,EACL,oCACI,kBAAC+Q,GAAA,EAAD,CACIxI,MAAO,CAACkJ,UAAWha,EAAMgR,QAAQ,KACjCL,QAAQ,KAAK0N,MAAM,UAFvB,oBAKA,kBAAC/E,GAAA,EAAD,CACIxI,MAAO,CAACkJ,UAAWha,EAAMgR,QAAQ,GAAIsN,OAAQ,UAAWC,eAAgB,aACxE5N,QAAQ,QAAQ0N,MAAM,SACtBxN,QAAS,SAAA6D,GAAOxF,EAAMxO,QAAQyH,KAAK,OAHvC,mCAOJ,sCAOpB,OACI,yBAAKoL,UAAWC,YAAKb,EAAQ4I,OACzB,yBAAKhI,UAAWC,YAAKb,EAAQiP,SACzB,kBAACtI,GAAA,EAAD,CAAY3I,QAAQ,KAAK0N,MAAM,SAASvN,MAAO,CAACkJ,UAAW,QAAS9K,EAAMrG,YAAYnB,MACtF,kBAACgJ,GAAA,EAAD,CACI6C,UAAWC,YAAKb,EAAQmP,SACxBnR,QAAQ,YACRC,MAAM,UACNM,SAAwB,IAAdiR,EACVtR,QA3EhB,WACI,IACI,IAAMjK,EAAOyb,KAAOC,SAASL,GACzBrb,IACA6a,GAAmB7a,GACnBsI,EAAM1M,oBAAoB6C,OAAOC,OAAO,GAAIsB,EAAM,CAAE4B,IAAK0G,EAAMrG,YAAYL,QAIjF,MAAOtJ,GACLgQ,EAAM/N,gBAAgB,CAClBgK,MAAM,EACNC,MAAO,QACPC,QAASnM,EAAEmM,SAAW3F,OAAOxG,GAC7BoM,cAAc,EACdC,kBAAkB,EAClBC,QAAS,kBAAM0D,EAAM9N,yBA4DjB,kBAAC,KAAD,MACA,kBAACkY,GAAA,EAAD,CAAY3I,QAAQ,QAAQG,MAAO,CAACC,WAAY/Q,EAAMgR,QAAQ,KAA9D,SAIH9B,EAAMpI,OAAOH,OAAS,EACnB,kBAAC+J,GAAA,EAAD,CACI6C,UAAWC,YAAKb,EAAQmF,WACxBnH,QAAQ,WACRC,MAAM,YACNC,QAAS,SAAA6D,GAAE,OAAIsN,GAAuB,KACtC,kBAAC,KAAD,CAAYpR,MAAM,cAClB,kBAAC0I,GAAA,EAAD,CAAY3I,QAAQ,QAAQC,MAAM,YAAYE,MAAO,CAACC,WAAY/Q,EAAMgR,QAAQ,KAAhF,WAIJ,sCAGR,6BACI,kBAAC,gBAAD,CACIuC,UAAWC,YAAKb,EAAQkP,YACxBzV,MAAK,8BACDiW,KAAOE,SAASlB,GAAuBnS,EAAMrG,aAAc,CAAC2Z,UAAW,OAE3EC,QAAS,CACLC,KAAM,OACN1iB,MAAO,WACP2iB,aAAa,EACbC,cAAc,GAElBtS,SA/EhB,SAA4BuS,EAAajc,EAAWwF,GAChD8V,EAAe9V,GACfgW,EAAaD,EAAY,OAgFpBJ,EACG,kBAAC,GAAD,CACI5W,KAAM4W,EACN3W,MAAM,eACNC,QAAQ,yCACRE,kBAAkB,EAClB4F,mBAAmB,SACnBoE,oBAAqB,4CACrBD,oBAAoB,eACpBJ,IACI,kBAAC6F,GAAA,EAAD,CAAKC,KAAK,QAAQrK,QAAQ,QAAQsK,aAAW,SAASrK,MAAM,YAAYE,MAAO,CAACb,OAAQ,SACpF,kBAAC,KAAD,OAGRzE,QAvGhB,SAA+BqH,GAC3BmP,GAAuB,GACnBnP,GACA3D,EAAMjN,YAAYiN,EAAMrG,YAAYL,QAqGhC,yCCtKV4I,I,OAAYC,aAAW,SAAArR,GAAK,MAAK,CACnCub,KAAM,CACFmD,SAAU,EACV9N,MAAO,yBACP+N,gBAAiB,uBACjBpN,MAAO,OACPkK,OAAQ,QAEZmG,OAAQ,CACJnG,OAAQ,OACR1D,SAAU,YAEd8J,WAAY,CACRlU,QAAS,OACT4D,MAAO,oBACPkK,OAAQ,sBAEZqG,QAAS,CACL/J,SAAU,WACV9H,OAAQjQ,EAAMgR,QAAQ,GACtBiO,KAAMjf,EAAMgR,QAAQ,GACpBiH,IAAKjY,EAAMgR,QAAQ,GAAK,IAE5B8G,UAAW,CACPC,SAAU,WACV9H,OAAQjQ,EAAMgR,QAAQ,GACtBgH,MAAOhY,EAAMgR,QAAQ,GACrBiH,IAAKjY,EAAMgR,QAAQ,GAAK,SA0GjB0B,eAAQvN,GAAiBJ,GAAzB2N,EArGmC,SAACxD,GAC/C,IF+GoC4T,EE/G9BnQ,EAAUvB,KACVpR,EAAQmP,eAF2C,EAGHC,IAAMC,UAAS,GAHZ,oBAGlD0T,EAHkD,KAG7BC,EAH6B,OAInB5T,IAAMC,SAAS,IAJI,oBAIlD4S,EAJkD,KAIrCC,EAJqC,OAKvB9S,IAAMC,SAAS,GALQ,oBAKlD8S,EALkD,KAKvCC,EALuC,KAwCzD,OACI,yBAAK7O,UAAWC,YAAKb,EAAQ4I,OACzB,yBAAKhI,UAAWC,YAAKb,EAAQiP,SACzB,kBAACtI,GAAA,EAAD,CAAY3I,QAAQ,KAAK0N,MAAM,SAASvN,MAAO,CAACkJ,UAAW,QAAS,wBACpE,kBAACtJ,GAAA,EAAD,CACI6C,UAAWC,YAAKb,EAAQmP,SACxBnR,QAAQ,YACRC,MAAM,UACNM,SAAwB,IAAdiR,EACVtR,QA1ChB,WACI,IACI,IAAMjK,EAAOyb,KAAOC,SAASL,GAC7B,IAAIrb,EAIA,MAAM,IAAI4Q,MAAM,0CFsHzB,SAA6BsL,GAChC,IAAKA,EAAKrV,OACN,MAAM,IAAI+J,MAAM,yCAEpB,GAAuC,kBAA5BsL,EAAKrV,OAAOC,YACnB,MAAM,IAAI8J,MAAM,qDAEpB,GAAgC,kBAArBsL,EAAKrV,OAAOpO,KACnB,MAAM,IAAImY,MAAM,8CAEpB,GAAoC,kBAAzBsL,EAAKrV,OAAOnO,SACnB,MAAM,IAAIkY,MAAM,kDAGpB,IAAKsL,EAAKnV,QACN,MAAM,IAAI6J,MAAM,0CAEpB,GAAuC,mBAA5BsL,EAAKnV,QAAQC,WACpB,MAAM,IAAI4J,MAAM,sDAEpB,GAA+C,kBAApCsL,EAAKnV,QAAQE,mBACpB,MAAM,IAAI2J,MAAM,6DAEpB,GAAIsL,EAAKnV,QAAQE,mBAAqB,GAClC,MAAM,IAAI2J,MAAM,6FAEpB,GAAqC,mBAA1BsL,EAAKnV,QAAQsV,SACpB,MAAM,IAAIzL,MAAM,oDEpJR0L,CAAoBtc,GACpBsI,EAAMnO,gBAAgBsE,OAAOC,OAAO,GAAIsB,IAI9C,MAAO1H,GACLgQ,EAAM/N,gBAAgB,CAClBgK,MAAM,EACNC,MAAO,QACPC,QAASnM,EAAEmM,SAAW3F,OAAOxG,GAC7BoM,cAAc,EACdC,kBAAkB,EAClBC,QAAS,kBAAM0D,EAAM9N,yBA2BjB,kBAAC,KAAD,MACA,kBAACkY,GAAA,EAAD,CAAY3I,QAAQ,QAAQG,MAAO,CAACC,WAAY/Q,EAAMgR,QAAQ,KAA9D,SAIJ,kBAACN,GAAA,EAAD,CACI6C,UAAWC,YAAKb,EAAQmF,WACxBnH,QAAQ,WACRC,MAAM,YACNC,QAAS,SAAA6D,GAAE,OAAIsO,GAAuB,KACtC,kBAAC,KAAD,CAAYpS,MAAM,cAClB,kBAAC0I,GAAA,EAAD,CAAY3I,QAAQ,QAAQC,MAAM,YAAYE,MAAO,CAACC,WAAY/Q,EAAMgR,QAAQ,KAAhF,uBAKR,6BACI,kBAAC,gBAAD,CACIuC,UAAWC,YAAKb,EAAQkP,YACxBzV,MAAK,4BACDiW,KAAOE,UF0CSO,EE1CwB5T,EAAMnB,UF2C1D,CACJN,OAAQ,CACJC,YAAaoV,EAAKrV,QAAUqV,EAAKrV,OAAOC,YACpCoV,EAAKrV,OAAOC,YAAc,GAC9BrO,KAAMyjB,EAAKrV,QAAUqV,EAAKrV,OAAOpO,KAC7ByjB,EAAKrV,OAAOpO,KAAO,GACvBC,SAAUwjB,EAAKrV,QAAUqV,EAAKrV,OAAOnO,SACjCwjB,EAAKrV,OAAOnO,SAAW,IAE/BqO,QAAS,CACLC,cAAekV,EAAKnV,UAAWmV,EAAKnV,QAAQC,YAC5CC,mBAAoBiV,EAAKnV,SAAWmV,EAAKnV,QAAQE,mBAC7CiV,EAAKnV,QAAQE,mBAAqB,GACtCoV,YAAaH,EAAKnV,UAAWmV,EAAKnV,QAAQsV,aExD4B,CAACT,UAAW,OAE1EC,QAAS,CACLC,KAAM,OACN1iB,MAAO,WACP2iB,aAAa,EACbC,cAAc,GAElBtS,SA3ChB,SAA4BuS,EAAajc,EAAWwF,GAChD8V,EAAe9V,GACfgW,EAAaD,EAAY,OA4CpBY,EACG,kBAAC,GAAD,CACI5X,KAAM4X,EACN3X,MAAM,oBACNC,QAAS,8FACTE,kBAAkB,EAClB4F,mBAAmB,QACnBoE,oBAAqB,+CACrBD,oBAAoB,oBACpBJ,IACI,kBAAC6F,GAAA,EAAD,CAAKC,KAAK,QAAQrK,QAAQ,QAAQsK,aAAW,oBAAoBrK,MAAM,YAAYE,MAAO,CAACb,OAAQ,SAC/F,kBAAC,KAAD,OAGRzE,QAnEhB,SAAuCqH,GACnCmQ,GAAuB,GACnBnQ,GACA3D,EAAMjO,sBAiEF,yCCxHVmQ,GAAYC,aAAW,SAAArR,GAAK,MAAK,CACnCmjB,IAAK,CACDxV,QAAS,YAiCjB,IA0Ee+E,eAAQvN,GAAiBJ,GAAzB2N,EA1EiB,SAACxD,GAC7B,IAAMyD,EAAUvB,KAqDhB,OAjFJ,SAAqBgS,EAAsBC,GACvC,IAAMC,EAAgBC,mBAGtBC,qBAAU,WACNF,EAAcG,QAAUL,IAGzB,CAACA,IAGJI,qBAAU,WAIN,GAAc,OAAVH,EAAgB,CAChB,IAAIjlB,EAAKslB,aAJb,WACIJ,EAAcG,YAGaJ,GAG3B,OAAO,kBAAMM,cAAcvlB,OAIhC,CAACilB,IAQJO,EACI,WACQ1U,EAAMnB,YACNnG,QAAQI,IAAI,kBAAoB,IAAI9B,MACpClH,IACKyL,MAAK,WACF,IAAIwY,GAAW,EACXY,EAAoB,GAClBzV,EAAQvD,KACd,GAAIuD,GAASc,EAAMnB,UAAUJ,QAAS,CAClC,IAAM1E,EAAQmF,EAAMgQ,WACpB,GAAIlP,EAAMnB,UAAUJ,QAAQsV,UAAYha,EAAMyF,YAAY5H,OAAOH,OAAS,EAAG,CACzE,IAAM4B,GAASc,KAAKC,IAAI,EAAGL,EAAMyF,YAAY5H,OACxCyC,WAAU,SAAAvC,GAAC,OAAIA,EAAEwB,MAAQS,EAAMyF,YAAY5F,kBAAkB,GAC9DG,EAAMyF,YAAY5H,OAAOH,OAC7Bsc,GAAW,EACXY,EAAoB5a,EAAMyF,YAAY5H,OAAOyB,GAAOC,KAG5D,IAAM6K,EAAW5S,EAAeC,IACf,WAAb2S,GAAsC,SAAbA,IACrB4P,EACAviB,GAAQyH,KAAR,WAAiBkL,EAAjB,YAA6BwQ,IAE7B3U,EAAMzM,yBAIjBwI,OAAM,SAAAlM,GACH6I,QAAQI,IAAIjJ,EAAIsM,eAIhC6D,EAAMnB,WAAamB,EAAMnB,UAAUJ,SAC/BuB,EAAMnB,UAAUJ,QAAQC,WAC6B,KAApDsB,EAAMnB,UAAUJ,QAAQE,oBAAsB,IAC/C,MAKR2V,qBAAU,WAENxY,YAAW,WACPkE,EAAMzM,uBACP,OAGJ,IAGC,yBAAK8Q,UAAWC,YAAKb,EAAQwQ,MACzB,kBAACW,EAAA,EAAD,MACA,kBAACC,EAAA,EAAD,CAAe/jB,MAAOA,GAClB,kBAAC,GAAD,MACA,kBAAC,IAAD,KACI,kBAAC,IAAD,CAAOgkB,KAAK,IAAIC,OAAK,EAACnQ,UAAWoQ,KACjC,kBAAC,IAAD,CAAOF,KAAK,eAAelQ,UAAWoQ,KACtC,kBAAC,IAAD,CAAOF,KAAK,iBAAiBlQ,UAAWqQ,KACxC,kBAAC,IAAD,CAAOH,KAAK,aAAalQ,UAAWsQ,KACpC,kBAAC,IAAD,CAAOJ,KAAK,WAAWlQ,UAAWuQ,MAErCnV,EAAMpB,YAAY3C,KACf,kBAAC,GAAkB+D,EAAMpB,aACzB,0CCtIdwW,GAAcC,QACW,cAA7B1nB,OAAOC,SAAS0nB,UAEe,UAA7B3nB,OAAOC,SAAS0nB,UAEhB3nB,OAAOC,SAAS0nB,SAAShlB,MACvB,2DA8CN,SAASilB,GAAgBC,EAAeC,GACtC/I,UAAUgJ,cACPC,SAASH,GACTja,MAAK,SAAAqa,GACJA,EAAaC,cAAgB,WAC3B,IAAMC,EAAmBF,EAAaG,WACd,MAApBD,IAGJA,EAAiBE,cAAgB,WACA,cAA3BF,EAAiB/b,QACf2S,UAAUgJ,cAAcO,YAI1Bvd,QAAQI,IACN,iHAKE2c,GAAUA,EAAOS,UACnBT,EAAOS,SAASN,KAMlBld,QAAQI,IAAI,sCAGR2c,GAAUA,EAAOU,WACnBV,EAAOU,UAAUP,WAO5B7Z,OAAM,SAAAC,GACLtD,QAAQsD,MAAM,4CAA6CA,MCvFjE,sBAAC,sBAAAvN,EAAA,6DACGgC,IADH,KAGG2lB,IAHH,OAAA3nB,EAAA,KAIQ,IAJR,SAI8B0Q,KAJ9B,yBAIiBD,MAJjB,WAKW,kBAAC,IAAD,CAAiB1N,QAASA,IACtB,kBAAC,GAAD,OANf,uDASOqd,SAASC,eAAe,QAT/B,KAGYuH,OAHZ,gEAAD,GDUO,SAAkBZ,GACvB,GAA6C,kBAAmB/I,UAAW,CAMzE,GAJkB,IAAI4J,IACnBC,IACD5oB,OAAOC,SAAS4oB,MAEJC,SAAW9oB,OAAOC,SAAS6oB,OAIvC,OAGF9oB,OAAO+oB,iBAAiB,QAAQ,WAC9B,IAAMlB,EAAK,UAAMe,IAAN,sBAEPnB,KAgEV,SAAiCI,EAAeC,GAE9CkB,MAAMnB,GACHja,MAAK,SAAAqb,GAEJ,IAAMC,EAAcD,EAASE,QAAQ9c,IAAI,gBAEnB,MAApB4c,EAASG,QACO,MAAfF,IAA8D,IAAvCA,EAAYhK,QAAQ,cAG5CH,UAAUgJ,cAAcsB,MAAMzb,MAAK,SAAAqa,GACjCA,EAAaqB,aAAa1b,MAAK,WAC7B5N,OAAOC,SAASspB,eAKpB3B,GAAgBC,EAAOC,MAG1B1Z,OAAM,WACLrD,QAAQI,IACN,oEArFAqe,CAAwB3B,EAAOC,GAI/B/I,UAAUgJ,cAAcsB,MAAMzb,MAAK,WACjC7C,QAAQI,IACN,iHAMJyc,GAAgBC,EAAOC,OCvB/BC,K","file":"static/js/main.1ee33b6c.chunk.js","sourcesContent":["// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport PouchDB from 'pouchdb-browser';\r\nimport PouchDBFind from 'pouchdb-find';\r\n\r\n\r\nconst dbBaseName = window.location.pathname.replace(/\\//g, '_');\r\n\r\nPouchDB.plugin(PouchDBFind);\r\nPouchDB.plugin(require('pouchdb-erase'));\r\n\r\nlet remoteDb: PouchDB.Database | null = null;\r\nlet rep: PouchDB.Replication.Sync<{}> | null = null;\r\nconst localDb = new PouchDB(`kanban-board-v1@${dbBaseName}`, { auto_compaction: true });\r\nconst localConfigDb = new PouchDB(`kanban-board-config-v1@${dbBaseName}`, { auto_compaction: true });\r\n\r\n\r\nasync function startSync() {\r\n    if (remoteDb) {\r\n        const localDocs = await localDb.allDocs({});\r\n        const remoteDocs = remoteDb ? await remoteDb.allDocs({}) : null;\r\n        const idSet = new Set<string>();\r\n        for (const doc of localDocs.rows) {\r\n            idSet.add(doc.id);\r\n        }\r\n        if (remoteDocs) {\r\n            for (const doc of remoteDocs.rows) {\r\n                idSet.add(doc.id);\r\n            }\r\n        }\r\n\r\n        rep = localDb.sync(remoteDb, {\r\n            live: true,\r\n            retry: true,\r\n            doc_ids: Array.from(idSet.values()),\r\n        })\r\n            .on('change', change => {\r\n                // something changed!\r\n            })\r\n            .on('paused', info => {\r\n                // replication was paused, usually because of a lost connection\r\n            })\r\n            .on('active' as any, info => {\r\n                // TODO: TypeScript reports the error that parameter 'active' is invalid.\r\n                // replication was resumed\r\n            })\r\n            .on('complete', info => {\r\n                // replication was canceled!\r\n            })\r\n            .on('error', err => {\r\n                // totally unhandled error (shouldn't happen)\r\n            });\r\n    }\r\n}\r\n\r\n\r\nexport async function restartSync() {\r\n    if (rep) {\r\n        try {\r\n            rep.cancel();\r\n        } catch (e) {\r\n            // ignore error\r\n        }\r\n        rep = null;\r\n    }\r\n\r\n    await startSync();\r\n}\r\n\r\n\r\nexport async function setRemoteDb(url: string, user: string, password: string) {\r\n    if (rep) {\r\n        try {\r\n            rep.cancel();\r\n        } catch (e) {\r\n            // ignore error\r\n        }\r\n        rep = null;\r\n    }\r\n    if (remoteDb) {\r\n        try {\r\n            await remoteDb.close();\r\n        } catch (e) {\r\n            // ignore error\r\n        }\r\n        remoteDb = null;\r\n    }\r\n\r\n    if (url && url.match(/^https?:\\/\\//)) {\r\n        remoteDb = new PouchDB(url, {\r\n            auth: {\r\n                username: user,\r\n                password: password,\r\n            },\r\n        });\r\n\r\n        await startSync();\r\n    }\r\n}\r\n\r\n\r\nexport function getLocalDb() {\r\n    return localDb;\r\n}\r\n\r\nexport function getLocalConfigDb() {\r\n    return localConfigDb;\r\n}\r\n\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport { createMuiTheme } from '@material-ui/core/styles';\r\nimport { blue, pink }     from '@material-ui/core/colors';\r\n\r\n\r\n\r\nexport const isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\r\n\r\nexport const theme = createMuiTheme({\r\n    palette: isDark ? {\r\n        type: 'dark',\r\n        primary: {\r\n            main: blue[500],\r\n        },\r\n        secondary: {\r\n            main: pink[500],\r\n        },\r\n    } : {\r\n        type: 'light',\r\n        primary: {\r\n            main: blue[500],\r\n        },\r\n        secondary: {\r\n            main: pink[500],\r\n        },\r\n    },\r\n});\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport { History } from 'history';\r\n\r\n\r\n\r\nexport function getCurrentView(history: History<any>) {\r\n    let currentView = '';\r\n    if (history.location.pathname) {\r\n        if (history.location.pathname.startsWith('/kanban/')) {\r\n            currentView = 'kanban';\r\n        } else if (history.location.pathname.startsWith('/calendar/')) {\r\n            currentView = 'calendar';\r\n        } else if (history.location.pathname.startsWith('/edit/')) {\r\n            currentView = 'edit';\r\n        } else if (history.location.pathname.startsWith('/config/')) {\r\n            currentView = 'config';\r\n        }\r\n    }\r\n    return currentView;\r\n}\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport actionCreatorFactory,\r\n       { Action }             from 'typescript-fsa';\r\nimport { AppConfig,\r\n         ConfirmDialogProps,\r\n         AppEventsState }     from '../types';\r\n\r\n\r\n\r\nexport interface AppEventsActions {\r\n    showAlertDialog: (v: ConfirmDialogProps) =>\r\n        Action<ConfirmDialogProps>;\r\n    closeAlertDialog: () =>\r\n        Action<void>;\r\n\r\n    updateAppConfig: (v: AppConfig) =>\r\n        Action<AppConfig>;\r\n    resetApplication: () =>\r\n        Action<void>;\r\n\r\n    // from KanbanBoardActions\r\n    changeActiveBoard: (id: string) =>\r\n        Action<{boardId: string}>;\r\n    refreshActiveBoard: () =>\r\n        Action<{}>;\r\n}\r\n\r\n\r\nconst actionCreator = actionCreatorFactory();\r\n\r\n\r\nconst updateAppConfig =\r\n    actionCreator.async<AppConfig, AppEventsState, Error>('ACTIONS_UPDATE_APP_CONFIG');\r\nconst resetApplication =\r\n    actionCreator.async<void, AppEventsState, Error>('ACTIONS_RESET_APPLICATION');\r\n\r\n\r\nexport const appEventsActions = {\r\n    showAlertDialog: actionCreator<ConfirmDialogProps>('ACTIONS_SHOW_ALERT_DIALOG'),\r\n    closeAlertDialog: actionCreator<void>('ACTIONS_CLOSE_ALERT_DIALOG'),\r\n\r\n    startUpdateAppConfig: updateAppConfig.started,\r\n    doneUpdateAppConfig: updateAppConfig.done,\r\n    failedUpdateAppConfig: updateAppConfig.failed,\r\n\r\n    startResetApplication: resetApplication.started,\r\n    doneResetApplication: resetApplication.done,\r\n    failedResetApplication: resetApplication.failed,\r\n};\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport actionCreatorFactory,\r\n       { Action }                  from 'typescript-fsa';\r\nimport { KanbanBoardState,\r\n         KanbanBoardRecord,\r\n         KanbanRecord,\r\n         UpdateStickyLanesPayload,\r\n         ConfirmDialogProps }      from '../types';\r\n\r\n\r\n\r\nexport interface KanbanBoardActions {\r\n    addBoard: (boardName: string) =>\r\n        Action<{boardName: string}>;\r\n    changeActiveBoard: (id: string) =>\r\n        Action<{boardId: string}>;\r\n    updateBoardName: (v: {boardId: string, boardName: string}) =>\r\n        Action<{boardId: string, boardName: string}>;\r\n    deleteBoard: (id: string) =>\r\n        Action<{boardId: string}>;\r\n\r\n    addSticky: () =>\r\n        Action<{}>;\r\n    updateSticky: (v: KanbanRecord) =>\r\n        Action<KanbanRecord>;\r\n    updateStickyLanes: (v: UpdateStickyLanesPayload) =>\r\n        Action<UpdateStickyLanesPayload>;\r\n    archiveSticky: (kanbanId: string) =>\r\n        Action<{kanbanId: string}>;\r\n    unarchiveSticky: (kanbanId: string) =>\r\n        Action<{kanbanId: string}>;\r\n    deleteSticky: (kanbanId: string) =>\r\n        Action<{kanbanId: string}>;\r\n\r\n    editBoardAndStickys: (v: KanbanBoardRecord) =>\r\n        Action<KanbanBoardRecord>;\r\n\r\n    refreshActiveBoard: () =>\r\n        Action<{}>;\r\n\r\n    // from AppEventsActions\r\n    showAlertDialog: (v: ConfirmDialogProps) =>\r\n        Action<ConfirmDialogProps>;\r\n    closeAlertDialog: () =>\r\n        Action<void>;\r\n}\r\n\r\n\r\nconst actionCreator = actionCreatorFactory();\r\n\r\n\r\nconst addBoard =\r\n    actionCreator.async<{boardName: string}, KanbanBoardState, Error>('ACTIONS_ADD_BOARD');\r\nconst changeActiveBoard =\r\n    actionCreator.async<{boardId: string}, KanbanBoardState, Error>('ACTIONS_CHANGE_ACTIVE_BOARD');\r\nconst updateBoardName =\r\n    actionCreator.async<{boardId: string, boardName: string}, KanbanBoardState, Error>('ACTIONS_UPDATE_BOARD_NAME');\r\nconst deleteBoard =\r\n    actionCreator.async<{boardId: string}, KanbanBoardState, Error>('ACTIONS_DELETE_BOARD');\r\n\r\nconst addSticky =\r\n    actionCreator.async<{}, KanbanBoardState, Error>('ACTIONS_ADD_STICKY');\r\nconst updateSticky =\r\n    actionCreator.async<KanbanRecord, KanbanBoardState, Error>('ACTIONS_UPDATE_STICKY');\r\nconst updateStickyLanes =\r\n    actionCreator.async<UpdateStickyLanesPayload, KanbanBoardState, Error>('ACTIONS_UPDATE_STICKY_LANES');\r\nconst archiveSticky =\r\n    actionCreator.async<{kanbanId: string}, KanbanBoardState, Error>('ACTIONS_ARCHIVE_STICKY');\r\nconst unarchiveSticky =\r\n    actionCreator.async<{kanbanId: string}, KanbanBoardState, Error>('ACTIONS_UNARCHIVE_STICKY');\r\nconst deleteSticky =\r\n    actionCreator.async<{kanbanId: string}, KanbanBoardState, Error>('ACTIONS_DELETE_STICKY');\r\n\r\nconst editBoardAndStickys =\r\n    actionCreator.async<KanbanBoardRecord, KanbanBoardState, Error>('ACTIONS_EDIT_BOARD_AND_STICKYS');\r\n\r\nconst refreshActiveBoard =\r\n    actionCreator.async<{}, KanbanBoardState, Error>('ACTIONS_REFRESH_ACTIVE_BOARD');\r\n\r\n\r\nexport const kanbanBoardActions = {\r\n    startAddBoard: addBoard.started,\r\n    doneAddBoard: addBoard.done,\r\n    failedAddBoard: addBoard.failed,\r\n\r\n    startChangeActiveBoard: changeActiveBoard.started,\r\n    doneChangeActiveBoard: changeActiveBoard.done,\r\n    failedChangeActiveBoard: changeActiveBoard.failed,\r\n\r\n    startUpdateBoardName: updateBoardName.started,\r\n    doneUpdateBoardName: updateBoardName.done,\r\n    failedUpdateBoardName: updateBoardName.failed,\r\n\r\n    startDeleteBoard: deleteBoard.started,\r\n    doneDeleteBoard: deleteBoard.done,\r\n    failedDeleteBoard: deleteBoard.failed,\r\n\r\n    startAddSticky: addSticky.started,\r\n    doneAddSticky: addSticky.done,\r\n    failedAddSticky: addSticky.failed,\r\n\r\n    startUpdateSticky: updateSticky.started,\r\n    doneUpdateSticky: updateSticky.done,\r\n    failedUpdateSticky: updateSticky.failed,\r\n\r\n    startUpdateStickyLanes: updateStickyLanes.started,\r\n    doneUpdateStickyLanes: updateStickyLanes.done,\r\n    failedUpdateStickyLanes: updateStickyLanes.failed,\r\n\r\n    startArchiveSticky: archiveSticky.started,\r\n    doneArchiveSticky: archiveSticky.done,\r\n    failedArchiveSticky: archiveSticky.failed,\r\n\r\n    startUnarchiveSticky: unarchiveSticky.started,\r\n    doneUnarchiveSticky: unarchiveSticky.done,\r\n    failedUnarchiveSticky: unarchiveSticky.failed,\r\n\r\n    startDeleteSticky: deleteSticky.started,\r\n    doneDeleteSticky: deleteSticky.done,\r\n    failedDeleteSticky: deleteSticky.failed,\r\n\r\n    startEditBoardAndStickys: editBoardAndStickys.started,\r\n    doneEditBoardAndStickys: editBoardAndStickys.done,\r\n    failedEditBoardAndStickys: editBoardAndStickys.failed,\r\n\r\n    startRefreshActiveBoard: refreshActiveBoard.started,\r\n    doneRefreshActiveBoard: refreshActiveBoard.done,\r\n    failedRefreshActiveBoard: refreshActiveBoard.failed,\r\n};\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport { Action }             from 'typescript-fsa';\r\nimport { Dispatch }           from 'redux';\r\nimport { AppConfig,\r\n         ConfirmDialogProps,\r\n         AppState }           from '../types';\r\nimport { AppEventsActions as AppEventsActions_,\r\n         appEventsActions }   from '../actions/AppEventsActions';\r\nimport { KanbanBoardActions as KanbanBoardActions_,\r\n         kanbanBoardActions } from '../actions/KanbanBoardActions';\r\n\r\n\r\n\r\nexport type AppEventsActions = AppEventsActions_;\r\nexport type KanbanBoardActions = KanbanBoardActions_;\r\n\r\n\r\nexport function mapDispatchToProps(dispatch: Dispatch<Action<any>>) {\r\n    return {\r\n        showAlertDialog: (v: ConfirmDialogProps) =>\r\n            dispatch(appEventsActions.showAlertDialog(v)),\r\n        closeAlertDialog: () =>\r\n            dispatch(appEventsActions.closeAlertDialog()),\r\n\r\n        updateAppConfig: (v: AppConfig) =>\r\n            dispatch(appEventsActions.startUpdateAppConfig(v)),\r\n        resetApplication: () =>\r\n            dispatch(appEventsActions.startResetApplication()),\r\n\r\n        // from KanbanBoardActions\r\n        changeActiveBoard: (boardId: string) =>\r\n            dispatch(kanbanBoardActions.startChangeActiveBoard({ boardId })),\r\n        refreshActiveBoard: () =>\r\n            dispatch(kanbanBoardActions.startRefreshActiveBoard({})),\r\n    }\r\n}\r\n\r\n\r\nexport function mapStateToProps(appState: AppState) {\r\n    return Object.assign({}, appState.appEvents);\r\n}\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\n\r\n\r\nexport function formatDate(d: Date) {\r\n    return `${String(d.getFullYear()).padStart(4, '0')}-${\r\n        String(d.getMonth() + 1).padStart(2, '0')}-${\r\n        String(d.getDate()).padStart(2, '0')}`;\r\n}\r\n\r\nexport function parseISODate(s: string) {\r\n    const m = s.match(/^(?:(-?\\d{4,})-(\\d{2})-(\\d{2}))|(?:(-?\\d{4,})(\\d{2})(\\d{2}))$/);\r\n    if (m) {\r\n        return new Date(Number(m[1]), Number(m[2]) - 1, Number(m[3]));\r\n    } else {\r\n        return null;\r\n    }\r\n}\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\n\r\n\r\nexport const boardStyle =\r\n    `/* per-board customized styles */\r\n/*\r\n.KanbanBoardView-sticky-note {width: 200px}\r\n.KanbanBoardView-header-cell-task-statuses {min-width: 210px}\r\ntable.KanbanBoardView-board tbody th {\r\n    padding: 10px;\r\n    white-space: nowrap;\r\n}\r\n*/\r\ntable.KanbanBoardView-board thead th.status-backlog {\r\n    background-color: var(--weak-header-bg-color);\r\n}\r\ntable.KanbanBoardView-board td.status-backlog {\r\n    background-color: var(--weak-data-bg-color);\r\n}\r\ntable.KanbanBoardView-board thead th.status-done {\r\n    background-color: var(--weak-header-bg-color);\r\n}\r\ntable.KanbanBoardView-board td.status-done {\r\n    background-color: var(--weak-data-bg-color);\r\n}\r\n.team-or-story-team-b .KanbanBoardView-sticky-note {\r\n    background-color: var(--sticky-blue-color);\r\n}\r\n.status-done .KanbanBoardView-sticky-note {\r\n    background-color: var(--sticky-green-color);\r\n}\r\n.KanbanBoardView-sticky-tags .tag-bug {\r\n    color: white;\r\n    background-color: red;\r\n}\r\n.KanbanBoardView-sticky-tags .tag-ok {\r\n    color: white;\r\n    background-color: green;\r\n}\r\n.KanbanBoardView-sticky-tags .tag-NG {\r\n    color: white;\r\n    background-color: #e91e63;\r\n}\r\n.KanbanBoardView-sticky-tags .tag-PR {\r\n    color: white;\r\n    background-color: purple;\r\n}\r\n.KanbanBoardView-sticky-tags .tag-rejected {\r\n    color: white;\r\n    background-color: #990000;\r\n}\r\n.KanbanBoardView-sticky-tags .tag-pending {\r\n    color: black;\r\n    background-color: #ff9900;\r\n}\r\n.KanbanBoardView-sticky-tags .tag-merged {\r\n    color: white;\r\n    background-color: #006666;\r\n}\r\n.KanbanBoardView-sticky-tags .tag-critical {\r\n    color: white;\r\n    background-color: red;\r\n}\r\n.KanbanBoardView-sticky-tags .tag-high {\r\n    color: white;\r\n    background-color: #ff5522;\r\n}\r\n.KanbanBoardView-sticky-tags .tag-moderate {\r\n    color: black;\r\n    background-color: #ffcc00;\r\n}\r\n.KanbanBoardView-sticky-tags .tag-low {\r\n    color: black;\r\n    background-color: #cc9900;\r\n}\r\n.KanbanBoardView-sticky-tags .tag-star {\r\n    color: inherit;\r\n    background-color: inherit;\r\n}\r\n`;\r\n\r\n\r\nexport const calendarStyle =\r\n    `/* per-board customized styles */\r\ndiv.CalendarView-item-chip.status-done {\r\n    background-color: var(--sticky-green-color);\r\n}\r\n`;\r\n\r\n\r\nexport const boardNote =\r\n    `# This is a board note.\r\n* Markdown syntax is available.\r\n* Go [Editor](#/edit/) to edit this note.`;\r\n\r\n\r\nexport const initialData = {\r\n    \"boards\": [{\r\n        \"type\": \"kanbanBoard\",\r\n        \"name\": \"Welcome Board\",\r\n        \"taskStatuses\": [{\r\n            \"value\": \"Backlog\",\r\n            \"caption\": \" Backlog\",\r\n            \"className\": \"status-backlog\"\r\n        }, {\r\n            \"value\": \"ToDo\",\r\n            \"caption\": \" ToDo\",\r\n            \"className\": \"status-todo\"\r\n        }, {\r\n            \"value\": \"InProgress\",\r\n            \"caption\": \" InProgress\",\r\n            \"className\": \"status-inprogress\"\r\n        }, {\r\n            \"value\": \"Testing\",\r\n            \"caption\": \" Testing\",\r\n            \"className\": \"status-Testing\"\r\n        }, {\r\n            \"value\": \"Done\",\r\n            \"caption\": \" Done\",\r\n            \"className\": \"status-done\",\r\n            \"completed\": true\r\n        }],\r\n        \"teamOrStories\": [{\r\n            \"value\": \"Team A\",\r\n            \"caption\": \" Team A\",\r\n            \"className\": \"team-or-story-team-a\"\r\n        }, {\r\n            \"value\": \"Team B\",\r\n            \"caption\": \" Team B\",\r\n            \"className\": \"team-or-story-team-b\"\r\n        }, {\r\n            \"value\": \"Team C\",\r\n            \"caption\": \" Team C\",\r\n            \"className\": \"team-or-story-team-c\"\r\n        }],\r\n        \"tags\": [{\r\n            \"value\": \"bug\",\r\n            \"className\": \"tag-bug\"\r\n        }, {\r\n            \"value\": \"ok\",\r\n            \"className\": \"tag-ok\"\r\n        }, {\r\n            \"value\": \"NG\",\r\n            \"className\": \"tag-NG\"\r\n        }, {\r\n            \"value\": \"PR\",\r\n            \"className\": \"tag-PR\"\r\n        }, {\r\n            \"value\": \"rejected\",\r\n            \"className\": \"tag-rejected\"\r\n        }, {\r\n            \"value\": \"pending\",\r\n            \"className\": \"tag-pending\"\r\n        }, {\r\n            \"value\": \"merged\",\r\n            \"className\": \"tag-merged\"\r\n        }, {\r\n            \"value\": \"critical\",\r\n            \"className\": \"tag-critical\"\r\n        }, {\r\n            \"value\": \"high\",\r\n            \"className\": \"tag-high\"\r\n        }, {\r\n            \"value\": \"moderate\",\r\n            \"className\": \"tag-moderate\"\r\n        }, {\r\n            \"value\": \"low\",\r\n            \"className\": \"tag-low\"\r\n        }, {\r\n            \"value\": \"\",\r\n            \"className\": \"tag-star\"\r\n        }, {\r\n            \"value\": \"\",\r\n            \"className\": \"tag-star\"\r\n        }, {\r\n            \"value\": \"\",\r\n            \"className\": \"tag-star\"\r\n        }],\r\n        \"displayBarcode\": true,\r\n        \"displayMemo\": true,\r\n        \"displayFlags\": true,\r\n        \"displayTags\": true,\r\n        \"preferArchive\": false,\r\n        \"boardStyle\": boardStyle,\r\n        \"calendarStyle\": calendarStyle,\r\n        \"boardNote\": \"\",\r\n    }],\r\n    \"records\": []\r\n}\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport {\r\n    reducerWithInitialState,\r\n    ReducerBuilder\r\n} from 'typescript-fsa-reducers';\r\nimport { push } from 'connected-react-router';\r\nimport {\r\n    KanbanBoardState,\r\n    KanbanBoardInitialData,\r\n    DocumentWithContents,\r\n    KanbanBoardDbRecord,\r\n    KanbanBoardDbRecordUserData,\r\n    KanbanBoardRecord,\r\n    KanbanRecord\r\n} from '../types';\r\nimport { appEventsActions } from '../actions/AppEventsActions';\r\nimport { kanbanBoardActions } from '../actions/KanbanBoardActions';\r\nimport {\r\n    restartSync,\r\n    getLocalDb\r\n} from '../lib/db';\r\nimport { formatDate } from '../lib/datetime';\r\nimport { getConstructedAppStore } from '../store';\r\nimport {\r\n    initialData,\r\n    boardNote\r\n} from '../data/initial-data';\r\n\r\n\r\n\r\nlet kanbanBoardReducer: ReducerBuilder<KanbanBoardState, KanbanBoardState> = null as any;\r\n\r\nexport async function getKanbanBoardReducer() {\r\n    if (!kanbanBoardReducer) {\r\n        const db = getLocalDb();\r\n\r\n        // TODO: try-catch\r\n        let resp: PouchDB.Core.AllDocsResponse<DocumentWithContents> = null as any;\r\n\r\n        resp = await db.allDocs({\r\n            include_docs: true,\r\n        });\r\n\r\n        if (resp.rows.length === 0) {\r\n            const data: KanbanBoardInitialData = initialData as any;\r\n\r\n            const postRespBoards = await db.bulkDocs([\r\n                ...data.boards.map(x => Object.assign({}, x, { boardNote })),\r\n            ], {});\r\n\r\n            const now = new Date();\r\n            for (const rec of data.records) {\r\n                rec.dueDate = formatDate(now);\r\n                rec.boardId = postRespBoards[0].id as string;\r\n            }\r\n            await db.bulkDocs([\r\n                ...data.records,\r\n            ], {});\r\n\r\n            resp = await db.allDocs({\r\n                include_docs: true,\r\n            });\r\n        }\r\n\r\n        let boards: KanbanBoardRecord[] = resp.rows\r\n            .filter((x: any) => x.doc && x.doc.type === 'kanbanBoard')\r\n            .map((x: any) => { x.doc.taken = false; return x.doc; })\r\n            .sort((a: any, b: any) =>\r\n                String(a.name).toLocaleLowerCase() >= String(b.name).toLocaleLowerCase() ?\r\n                    (String(a.name) === String(b.name) ? 0 : 1) : -1) as any;\r\n\r\n\r\n        console.table('get boards', boards);\r\n\r\n        // look for the name duplicate board: board.name, collect the name and id { name: [id] }\r\n        const dup: any = {};\r\n        for (let i = 0; i < boards.length; ++i) {\r\n            let v = boards[i];\r\n            console.log(v);\r\n            for (let i1 = 0; i1 < boards.length; ++i1) {\r\n                let v1: any = boards[i1];\r\n                if (i !== i1) {\r\n                    console.log('compare name:' + v.name + v1.name);\r\n                    if (v.name === v1.name) {\r\n                        dup[v.name] = dup[v.name] ? dup[v.name] : [];\r\n                        if (!v1.taken) {\r\n                            console.log('taken:' + v1.name);\r\n                            v1.taken = false;\r\n                        }\r\n                        if (v1.taken === false) {\r\n                            console.log('push:' + v1.name);\r\n                            v1.taken = true;\r\n                            dup[v.name].push(v1);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        console.table('get dup:', dup);\r\n        // const dupBoardName = Object.keys(dup);\r\n        // get the duplicate boards name, \r\n        for (const key in dup) {\r\n            console.table(key, dup[key]);\r\n            // compact all kanban records to one of the duplicate board,\r\n            const boardIds: any[] = [];\r\n            dup[key].forEach((x: any, index: any) => {\r\n                boardIds.push(x._id);\r\n                if (index !== 0) {\r\n                    db.remove(x);\r\n                }\r\n            });\r\n            console.table('ids', boardIds);\r\n\r\n            for (let i = 0; i < resp.rows.length; ++i) {\r\n                console.table('got result', boardIds.find(id => {\r\n                    console.log(id);\r\n                    console.log((resp.rows[i].doc as KanbanRecord).boardId);\r\n                    console.log('-----')\r\n                    return id === (resp.rows[i].doc as KanbanRecord).boardId;\r\n                }));\r\n                if (resp.rows[i].doc && resp.rows[i].doc?.type === 'kanban' &&\r\n                    boardIds.find(id => id === (resp.rows[i].doc as KanbanRecord).boardId)) {\r\n                    console.table('found a kanban', (resp.rows[i].doc as KanbanRecord).boardId);\r\n                    (resp.rows[i].doc as KanbanRecord).boardId = boardIds[0];\r\n                }\r\n\r\n                // const records: KanbanRecord[] = resp.rows\r\n                //     .filter(x => x.doc && x.doc.type === 'kanban' &&\r\n                //         boardIds.find(id => id === (x.doc as KanbanRecord).boardId))\r\n                //     .map(x => {\r\n                //         (x.doc as KanbanRecord).boardId = boardIds[0];\r\n                //         return x;\r\n                //     }) as any;\r\n\r\n            }\r\n        }\r\n\r\n        for (const board of boards) {\r\n            const records: KanbanRecord[] = resp.rows\r\n                .filter(x => x.doc && x.doc.type === 'kanban' &&\r\n                    (x.doc as KanbanRecord).boardId === board._id)\r\n                .map(x => x.doc) as any;\r\n            board.records = records; // assign records to board\r\n        }\r\n\r\n        // remove the duplicate boards on localdb and memory\r\n        await db.bulkDocs(\r\n            resp.rows.map((x: any) => x.doc)\r\n            , {});\r\n\r\n        console.table('all', resp.rows);\r\n\r\n        const initialState: KanbanBoardState = {\r\n            activeBoard: boards[0],\r\n            boards: boards,\r\n            activeBoardId: boards[0]._id,\r\n            activeBoardIndex: 0,\r\n        };\r\n\r\n        const getKanbanBoardStateFromDb = async (state: KanbanBoardState, boardId: string) => {\r\n            const board = await db.get<KanbanBoardRecord>(boardId, {});\r\n            if (!board) {\r\n                return state;\r\n            }\r\n            const records: KanbanRecord[] = (await db.find({\r\n                selector: {\r\n                    type: 'kanban',\r\n                    boardId: board._id,\r\n                }\r\n            })).docs as any;\r\n\r\n            board.records = records;\r\n            const index = Math.max(0, state.boards.findIndex(x => x._id === board._id));\r\n            const boards = state.boards.slice(0, index).concat(\r\n                [board],\r\n                state.boards.slice(index + 1),\r\n            );\r\n\r\n            return (Object.assign({}, state, {\r\n                boards,\r\n                activeBoardId: board._id,\r\n                activeBoard: board,\r\n                activeBoardIndex: index,\r\n            }));\r\n        }\r\n\r\n        kanbanBoardReducer = reducerWithInitialState(initialState)\r\n            //// addBoard async actions ////\r\n            .case(kanbanBoardActions.startAddBoard, (state, payload) => {\r\n                const data: KanbanBoardInitialData = initialData as any;\r\n                const board: KanbanBoardDbRecordUserData = {\r\n                    type: 'kanbanBoard',\r\n                    name: payload.boardName,\r\n                    taskStatuses: data.boards[0].taskStatuses,\r\n                    teamOrStories: data.boards[0].teamOrStories,\r\n                    tags: data.boards[0].tags,\r\n                    displayBarcode: data.boards[0].displayBarcode,\r\n                    displayMemo: data.boards[0].displayMemo,\r\n                    displayFlags: data.boards[0].displayFlags,\r\n                    displayTags: data.boards[0].displayTags,\r\n                    preferArchive: data.boards[0].preferArchive,\r\n                    boardStyle: data.boards[0].boardStyle,\r\n                    calendarStyle: data.boards[0].calendarStyle,\r\n                    boardNote: data.boards[0].boardNote,\r\n                };\r\n                db.post(board, {})\r\n                    .then(v => {\r\n                        const saved: KanbanBoardRecord = board as any;\r\n                        saved._id = v.id;\r\n                        saved._rev = v.rev;\r\n                        saved.records = [];\r\n                        state.boards = state.boards.concat([saved]);\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.doneAddBoard({\r\n                            params: payload,\r\n                            result: Object.assign({}, state, { activeBoardId: v.id, activeBoard: saved }),\r\n                        }));\r\n                        setTimeout(() => {\r\n                            getConstructedAppStore().dispatch(push(`/kanban/${v.id}`));\r\n                        }, 30);\r\n                    })\r\n                    .catch(err => {\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.failedAddBoard({\r\n                            params: payload,\r\n                            error: err,\r\n                        }));\r\n                        setTimeout(() => {\r\n                            getConstructedAppStore().dispatch(appEventsActions.showAlertDialog({\r\n                                open: true,\r\n                                title: 'Error',\r\n                                message: 'Failed to add board: ' + err.message,\r\n                                singleButton: true,\r\n                                colorIsSecondary: true,\r\n                                onClose: () => getConstructedAppStore().dispatch(appEventsActions.closeAlertDialog()),\r\n                            }));\r\n                        }, 30);\r\n                    });\r\n                return state;\r\n            })\r\n            .case(kanbanBoardActions.doneAddBoard, (state, arg) => {\r\n                setTimeout(() => {\r\n                    restartSync()\r\n                        .then(() => {\r\n                            //\r\n                        }).catch(err => {\r\n                            alert(err.message);\r\n                        })\r\n                }, 1500);\r\n                return arg.result;\r\n            })\r\n            .case(kanbanBoardActions.failedAddBoard, (state, arg) => {\r\n                return state;\r\n            })\r\n\r\n            //// changeActiveBoard async actions ////\r\n            .case(kanbanBoardActions.startChangeActiveBoard, (state, payload) => {\r\n                (async () => {\r\n                    try {\r\n                        const newState = await getKanbanBoardStateFromDb(state, payload.boardId);\r\n\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.doneChangeActiveBoard({\r\n                            params: payload,\r\n                            result: newState,\r\n                        }));\r\n                    } catch (e) {\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.failedChangeActiveBoard({\r\n                            params: payload,\r\n                            error: e,\r\n                        }));\r\n                        setTimeout(() => {\r\n                            getConstructedAppStore().dispatch(appEventsActions.showAlertDialog({\r\n                                open: true,\r\n                                title: 'Error',\r\n                                message: 'Failed to change active board: ' + e.message,\r\n                                singleButton: true,\r\n                                colorIsSecondary: true,\r\n                                onClose: () => {\r\n                                    getConstructedAppStore().dispatch(appEventsActions.closeAlertDialog());\r\n                                    setTimeout(() => {\r\n                                        getConstructedAppStore().dispatch(push(`/kanban/`));\r\n                                    }, 500);\r\n                                },\r\n                            }));\r\n                        }, 30);\r\n                    }\r\n                })();\r\n                return state;\r\n            })\r\n            .case(kanbanBoardActions.doneChangeActiveBoard, (state, arg) => {\r\n                return arg.result;\r\n            })\r\n            .case(kanbanBoardActions.failedChangeActiveBoard, (state, arg) => {\r\n                return state;\r\n            })\r\n\r\n            //// updateBoardName async actions ////\r\n            .case(kanbanBoardActions.startUpdateBoardName, (state, payload) => {\r\n                (async () => {\r\n                    try {\r\n                        const dbBoard = await db.get<KanbanBoardRecord>(payload.boardId);\r\n                        if (!dbBoard) {\r\n                            return state;\r\n                        }\r\n                        const records: KanbanRecord[] = (await db.find({\r\n                            selector: {\r\n                                type: 'kanban',\r\n                                boardId: dbBoard._id,\r\n                            }\r\n                        })).docs as any;\r\n\r\n                        const change = Object.assign({}, dbBoard, { name: payload.boardName });\r\n                        const saved = await db.put(change, {});\r\n\r\n                        change.records = records;\r\n                        change._id = saved.id;\r\n                        change._rev = saved.rev;\r\n\r\n                        const index = state.boards.findIndex(x => x._id === payload.boardId);\r\n                        const board = Object.assign({}, state.boards[index] || {}, change);\r\n\r\n                        const boards = index >= 0 ?\r\n                            state.boards.slice(0, index).concat(\r\n                                [board],\r\n                                state.boards.slice(index + 1),\r\n                            ) : state.boards;\r\n\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.doneUpdateBoardName({\r\n                            params: payload,\r\n                            result: Object.assign({}, state, {\r\n                                boards,\r\n                                activeBoardId: board._id,\r\n                                activeBoard: board,\r\n                            }),\r\n                        }));\r\n                    } catch (e) {\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.failedUpdateBoardName({\r\n                            params: payload,\r\n                            error: e,\r\n                        }));\r\n                        setTimeout(() => {\r\n                            getConstructedAppStore().dispatch(appEventsActions.showAlertDialog({\r\n                                open: true,\r\n                                title: 'Error',\r\n                                message: 'Failed to change board name: ' + e.message,\r\n                                singleButton: true,\r\n                                colorIsSecondary: true,\r\n                                onClose: () => getConstructedAppStore().dispatch(appEventsActions.closeAlertDialog()),\r\n                            }));\r\n                        }, 30);\r\n                    }\r\n                })();\r\n                return state;\r\n            })\r\n            .case(kanbanBoardActions.doneUpdateBoardName, (state, arg) => {\r\n                return arg.result;\r\n            })\r\n            .case(kanbanBoardActions.failedUpdateBoardName, (state, arg) => {\r\n                return state;\r\n            })\r\n\r\n            //// deleteBoard async actions ////\r\n            .case(kanbanBoardActions.startDeleteBoard, (state, payload) => {\r\n                (async () => {\r\n                    try {\r\n                        if (state.boards.length <= 1) {\r\n                            return state;\r\n                        }\r\n                        const dbBoard = await db.get<KanbanBoardDbRecord>(payload.boardId);\r\n                        if (!dbBoard) {\r\n                            return state;\r\n                        }\r\n\r\n                        const records: KanbanRecord[] = (await db.find({\r\n                            selector: {\r\n                                type: 'kanban',\r\n                                boardId: payload.boardId,\r\n                            }\r\n                        })).docs as any;\r\n\r\n                        for (const record of records) {\r\n                            await db.remove(record, {});\r\n                        }\r\n\r\n                        await db.remove(dbBoard, {});\r\n\r\n                        const activeBoardId = state.activeBoardId === payload.boardId ?\r\n                            state.boards[0]._id : state.activeBoardId;\r\n                        const newState = await getKanbanBoardStateFromDb(state, activeBoardId);\r\n\r\n                        const index = newState.boards.findIndex(x => x._id === payload.boardId);\r\n\r\n                        const boards = index >= 0 ?\r\n                            newState.boards.slice(0, index).concat(\r\n                                newState.boards.slice(index + 1),\r\n                            ) : newState.boards;\r\n\r\n                        setTimeout(() => {\r\n                            getConstructedAppStore().dispatch(kanbanBoardActions.doneDeleteBoard({\r\n                                params: payload,\r\n                                result: Object.assign({}, state, {\r\n                                    boards,\r\n                                    activeBoardId,\r\n                                    activeBoard: newState.activeBoard,\r\n                                    activeBoardIndex: newState.boards.findIndex(x => x._id === activeBoardId),\r\n                                }),\r\n                            }));\r\n                            setTimeout(() => {\r\n                                getConstructedAppStore().dispatch(push(`/kanban/${activeBoardId}`));\r\n                                setTimeout(() => {\r\n                                    getConstructedAppStore().dispatch(appEventsActions.showAlertDialog({\r\n                                        open: true,\r\n                                        title: 'Done',\r\n                                        message: 'Board is deleted successfully',\r\n                                        singleButton: true,\r\n                                        onClose: () => getConstructedAppStore().dispatch(appEventsActions.closeAlertDialog()),\r\n                                    }));\r\n                                }, 30);\r\n                            }, 30);\r\n                        }, 30);\r\n                    } catch (e) {\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.failedDeleteBoard({\r\n                            params: payload,\r\n                            error: e,\r\n                        }));\r\n                        setTimeout(() => {\r\n                            getConstructedAppStore().dispatch(appEventsActions.showAlertDialog({\r\n                                open: true,\r\n                                title: 'Error',\r\n                                message: 'Failed to delete board: ' + e.message,\r\n                                singleButton: true,\r\n                                colorIsSecondary: true,\r\n                                onClose: () => getConstructedAppStore().dispatch(appEventsActions.closeAlertDialog()),\r\n                            }));\r\n                        }, 30);\r\n                    }\r\n                })();\r\n                return state;\r\n            })\r\n            .case(kanbanBoardActions.doneDeleteBoard, (state, arg) => {\r\n                return arg.result;\r\n            })\r\n            .case(kanbanBoardActions.failedDeleteBoard, (state, arg) => {\r\n                return state;\r\n            })\r\n\r\n            //// addSticky async actions ////\r\n            .case(kanbanBoardActions.startAddSticky, (state, payload) => {\r\n                const now = new Date();\r\n                const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n\r\n                const change: KanbanRecord = {\r\n                    type: 'kanban',\r\n                    dueDate: formatDate(today),\r\n                    description: '# Untitled',\r\n                    barcode: '',\r\n                    memo: '',\r\n                    flags: [],\r\n                    tags: [],\r\n                    boardId: state.activeBoardId,\r\n                    taskStatus: state.activeBoard.taskStatuses[0].value,\r\n                    teamOrStory: state.activeBoard.teamOrStories[0].value,\r\n                } as any;\r\n\r\n                const records = state.activeBoard.records.concat([change]);\r\n                const activeBoard = Object.assign({}, state.activeBoard, { records });\r\n\r\n                db.post(change, {})\r\n                    .then(v => {\r\n                        change._id = v.id;\r\n                        change._rev = v.rev;\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.doneAddSticky({\r\n                            params: payload,\r\n                            result: Object.assign({}, state, { activeBoard }),\r\n                        }));\r\n                    })\r\n                    .catch(err => {\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.failedAddSticky({\r\n                            params: payload,\r\n                            error: err,\r\n                        }));\r\n                        setTimeout(() => {\r\n                            getConstructedAppStore().dispatch(appEventsActions.showAlertDialog({\r\n                                open: true,\r\n                                title: 'Error',\r\n                                message: 'Failed to add sticky: ' + err.message,\r\n                                singleButton: true,\r\n                                colorIsSecondary: true,\r\n                                onClose: () => getConstructedAppStore().dispatch(appEventsActions.closeAlertDialog()),\r\n                            }));\r\n                        }, 30);\r\n                    });\r\n\r\n                return state;\r\n            })\r\n            .case(kanbanBoardActions.doneAddSticky, (state, arg) => {\r\n                setTimeout(() => {\r\n                    restartSync()\r\n                        .then(() => {\r\n                            //\r\n                        }).catch(err => {\r\n                            alert(err.message);\r\n                        })\r\n                }, 1500);\r\n                return arg.result;\r\n            })\r\n            .case(kanbanBoardActions.failedAddSticky, (state, arg) => {\r\n                return state;\r\n            })\r\n\r\n            //// updateSticky async actions ////\r\n            .case(kanbanBoardActions.startUpdateSticky, (state, payload) => {\r\n                const index = state.activeBoard.records.findIndex(x => x._id === payload._id);\r\n                if (index < 0) {\r\n                    return state;\r\n                }\r\n\r\n                const change = Object.assign({}, state.activeBoard.records[index], {\r\n                    dueDate: payload.dueDate,\r\n                    description: payload.description,\r\n                    barcode: payload.barcode,\r\n                    memo: payload.memo,\r\n                    tags: payload.tags,\r\n                    flags: payload.flags,\r\n                    taskStatus: payload.taskStatus,\r\n                    teamOrStory: payload.teamOrStory,\r\n                });\r\n\r\n                const records = state.activeBoard.records.slice(0, index).concat(\r\n                    [change],\r\n                    state.activeBoard.records.slice(index + 1),\r\n                );\r\n                const activeBoard = Object.assign({}, state.activeBoard, { records });\r\n\r\n                db.put(change, {})\r\n                    .then(v => {\r\n                        change._id = v.id;\r\n                        change._rev = v.rev;\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.doneUpdateSticky({\r\n                            params: payload,\r\n                            result: Object.assign({}, state, { activeBoard }),\r\n                        }));\r\n                    })\r\n                    .catch(err => {\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.failedUpdateSticky({\r\n                            params: payload,\r\n                            error: err,\r\n                        }));\r\n                        setTimeout(() => {\r\n                            getConstructedAppStore().dispatch(appEventsActions.showAlertDialog({\r\n                                open: true,\r\n                                title: 'Error',\r\n                                message: 'Failed to save the sticky: ' + err.message,\r\n                                singleButton: true,\r\n                                colorIsSecondary: true,\r\n                                onClose: () => getConstructedAppStore().dispatch(appEventsActions.closeAlertDialog()),\r\n                            }));\r\n                        }, 30);\r\n                    });\r\n\r\n                return state;\r\n            })\r\n            .case(kanbanBoardActions.doneUpdateSticky, (state, arg) => {\r\n                return arg.result;\r\n            })\r\n            .case(kanbanBoardActions.failedUpdateSticky, (state, arg) => {\r\n                return state;\r\n            })\r\n\r\n            //// updateStickyLanes async actions ////\r\n            .case(kanbanBoardActions.startUpdateStickyLanes, (state, payload) => {\r\n                const index = state.activeBoard.records.findIndex(x => x._id === payload.kanbanId);\r\n                if (index < 0) {\r\n                    return state;\r\n                }\r\n\r\n                const change = Object.assign({}, state.activeBoard.records[index], {\r\n                    taskStatus: payload.taskStatusValue,\r\n                    teamOrStory: payload.teamOrStoryValue,\r\n                });\r\n\r\n                const records = state.activeBoard.records.slice(0, index).concat(\r\n                    [change],\r\n                    state.activeBoard.records.slice(index + 1),\r\n                );\r\n                const activeBoard = Object.assign({}, state.activeBoard, { records });\r\n\r\n                db.put(change, {})\r\n                    .then(v => {\r\n                        change._id = v.id;\r\n                        change._rev = v.rev;\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.doneUpdateStickyLanes({\r\n                            params: payload,\r\n                            result: Object.assign({}, state, { activeBoard }),\r\n                        }));\r\n                    })\r\n                    .catch(err => {\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.failedUpdateStickyLanes({\r\n                            params: payload,\r\n                            error: err,\r\n                        }));\r\n                        setTimeout(() => {\r\n                            getConstructedAppStore().dispatch(appEventsActions.showAlertDialog({\r\n                                open: true,\r\n                                title: 'Error',\r\n                                message: 'Failed to save the sticky: ' + err.message,\r\n                                singleButton: true,\r\n                                colorIsSecondary: true,\r\n                                onClose: () => getConstructedAppStore().dispatch(appEventsActions.closeAlertDialog()),\r\n                            }));\r\n                        }, 30);\r\n                    });\r\n\r\n                return state;\r\n            })\r\n            .case(kanbanBoardActions.doneUpdateStickyLanes, (state, arg) => {\r\n                return arg.result;\r\n            })\r\n            .case(kanbanBoardActions.failedUpdateStickyLanes, (state, arg) => {\r\n                return state;\r\n            })\r\n\r\n            //// archiveSticky async actions ////\r\n            .case(kanbanBoardActions.startArchiveSticky, (state, payload) => {\r\n                const index = state.activeBoard.records.findIndex(x => x._id === payload.kanbanId);\r\n                if (index < 0) {\r\n                    return state;\r\n                }\r\n\r\n                const change = Object.assign({}, state.activeBoard.records[index]);\r\n                change.flags = (change.flags || []).filter(x => x !== 'Archived');\r\n                change.flags.push('Archived');\r\n\r\n                const records = state.activeBoard.records.slice(0, index).concat(\r\n                    [change],\r\n                    state.activeBoard.records.slice(index + 1),\r\n                );\r\n                const activeBoard = Object.assign({}, state.activeBoard, { records });\r\n\r\n                db.put(change, {})\r\n                    .then(v => {\r\n                        change._id = v.id;\r\n                        change._rev = v.rev;\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.doneArchiveSticky({\r\n                            params: payload,\r\n                            result: Object.assign({}, state, { activeBoard }),\r\n                        }));\r\n                    })\r\n                    .catch(err => {\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.failedArchiveSticky({\r\n                            params: payload,\r\n                            error: err,\r\n                        }));\r\n                        setTimeout(() => {\r\n                            getConstructedAppStore().dispatch(appEventsActions.showAlertDialog({\r\n                                open: true,\r\n                                title: 'Error',\r\n                                message: 'Failed to archive the sticky: ' + err.message,\r\n                                singleButton: true,\r\n                                colorIsSecondary: true,\r\n                                onClose: () => getConstructedAppStore().dispatch(appEventsActions.closeAlertDialog()),\r\n                            }));\r\n                        }, 30);\r\n                    });\r\n\r\n                return state;\r\n            })\r\n            .case(kanbanBoardActions.doneArchiveSticky, (state, arg) => {\r\n                return arg.result;\r\n            })\r\n            .case(kanbanBoardActions.failedArchiveSticky, (state, arg) => {\r\n                return state;\r\n            })\r\n\r\n            //// unarchiveSticky async actions ////\r\n            .case(kanbanBoardActions.startUnarchiveSticky, (state, payload) => {\r\n                const index = state.activeBoard.records.findIndex(x => x._id === payload.kanbanId);\r\n                if (index < 0) {\r\n                    return state;\r\n                }\r\n\r\n                const change = Object.assign({}, state.activeBoard.records[index]);\r\n                change.flags = (change.flags || []).filter(x => x !== 'Archived');\r\n\r\n                const records = state.activeBoard.records.slice(0, index).concat(\r\n                    [change],\r\n                    state.activeBoard.records.slice(index + 1),\r\n                );\r\n                const activeBoard = Object.assign({}, state.activeBoard, { records });\r\n\r\n                db.put(change, {})\r\n                    .then(v => {\r\n                        change._id = v.id;\r\n                        change._rev = v.rev;\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.doneUnarchiveSticky({\r\n                            params: payload,\r\n                            result: Object.assign({}, state, { activeBoard }),\r\n                        }));\r\n                    })\r\n                    .catch(err => {\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.failedUnarchiveSticky({\r\n                            params: payload,\r\n                            error: err,\r\n                        }));\r\n                        setTimeout(() => {\r\n                            getConstructedAppStore().dispatch(appEventsActions.showAlertDialog({\r\n                                open: true,\r\n                                title: 'Error',\r\n                                message: 'Failed to unarchive the sticky: ' + err.message,\r\n                                singleButton: true,\r\n                                colorIsSecondary: true,\r\n                                onClose: () => getConstructedAppStore().dispatch(appEventsActions.closeAlertDialog()),\r\n                            }));\r\n                        }, 30);\r\n                    });\r\n\r\n                return state;\r\n            })\r\n            .case(kanbanBoardActions.doneUnarchiveSticky, (state, arg) => {\r\n                return arg.result;\r\n            })\r\n            .case(kanbanBoardActions.failedUnarchiveSticky, (state, arg) => {\r\n                return state;\r\n            })\r\n\r\n            //// deleteSticky async actions ////\r\n            .case(kanbanBoardActions.startDeleteSticky, (state, payload) => {\r\n                const index = state.activeBoard.records.findIndex(x => x._id === payload.kanbanId);\r\n                if (index < 0) {\r\n                    return state;\r\n                }\r\n\r\n                const change = state.activeBoard.records[index];\r\n\r\n                const records = state.activeBoard.records.slice(0, index).concat(\r\n                    state.activeBoard.records.slice(index + 1),\r\n                );\r\n                const activeBoard = Object.assign({}, state.activeBoard, { records });\r\n\r\n                db.remove(change, {})\r\n                    .then(v => {\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.doneDeleteSticky({\r\n                            params: payload,\r\n                            result: Object.assign({}, state, { activeBoard }),\r\n                        }));\r\n                    })\r\n                    .catch(err => {\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.failedDeleteSticky({\r\n                            params: payload,\r\n                            error: err,\r\n                        }));\r\n                        setTimeout(() => {\r\n                            getConstructedAppStore().dispatch(appEventsActions.showAlertDialog({\r\n                                open: true,\r\n                                title: 'Error',\r\n                                message: 'Failed to delete the sticky: ' + err.message,\r\n                                singleButton: true,\r\n                                colorIsSecondary: true,\r\n                                onClose: () => getConstructedAppStore().dispatch(appEventsActions.closeAlertDialog()),\r\n                            }));\r\n                        }, 30);\r\n                    });\r\n\r\n                return state;\r\n            })\r\n            .case(kanbanBoardActions.doneDeleteSticky, (state, arg) => {\r\n                return arg.result;\r\n            })\r\n            .case(kanbanBoardActions.failedDeleteSticky, (state, arg) => {\r\n                return state;\r\n            })\r\n\r\n            //// editBoardAndStickys async actions ////\r\n            .case(kanbanBoardActions.startEditBoardAndStickys, (state, payload) => {\r\n                (async () => {\r\n                    try {\r\n                        const index = state.boards.findIndex(x => x._id === payload._id);\r\n                        if (index < 0) {\r\n                            return state;\r\n                        }\r\n\r\n                        const change = Object.assign({}, state.boards[index], {\r\n                            name: payload.name || 'Untitled',\r\n                            taskStatuses: payload.taskStatuses || initialData.boards[0].taskStatuses,\r\n                            teamOrStories: payload.teamOrStories || initialData.boards[0].teamOrStories,\r\n                            tags: payload.tags || [],\r\n                            displayBarcode: !!payload.displayBarcode,\r\n                            displayMemo: !!payload.displayMemo,\r\n                            displayFlags: !!payload.displayFlags,\r\n                            displayTags: !!payload.displayTags,\r\n                            preferArchive: !!payload.preferArchive,\r\n                            boardStyle: payload.boardStyle || '',\r\n                            calendarStyle: payload.calendarStyle || '',\r\n                            boardNote: payload.boardNote || '',\r\n                        });\r\n\r\n                        const v = await db.put(change, {});\r\n                        change._id = v.id;\r\n                        change._rev = v.rev;\r\n\r\n                        const boards = state.boards.slice(0, index).concat(\r\n                            [change],\r\n                            state.boards.slice(index + 1),\r\n                        );\r\n                        let activeBoard = change._id === state.activeBoard._id ? change : state.activeBoard;\r\n\r\n                        // TODO: sticky records\r\n                        const records: KanbanRecord[] = (await db.find({\r\n                            selector: {\r\n                                type: 'kanban',\r\n                                boardId: change._id,\r\n                            }\r\n                        })).docs as any;\r\n\r\n                        const recordsNew: KanbanRecord[] = [];\r\n                        for (const rec of payload.records || []) {\r\n                            const recDb = records.find(x => x._id === rec._id);\r\n                            let recNew: KanbanRecord = null as any;\r\n                            if (recDb) {\r\n                                recNew = Object.assign({}, rec, { type: 'kanban', boardId: change._id, _rev: recDb._rev });\r\n                                const resp = await db.put(recNew, {});\r\n                                recNew._id = resp.id;\r\n                                recNew._rev = resp.rev;\r\n                            } else {\r\n                                recNew = Object.assign({}, rec, { type: 'kanban', boardId: change._id });\r\n                                delete recNew._id;\r\n                                delete recNew._rev;\r\n                                const resp = await db.post(recNew, {});\r\n                                recNew._id = resp.id;\r\n                                recNew._rev = resp.rev;\r\n                            }\r\n                            recordsNew.push(recNew);\r\n                        }\r\n                        for (const recDb of records) {\r\n                            const recNew = recordsNew.find(x => x._id === recDb._id);\r\n                            if (!recNew) {\r\n                                await db.remove(recDb, {});\r\n                            }\r\n                        }\r\n                        change.records = recordsNew;\r\n\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.doneEditBoardAndStickys({\r\n                            params: payload,\r\n                            result: Object.assign({}, state, {\r\n                                boards,\r\n                                activeBoardId: activeBoard._id,\r\n                                activeBoard: activeBoard,\r\n                            }),\r\n                        }));\r\n                        setTimeout(() => {\r\n                            getConstructedAppStore().dispatch(appEventsActions.showAlertDialog({\r\n                                open: true,\r\n                                title: 'Done',\r\n                                message: 'Board is saved successfully',\r\n                                singleButton: true,\r\n                                onClose: () => getConstructedAppStore().dispatch(appEventsActions.closeAlertDialog()),\r\n                            }));\r\n                        }, 30);\r\n                    } catch (e) {\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.failedEditBoardAndStickys({\r\n                            params: payload,\r\n                            error: e,\r\n                        }));\r\n                        setTimeout(() => {\r\n                            getConstructedAppStore().dispatch(appEventsActions.showAlertDialog({\r\n                                open: true,\r\n                                title: 'Error',\r\n                                message: 'Failed to save the board: ' + e.message,\r\n                                singleButton: true,\r\n                                colorIsSecondary: true,\r\n                                onClose: () => getConstructedAppStore().dispatch(appEventsActions.closeAlertDialog()),\r\n                            }));\r\n                        }, 30);\r\n                    }\r\n                })();\r\n\r\n                return state;\r\n            })\r\n            .case(kanbanBoardActions.doneEditBoardAndStickys, (state, arg) => {\r\n                setTimeout(() => {\r\n                    restartSync()\r\n                        .then(() => {\r\n                            //\r\n                        }).catch(err => {\r\n                            alert(err.message);\r\n                        })\r\n                }, 1500);\r\n                return arg.result;\r\n            })\r\n            .case(kanbanBoardActions.failedEditBoardAndStickys, (state, arg) => {\r\n                return state;\r\n            })\r\n\r\n            //// refreshActiveBoard async actions ////\r\n            .case(kanbanBoardActions.startRefreshActiveBoard, (state, payload) => {\r\n                (async () => {\r\n                    try {\r\n                        const newState = await getKanbanBoardStateFromDb(state, state.activeBoard._id);\r\n\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.doneRefreshActiveBoard({\r\n                            params: payload,\r\n                            result: newState,\r\n                        }));\r\n                    } catch (e) {\r\n                        getConstructedAppStore().dispatch(kanbanBoardActions.failedRefreshActiveBoard({\r\n                            params: payload,\r\n                            error: e,\r\n                        }));\r\n                    }\r\n                })();\r\n                return state;\r\n            })\r\n            .case(kanbanBoardActions.doneRefreshActiveBoard, (state, arg) => {\r\n                return arg.result;\r\n            })\r\n            .case(kanbanBoardActions.failedRefreshActiveBoard, (state, arg) => {\r\n                return state;\r\n            })\r\n            ;\r\n    }\r\n    return kanbanBoardReducer;\r\n}\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport actionCreatorFactory,\r\n       { Action }             from 'typescript-fsa';\r\nimport { KanbanRecord,\r\n         ConfirmDialogProps } from '../types';\r\n\r\n\r\n\r\nexport interface CalendarActions {\r\n    showToday: () =>\r\n        Action<void>;\r\n    showNextMonth: () =>\r\n        Action<void>;\r\n    showPreviousMonth: () =>\r\n        Action<void>;\r\n    showNextYear: () =>\r\n        Action<void>;\r\n    showPreviousYear: () =>\r\n        Action<void>;\r\n\r\n    // from KanbanBoardActions\r\n    changeActiveBoard: (id: string) =>\r\n        Action<{boardId: string}>;\r\n    updateBoardName: (v: {boardId: string, boardName: string}) =>\r\n        Action<{boardId: string, boardName: string}>;\r\n    updateSticky: (v: KanbanRecord) =>\r\n        Action<KanbanRecord>;\r\n    archiveSticky: (kanbanId: string) =>\r\n        Action<{kanbanId: string}>;\r\n    unarchiveSticky: (kanbanId: string) =>\r\n        Action<{kanbanId: string}>;\r\n    deleteSticky: (kanbanId: string) =>\r\n        Action<{kanbanId: string}>;\r\n\r\n    // from AppEventsActions\r\n    showAlertDialog: (v: ConfirmDialogProps) =>\r\n        Action<ConfirmDialogProps>;\r\n    closeAlertDialog: () =>\r\n        Action<void>;\r\n}\r\n\r\n\r\nconst actionCreator = actionCreatorFactory();\r\n\r\nexport const calendarActions = {\r\n    showToday: actionCreator<void>('ACTIONS_SHOW_TODAY'),\r\n    showNextMonth: actionCreator<void>('ACTIONS_SHOW_NEXT_MONTH'),\r\n    showPreviousMonth: actionCreator<void>('ACTIONS_SHOW_PREVIOUS_MONTH'),\r\n    showNextYear: actionCreator<void>('ACTIONS_SHOW_NEXT_YEAR'),\r\n    showPreviousYear: actionCreator<void>('ACTIONS_SHOW_PREVIOUS_YEAR'),\r\n};\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport { reducerWithInitialState,\r\n         ReducerBuilder }         from 'typescript-fsa-reducers';\r\nimport { CalendarState }          from '../types';\r\nimport { calendarActions }        from '../actions/CalendarActions';\r\n\r\n\r\n\r\nlet calendarReducer: ReducerBuilder<CalendarState, CalendarState> = null as any;\r\n\r\nexport async function getCalendarReducer() {\r\n    if (!calendarReducer) {\r\n        const initialState: CalendarState = {\r\n            activeMonth: new Date(), // TODO: not impl\r\n        };\r\n        calendarReducer = reducerWithInitialState(initialState)\r\n            .case(calendarActions.showToday, (state) => {\r\n                const now = new Date();\r\n                const m = new Date(now.getFullYear(), now.getMonth(), 1);\r\n                return Object.assign({}, state, { activeMonth: m });\r\n            })\r\n            .case(calendarActions.showNextMonth, (state) => {\r\n                const now = state.activeMonth;\r\n                const m = new Date(now.getFullYear(), now.getMonth() + 1, 1);\r\n                return Object.assign({}, state, { activeMonth: m });\r\n            })\r\n            .case(calendarActions.showPreviousMonth, (state) => {\r\n                const now = state.activeMonth;\r\n                const m = new Date(now.getFullYear(), now.getMonth() - 1, 1);\r\n                return Object.assign({}, state, { activeMonth: m });\r\n            })\r\n            .case(calendarActions.showNextYear, (state) => {\r\n                const now = state.activeMonth;\r\n                const m = new Date(now.getFullYear() + 1, now.getMonth(), 1);\r\n                return Object.assign({}, state, { activeMonth: m });\r\n            })\r\n            .case(calendarActions.showPreviousYear, (state) => {\r\n                const now = state.activeMonth;\r\n                const m = new Date(now.getFullYear() - 1, now.getMonth(), 1);\r\n                return Object.assign({}, state, { activeMonth: m });\r\n            })\r\n            ;\r\n    }\r\n    return calendarReducer;\r\n}\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport {\r\n    reducerWithInitialState,\r\n    ReducerBuilder\r\n} from 'typescript-fsa-reducers';\r\nimport { AppEventsState } from '../types';\r\nimport { appEventsActions } from '../actions/AppEventsActions';\r\nimport {\r\n    getLocalConfigDb,\r\n    getLocalDb,\r\n    setRemoteDb\r\n} from '../lib/db';\r\nimport { getConstructedAppStore } from '../store';\r\n\r\n\r\n\r\nlet appEventsReducer: ReducerBuilder<AppEventsState, AppEventsState> = null as any;\r\n\r\nexport async function getAppEventsReducer() {\r\n    if (!appEventsReducer) {\r\n        const confDb = getLocalConfigDb();\r\n        const db = getLocalDb();\r\n\r\n        // TODO: try-catch\r\n        let resp: PouchDB.Core.AllDocsResponse<{}> = null as any;\r\n\r\n        resp = await confDb.allDocs({\r\n            include_docs: true,\r\n        });\r\n\r\n        const defaultAppConfig = {\r\n            remote: {\r\n                endpointUrl: 'http://10.194.161.78:3000/kiosk-kanban',\r\n                user: 'kiosk',\r\n                password: '0000abc!',\r\n            },\r\n            display: {\r\n                autoUpdate: true,\r\n                autoUpdateInterval: 10,\r\n            },\r\n        };\r\n\r\n        if (resp.rows.length === 0) {\r\n            await confDb.post({\r\n                type: 'appConfig',\r\n                ...defaultAppConfig,\r\n            }, {});\r\n\r\n            resp = await confDb.allDocs({\r\n                include_docs: true,\r\n            });\r\n        }\r\n\r\n        const initialState: AppEventsState = {\r\n            alertDialog: {\r\n                open: false,\r\n                title: '',\r\n                message: '',\r\n                onClose: () => void 0,\r\n            },\r\n            appConfig: {\r\n                ...defaultAppConfig,\r\n                ...resp.rows[0].doc,\r\n            } as any,\r\n        };\r\n\r\n        if (initialState.appConfig.remote && initialState.appConfig.remote.endpointUrl) {\r\n            setRemoteDb(\r\n                initialState.appConfig.remote.endpointUrl,\r\n                initialState.appConfig.remote.user || '',\r\n                initialState.appConfig.remote.password || '',\r\n            )\r\n                .then(() => {\r\n                    //\r\n                })\r\n                .catch(err => {\r\n                    alert('Failed to connect to the remote DB: ' + err.message);\r\n                });\r\n        } else {\r\n            setRemoteDb('', '', '')\r\n                .then(() => {\r\n                    //\r\n                })\r\n                .catch(err => {\r\n                    alert('Failed to connect to the remote DB: ' + err.message);\r\n                });\r\n        }\r\n\r\n        appEventsReducer = reducerWithInitialState(initialState)\r\n            .case(appEventsActions.showAlertDialog, (state, payload) => {\r\n                return Object.assign({}, state, {\r\n                    alertDialog: payload,\r\n                });\r\n            })\r\n            .case(appEventsActions.closeAlertDialog, (state) => {\r\n                return Object.assign({}, state, {\r\n                    alertDialog: initialState,\r\n                });\r\n            })\r\n\r\n            //// updateAppConfig async actions ////\r\n            .case(appEventsActions.startUpdateAppConfig, (state, payload) => {\r\n                const newConf = Object.assign({}, state.appConfig,\r\n                    payload.remote && payload.remote.endpointUrl ?\r\n                        { remote: payload.remote } :\r\n                        { remote: defaultAppConfig.remote },\r\n                    payload.display ?\r\n                        { display: payload.display } :\r\n                        { display: defaultAppConfig.display }\r\n                );\r\n\r\n                confDb.put(newConf, {})\r\n                    .then(v => {\r\n                        newConf._id = v.id;\r\n                        newConf._rev = v.rev;\r\n\r\n                        getConstructedAppStore().dispatch(appEventsActions.doneUpdateAppConfig({\r\n                            params: payload,\r\n                            result: Object.assign({}, state, { appConfig: newConf }),\r\n                        }));\r\n                        setTimeout(() => {\r\n                            getConstructedAppStore().dispatch(appEventsActions.showAlertDialog({\r\n                                open: true,\r\n                                title: 'Done',\r\n                                message: 'Settings is saved successfully',\r\n                                singleButton: true,\r\n                                onClose: () => getConstructedAppStore().dispatch(appEventsActions.closeAlertDialog()),\r\n                            }));\r\n                        }, 30);\r\n\r\n                        if (newConf.remote.endpointUrl) {\r\n                            setRemoteDb(\r\n                                newConf.remote.endpointUrl,\r\n                                newConf.remote.user,\r\n                                newConf.remote.password,\r\n                            )\r\n                                .then(() => {\r\n                                    //\r\n                                })\r\n                                .catch(err => {\r\n                                    getConstructedAppStore().dispatch(appEventsActions.showAlertDialog({\r\n                                        open: true,\r\n                                        title: 'Error',\r\n                                        message: 'Failed to connect to the remote DB: ' + err.message,\r\n                                        singleButton: true,\r\n                                        colorIsSecondary: true,\r\n                                        onClose: () => getConstructedAppStore().dispatch(appEventsActions.closeAlertDialog()),\r\n                                    }));\r\n                                });\r\n                        }\r\n                    })\r\n                    .catch(err => {\r\n                        getConstructedAppStore().dispatch(appEventsActions.failedUpdateAppConfig({\r\n                            params: payload,\r\n                            error: err,\r\n                        }));\r\n                        setTimeout(() => {\r\n                            getConstructedAppStore().dispatch(appEventsActions.showAlertDialog({\r\n                                open: true,\r\n                                title: 'Error',\r\n                                message: 'Failed to update settings: ' + err.message,\r\n                                singleButton: true,\r\n                                colorIsSecondary: true,\r\n                                onClose: () => getConstructedAppStore().dispatch(appEventsActions.closeAlertDialog()),\r\n                            }));\r\n                        }, 30);\r\n                    });\r\n\r\n                return state;\r\n            })\r\n            .case(appEventsActions.doneUpdateAppConfig, (state, arg) => {\r\n                return arg.result;\r\n            })\r\n            .case(appEventsActions.failedUpdateAppConfig, (state, arg) => {\r\n                return state;\r\n            })\r\n\r\n            //// resetApplication async actions ////\r\n            .case(appEventsActions.startResetApplication, (state) => {\r\n                (async () => {\r\n                    try {\r\n                        try {\r\n                            await setRemoteDb('', '', '');\r\n                        } catch (e) {\r\n                            alert(e);\r\n                        }\r\n                        try {\r\n                            await db.destroy({});\r\n                        } catch (e) {\r\n                            alert(e);\r\n                        }\r\n                        try {\r\n                            await confDb.destroy({});\r\n                        } catch (e) {\r\n                            alert(e);\r\n                        }\r\n\r\n                        alert('All app data and configurations are removed. Please reload page.');\r\n\r\n                        getConstructedAppStore().dispatch(appEventsActions.doneResetApplication({\r\n                            result: state,\r\n                        }));\r\n                    } catch (e) {\r\n                        alert(e);\r\n                        getConstructedAppStore().dispatch(appEventsActions.failedResetApplication({\r\n                            error: e,\r\n                        }));\r\n                    }\r\n                })();\r\n\r\n                return state;\r\n            })\r\n            .case(appEventsActions.doneUpdateAppConfig, (state, arg) => {\r\n                return arg.result;\r\n            })\r\n            .case(appEventsActions.failedUpdateAppConfig, (state, arg) => {\r\n                return state;\r\n            })\r\n            ;\r\n    }\r\n    return appEventsReducer;\r\n}\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport { createStore,\r\n         combineReducers, \r\n         applyMiddleware,\r\n         compose,\r\n         Store,\r\n         AnyAction }             from 'redux';\r\nimport { createHashHistory }     from 'history';\r\nimport { connectRouter,\r\n         routerMiddleware }      from 'connected-react-router';\r\nimport { AppState }              from './types';\r\nimport { getKanbanBoardReducer } from './states/KanbanBoardState';\r\nimport { getCalendarReducer }    from './states/CalendarState';\r\nimport { getAppEventsReducer }   from './states/AppEventsState';\r\n\r\n\r\n\r\nexport const history = createHashHistory({\r\n    hashType: 'slash',\r\n});\r\n\r\n\r\nlet store: Store<AppState, AnyAction> = null as any;\r\n\r\n\r\nexport function getConstructedAppStore() {\r\n    return store;\r\n}\r\n\r\n\r\nexport default async function getAppStore() {\r\n    if (!store) {\r\n        store = createStore(\r\n            combineReducers<AppState>({\r\n                router: connectRouter(history),\r\n                appEvents: await getAppEventsReducer(),\r\n                kanbanBoard: await getKanbanBoardReducer(),\r\n                calendar: await getCalendarReducer(),\r\n            }),\r\n            compose(\r\n                applyMiddleware(\r\n                    routerMiddleware(history),\r\n                ),\r\n            ),\r\n        );\r\n    }\r\n    return store;\r\n}\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport { Action }             from 'typescript-fsa';\r\nimport { Dispatch }           from 'redux';\r\nimport { KanbanBoardRecord,\r\n         KanbanRecord,\r\n         UpdateStickyLanesPayload,\r\n         ConfirmDialogProps,\r\n         AppState }           from '../types';\r\nimport { AppEventsActions as AppEventsActions_,\r\n         appEventsActions } from '../actions/AppEventsActions';\r\nimport { KanbanBoardActions as KanbanBoardActions_,\r\n         kanbanBoardActions } from '../actions/KanbanBoardActions';\r\n\r\n\r\n\r\nexport type AppEventsActions = AppEventsActions_;\r\nexport type KanbanBoardActions = KanbanBoardActions_;\r\n\r\n\r\nexport function mapDispatchToProps(dispatch: Dispatch<Action<any>>) {\r\n    return {\r\n        addBoard: (boardName: string) =>\r\n            dispatch(kanbanBoardActions.startAddBoard({ boardName })),\r\n        changeActiveBoard: (boardId: string) =>\r\n            dispatch(kanbanBoardActions.startChangeActiveBoard({ boardId })),\r\n        updateBoardName: (v: {boardId: string, boardName: string}) =>\r\n            dispatch(kanbanBoardActions.startUpdateBoardName(v)),\r\n        deleteBoard: (boardId: string) =>\r\n            dispatch(kanbanBoardActions.startDeleteBoard({ boardId })),\r\n\r\n        addSticky: () =>\r\n            dispatch(kanbanBoardActions.startAddSticky({})),\r\n        updateSticky: (v: KanbanRecord) =>\r\n            dispatch(kanbanBoardActions.startUpdateSticky(v)),\r\n        updateStickyLanes: (v: UpdateStickyLanesPayload) =>\r\n            dispatch(kanbanBoardActions.startUpdateStickyLanes(v)),\r\n        archiveSticky: (kanbanId: string) =>\r\n            dispatch(kanbanBoardActions.startArchiveSticky({ kanbanId })),\r\n        unarchiveSticky: (kanbanId: string) =>\r\n            dispatch(kanbanBoardActions.startUnarchiveSticky({ kanbanId })),\r\n        deleteSticky: (kanbanId: string) =>\r\n            dispatch(kanbanBoardActions.startDeleteSticky({ kanbanId })),\r\n\r\n        editBoardAndStickys: (v: KanbanBoardRecord) =>\r\n            dispatch(kanbanBoardActions.startEditBoardAndStickys(v)),\r\n\r\n        refreshActiveBoard: () =>\r\n            dispatch(kanbanBoardActions.startRefreshActiveBoard({})),\r\n\r\n        // from AppEventsActions\r\n        showAlertDialog: (v: ConfirmDialogProps) =>\r\n            dispatch(appEventsActions.showAlertDialog(v)),\r\n        closeAlertDialog: () =>\r\n            dispatch(appEventsActions.closeAlertDialog()),\r\n    };\r\n}\r\n\r\n\r\nexport function mapStateToProps(appState: AppState) {\r\n    return Object.assign({}, appState.kanbanBoard);\r\n}\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\n\r\n\r\nlet gensymSeed = 0;\r\n\r\nexport default function gensym(): string {\r\n    return `$$gensym$$_xjKvAjFXoVtro45V_${gensymSeed++}$$`;\r\n}\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport React                    from 'react';\r\nimport Button                   from '@material-ui/core/Button';\r\nimport TextField                from '@material-ui/core/TextField';\r\nimport Dialog                   from '@material-ui/core/Dialog';\r\nimport DialogActions            from '@material-ui/core/DialogActions';\r\nimport DialogContent            from '@material-ui/core/DialogContent';\r\nimport DialogContentText        from '@material-ui/core/DialogContentText';\r\nimport DialogTitle              from '@material-ui/core/DialogTitle';\r\nimport CheckIcon                from '@material-ui/icons/Check';\r\nimport CancelIcon               from '@material-ui/icons/Cancel';\r\nimport { useTheme }             from '@material-ui/core/styles';\r\nimport gensym                   from '../lib/gensym';\r\nimport { TextInputDialogProps } from '../types';\r\n\r\n\r\n\r\nconst TextInputDialog: React.FC<TextInputDialogProps> = (props) => {\r\n    const theme = useTheme();\r\n    const [open, setOpen] = React.useState(props.open);\r\n    const [value, setValue] = React.useState(props.value);\r\n\r\n    const formDialogTitleId = gensym();\r\n\r\n    function handleCancelClick() {\r\n        setOpen(false);\r\n        props.onClose(false);\r\n    }\r\n\r\n    function handleApplyClick() {\r\n        setOpen(false);\r\n        props.onClose(true, value);\r\n    }\r\n\r\n    function handleValueChange(event: React.ChangeEvent<HTMLInputElement>) {\r\n        setValue(event.target.value);\r\n    }\r\n\r\n    return (\r\n        <Dialog open={open} onClose={handleCancelClick} aria-labelledby={formDialogTitleId}>\r\n            <DialogTitle id={formDialogTitleId}>{props.title}</DialogTitle>\r\n            <DialogContent>\r\n                {props.message ?\r\n                    <DialogContentText>{props.message}</DialogContentText> :\r\n                    <></>\r\n                }\r\n                <TextField\r\n                    autoFocus\r\n                    margin=\"dense\"\r\n                    label={props.fieldLabel}\r\n                    fullWidth\r\n                    value={value}\r\n                    error={props.validator ? props.validator(value) : false}\r\n                    onChange={handleValueChange}\r\n                />\r\n            </DialogContent>\r\n            <DialogActions>\r\n                <Button\r\n                    variant=\"outlined\"\r\n                    color=\"default\"\r\n                    onClick={handleCancelClick}>\r\n                    <CancelIcon /><span style={{marginLeft: theme.spacing(1)}} />{props.cancelButtonCaption || 'Cancel'}\r\n                </Button>\r\n                <Button\r\n                    variant=\"contained\"\r\n                    color={props.colorIsSecondary ? 'secondary' : 'primary'}\r\n                    disabled={props.validator ? props.validator(value) : false}\r\n                    onClick={handleApplyClick}>\r\n                    <CheckIcon /><span style={{marginLeft: theme.spacing(1)}} />{props.applyButtonCaption || 'Apply'}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n}\r\nexport default TextInputDialog;\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport {\r\n    withRouter,\r\n    RouteChildrenProps\r\n} from 'react-router';\r\nimport Drawer from '@material-ui/core/Drawer';\r\nimport Divider from '@material-ui/core/Divider';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport ChevronLeftIcon from '@material-ui/icons/ChevronLeft';\r\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight';\r\nimport AddBoxIcon from '@material-ui/icons/AddBox';\r\nimport TableChartIcon from '@material-ui/icons/TableChart';\r\nimport CalendarTodayIcon from '@material-ui/icons/CalendarToday';\r\nimport EditIcon from '@material-ui/icons/Edit';\r\nimport SettingsIcon from '@material-ui/icons/Settings';\r\nimport HelpIcon from '@material-ui/icons/Help';\r\nimport ExpandLessIcon from '@material-ui/icons/ExpandLess';\r\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore';\r\nimport Collapse from '@material-ui/core/Collapse';\r\nimport List from '@material-ui/core/List';\r\nimport ListSubheader from '@material-ui/core/ListSubheader';\r\nimport ListItem from '@material-ui/core/ListItem';\r\nimport ListItemIcon from '@material-ui/core/ListItemIcon';\r\nimport ListItemText from '@material-ui/core/ListItemText';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport useMediaQuery from '@material-ui/core/useMediaQuery';\r\nimport clsx from 'clsx';\r\nimport { KanbanBoardState } from '../types';\r\nimport {\r\n    mapDispatchToProps,\r\n    mapStateToProps,\r\n    KanbanBoardActions\r\n} from '../dispatchers/KanbanBoardDispatcher';\r\nimport { getCurrentView } from '../lib/util';\r\nimport TextInputDialog from '../components/TextInputDialog';\r\n\r\n\r\n\r\ntype AppDrawerProps = KanbanBoardState & KanbanBoardActions & RouteChildrenProps<{}>;\r\n\r\n\r\nconst drawerWidth = 240;\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    drawer: {\r\n        width: drawerWidth,\r\n        flexShrink: 0,\r\n        whiteSpace: 'nowrap',\r\n    },\r\n    drawerOpen: {\r\n        width: drawerWidth,\r\n        transition: theme.transitions.create('width', {\r\n            easing: theme.transitions.easing.sharp,\r\n            duration: theme.transitions.duration.enteringScreen,\r\n        }),\r\n    },\r\n    drawerClose: {\r\n        transition: theme.transitions.create('width', {\r\n            easing: theme.transitions.easing.sharp,\r\n            duration: theme.transitions.duration.leavingScreen,\r\n        }),\r\n        overflowX: 'hidden',\r\n        width: theme.spacing(6) + 1,\r\n        [theme.breakpoints.up('sm')]: {\r\n            width: theme.spacing(6) + 1,\r\n        },\r\n    },\r\n    nested: {\r\n        paddingLeft: theme.spacing(4),\r\n    },\r\n}));\r\n\r\n\r\nconst AppDrawer: React.FC<AppDrawerProps> = (props) => {\r\n    const classes = useStyles();\r\n    const [open, setOpen] = React.useState(true);\r\n    const [textInputOpen, setTextInputOpen] = React.useState({\r\n        open: false,\r\n        title: '',\r\n        message: '',\r\n        fieldLabel: '',\r\n        value: '',\r\n        validator: (value: string) => value.trim().length <= 0,\r\n        onClose: handleCloseDialogAddNewBoard,\r\n    });\r\n    const [boardsOpen, setBoardsOpen] = React.useState(true);\r\n    const matchesPrint = useMediaQuery('print');\r\n\r\n    function handleDrawerToggle() {\r\n        setOpen(!open);\r\n    }\r\n\r\n    function handleClickChangeActiveBoard(id: string) {\r\n        let view = 'kanban';\r\n        if (props.history.location.pathname) {\r\n            if (props.history.location.pathname.startsWith('/calendar/')) {\r\n                view = 'calendar';\r\n            } else if (props.history.location.pathname.startsWith('/edit/')) {\r\n                view = 'edit';\r\n            }\r\n        }\r\n        props.history.push(`/${view}/${id}`);\r\n    }\r\n\r\n    function handleClickAddNewBoard() {\r\n        setTextInputOpen(Object.assign({}, textInputOpen, {\r\n            open: true,\r\n            title: 'New board',\r\n            message: '',\r\n            fieldLabel: 'Board name',\r\n            value: '',\r\n        }));\r\n    }\r\n\r\n    function handleCloseDialogAddNewBoard(apply: boolean, value?: string) {\r\n        setTextInputOpen(Object.assign({}, textInputOpen, { open: false }));\r\n        if (apply && value) {\r\n            props.addBoard(value);\r\n        }\r\n    }\r\n\r\n    function handleChangeView(viewName: string, id: string) {\r\n        if (id === props.activeBoardId) {\r\n            props.history.push(`/${viewName}/${id}`);\r\n        }\r\n    }\r\n\r\n    function handleBoardsOpenClick() {\r\n        setBoardsOpen(!boardsOpen);\r\n    }\r\n\r\n    let currentView = getCurrentView(props.history);\r\n\r\n    return (\r\n        <>\r\n            {!matchesPrint ?\r\n                <Drawer\r\n                    variant=\"permanent\"\r\n                    className={clsx(classes.drawer, {\r\n                        [classes.drawerOpen]: open,\r\n                        [classes.drawerClose]: !open,\r\n                    })}\r\n                    classes={{\r\n                        paper: clsx({\r\n                            [classes.drawerOpen]: open,\r\n                            [classes.drawerClose]: !open,\r\n                        }),\r\n                    }}\r\n                    anchor=\"left\"\r\n                    open={open}\r\n                >\r\n                    <div className={''}>\r\n                        <IconButton onClick={handleDrawerToggle}>\r\n                            {open ? <ChevronLeftIcon /> : <ChevronRightIcon />}\r\n                        </IconButton>\r\n                    </div>\r\n                    <Divider />\r\n                    {open ?\r\n                        <>\r\n                            <List\r\n                                component=\"nav\"\r\n                                aria-labelledby=\"nested-list-subheader\"\r\n                                subheader={\r\n                                    <ListSubheader component=\"div\" id=\"nested-list-subheader\">\r\n                                        Boards\r\n                                    </ListSubheader>\r\n                                }>\r\n                                <ListItem button\r\n                                    onClick={handleBoardsOpenClick}>\r\n                                    {boardsOpen ? <ExpandLessIcon /> : <ExpandMoreIcon />}\r\n                                </ListItem>\r\n                                {props.activeBoardId ?\r\n                                    <>\r\n                                        <Collapse in={boardsOpen} timeout=\"auto\" unmountOnExit>\r\n                                            <List component=\"div\" disablePadding>\r\n                                                {props.boards.map(x =>\r\n                                                    <ListItem button\r\n                                                        key={x._id}\r\n                                                        selected={x._id === props.activeBoardId}\r\n                                                        className={clsx(classes.nested)}\r\n                                                        style={{ fontWeight: x._id === props.activeBoardId ? 'bold' : 'normal' }}\r\n                                                        onClick={ev => handleClickChangeActiveBoard(x._id)} >\r\n                                                        <ListItemText\r\n                                                            primary={x.name} />\r\n                                                    </ListItem>\r\n                                                )}\r\n                                            </List>\r\n                                        </Collapse>\r\n                                    </> :\r\n                                    <></>\r\n                                }\r\n                            </List>\r\n                            <ListItem button\r\n                                onClick={handleClickAddNewBoard}>\r\n                                <ListItemIcon><AddBoxIcon /></ListItemIcon>\r\n                                <ListItemText primary=\"New board...\" />\r\n                            </ListItem>\r\n                            <Divider />\r\n                        </> :\r\n                        <></>\r\n                    }\r\n                    <List>\r\n                        {/* settings */}\r\n                        <ListItem button\r\n                            selected={currentView === 'kanban' || currentView === ''}\r\n                            onClick={ev => handleChangeView('kanban', props.activeBoardId)}>\r\n                            <ListItemIcon><TableChartIcon /></ListItemIcon>\r\n                            {open ? <ListItemText primary=\"Kanban\" /> : <></>}\r\n                        </ListItem>\r\n                        <ListItem button\r\n                            selected={currentView === 'calendar'}\r\n                            onClick={ev => handleChangeView('calendar', props.activeBoardId)}>\r\n                            <ListItemIcon><CalendarTodayIcon /></ListItemIcon>\r\n                            {open ? <ListItemText primary=\"Calendar\" /> : <></>}\r\n                        </ListItem>\r\n                        <ListItem button\r\n                            selected={currentView === 'edit'}\r\n                            onClick={ev => handleChangeView('edit', props.activeBoardId)}>\r\n                            <ListItemIcon><EditIcon /></ListItemIcon>\r\n                            {open ? <ListItemText primary=\"Editor\" /> : <></>}\r\n                        </ListItem>\r\n                    </List>\r\n                    {open ?\r\n                        <>\r\n                            <Divider />\r\n                            <ListItem button\r\n                                selected={currentView === 'config'}\r\n                                onClick={ev => props.history.push(`/config/`)}>\r\n                                <ListItemIcon><SettingsIcon /></ListItemIcon>\r\n                                {open ? <ListItemText primary=\"Settings\" /> : <></>}\r\n                            </ListItem>\r\n                            <List>\r\n                                <ListItem button>\r\n                                    <ListItemIcon><HelpIcon /></ListItemIcon>\r\n                                    {open ? <ListItemText primary=\"Help\" /> : <></>}\r\n                                </ListItem>\r\n                            </List>\r\n                        </> :\r\n                        <></>\r\n                    }\r\n                </Drawer> :\r\n                <></>\r\n            }\r\n            {textInputOpen.open ?\r\n                <TextInputDialog\r\n                    open={true}\r\n                    title={textInputOpen.title}\r\n                    message={textInputOpen.message}\r\n                    fieldLabel={textInputOpen.fieldLabel}\r\n                    value={textInputOpen.value}\r\n                    validator={textInputOpen.validator}\r\n                    onClose={textInputOpen.onClose} /> :\r\n                <></>\r\n            }\r\n        </>\r\n    );\r\n}\r\nexport default (withRouter(connect(mapStateToProps, mapDispatchToProps)(AppDrawer) as any) as any) as React.FC;\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport React                  from 'react';\r\nimport Button                 from '@material-ui/core/Button';\r\nimport TextField              from '@material-ui/core/TextField';\r\nimport Dialog                 from '@material-ui/core/Dialog';\r\nimport DialogActions          from '@material-ui/core/DialogActions';\r\nimport DialogContent          from '@material-ui/core/DialogContent';\r\nimport DialogContentText      from '@material-ui/core/DialogContentText';\r\nimport DialogTitle            from '@material-ui/core/DialogTitle';\r\nimport CheckIcon              from '@material-ui/icons/Check';\r\nimport CancelIcon             from '@material-ui/icons/Cancel';\r\nimport { useTheme }           from '@material-ui/core/styles';\r\nimport gensym                 from '../lib/gensym';\r\nimport { ConfirmDialogProps } from '../types';\r\n\r\n\r\n\r\nconst ConfirmDialog: React.FC<ConfirmDialogProps> = (props) => {\r\n    const theme = useTheme();\r\n    const [open, setOpen] = React.useState(props.open);\r\n    const [inputValue, setInputValue] = React.useState('');\r\n\r\n    const formDialogTitleId = gensym();\r\n\r\n    function handleCancelClick() {\r\n        setOpen(false);\r\n        props.onClose(false);\r\n    }\r\n\r\n    function handleApplyClick() {\r\n        if (props.confirmingTextValue && props.confirmingTextValue !== inputValue) {\r\n            return;\r\n        }\r\n        setOpen(false);\r\n        props.onClose(true);\r\n    }\r\n\r\n    function handleValueChange(event: React.ChangeEvent<HTMLInputElement>) {\r\n        setInputValue(event.target.value);\r\n    }\r\n\r\n    return (\r\n        <Dialog open={open} onClose={handleCancelClick} aria-labelledby={formDialogTitleId}>\r\n            {props.fab ? props.fab : <></>}\r\n            <DialogTitle id={formDialogTitleId} style={{textAlign: 'center'}}>{props.title}</DialogTitle>\r\n            <DialogContent>\r\n                <DialogContentText style={{textAlign: 'center'}}>\r\n                    {(props.message || '').split('\\n').map((x, index, arr) =>\r\n                        <span key={'content-' + index}>\r\n                            {x}\r\n                            {index <= (arr.length - 1) ? <br/> : <></>}\r\n                        </span>)\r\n                    }\r\n                </DialogContentText>\r\n            </DialogContent>\r\n            {props.confirmingTextValue ?\r\n                <TextField\r\n                    autoFocus\r\n                    margin=\"dense\"\r\n                    label={props.confirmingTextLabel}\r\n                    value={inputValue}\r\n                    onChange={handleValueChange}\r\n                    style={{marginLeft: theme.spacing(1), marginRight: theme.spacing(1), marginBottom: theme.spacing(1)}}\r\n                    /> :\r\n                    <></>\r\n            }\r\n            <DialogActions style={{margin: 'auto'}}>\r\n                {!props.singleButton?\r\n                    <Button\r\n                        variant=\"outlined\"\r\n                        color=\"default\"\r\n                        onClick={handleCancelClick} >\r\n                        <CancelIcon /><span style={{marginLeft: theme.spacing(1)}} />{props.cancelButtonCaption || 'Cancel'}\r\n                    </Button> :\r\n                    <></>\r\n                }\r\n                <Button\r\n                    variant=\"contained\"\r\n                    color={props.colorIsSecondary ? 'secondary' : 'primary'}\r\n                    disabled={props.confirmingTextValue ? inputValue !== props.confirmingTextValue : false}\r\n                    onClick={handleApplyClick} >\r\n                    <CheckIcon /><span style={{marginLeft: theme.spacing(1)}} />{props.applyButtonCaption || 'Apply'}\r\n                </Button>\r\n            </DialogActions>\r\n        </Dialog>\r\n    );\r\n}\r\nexport default ConfirmDialog;\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\n\r\nimport { parserInput }        from 'fruitsconfits/modules/lib/types';\r\nimport { formatErrorMessage } from 'fruitsconfits/modules/lib/parser';\r\nimport { getStringParsers }   from 'fruitsconfits/modules/lib/string-parser';\r\n\r\n\r\n\r\ntype Ctx = undefined;\r\ntype Ast = string | string[];\r\n\r\n\r\nconst $s = getStringParsers<Ctx, Ast>({\r\n    rawToToken: rawToken => rawToken,\r\n    concatTokens: tokens => (tokens.length ?\r\n        [tokens.reduce((a, b) => a as string + b as string)] : []),\r\n});\r\n\r\nconst {seq, cls, notCls, classes, cat,\r\n        repeat, end, first, combine, erase, trans, ahead,\r\n        makeProgram} = $s;\r\n\r\n\r\nconst quoted = trans(input => input.length ? input : [''])(\r\n    erase(repeat(classes.spaceWithinSingleLine), cls('\"')),\r\n    cat(repeat(first(\r\n        trans(input => ['\"'])(seq('\"\"')),\r\n        notCls('\"'), ))),\r\n    erase(cls('\"'), repeat(erase(classes.spaceWithinSingleLine))), );\r\n\r\nconst nakid = trans(input => input.length ? input : [''])(\r\n    erase(repeat(classes.spaceWithinSingleLine)),\r\n    cat(repeat(first(\r\n        erase(classes.spaceWithinSingleLine, ahead(cls(',', '\\r\\n', '\\n', '\\r'))),\r\n        notCls(',', '\\r\\n', '\\n', '\\r'), ))));\r\n\r\nconst cell = first(quoted, nakid);\r\n\r\nconst row = trans(input => [input as string[]])(\r\n    cell,\r\n    repeat(combine(erase(seq(',')), cell)), );\r\n\r\nconst rows = makeProgram(combine(\r\n    row,\r\n    repeat(combine(erase(classes.newline), row)),\r\n    end(), ));\r\n\r\n\r\nexport function parse(s: string) {\r\n    const z = rows(parserInput(s));\r\n    if (! z.succeeded) {\r\n        throw new Error(formatErrorMessage(z));\r\n    }\r\n    return z.tokens as string[][];\r\n}\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport React                      from 'react';\r\nimport                                 'date-fns';\r\nimport DateFnsUtils               from '@date-io/date-fns';\r\nimport { MaterialUiPickersDate }  from '@material-ui/pickers/typings/date';\r\nimport { MuiPickersUtilsProvider,\r\n         KeyboardDatePicker }     from '@material-ui/pickers';\r\nimport Button                     from '@material-ui/core/Button';\r\nimport TextField                  from '@material-ui/core/TextField';\r\nimport Select                     from '@material-ui/core/Select';\r\nimport MenuItem                   from '@material-ui/core/MenuItem';\r\nimport InputLabel                 from '@material-ui/core/InputLabel';\r\nimport FormControl                from '@material-ui/core/FormControl';\r\nimport Dialog                     from '@material-ui/core/Dialog';\r\nimport DialogActions              from '@material-ui/core/DialogActions';\r\nimport DialogContent              from '@material-ui/core/DialogContent';\r\nimport DialogTitle                from '@material-ui/core/DialogTitle';\r\nimport Typography                 from '@material-ui/core/Typography';\r\nimport Fab                        from '@material-ui/core/Fab';\r\nimport ArchiveIcon                from '@material-ui/icons/Archive';\r\nimport UnarchiveIcon              from '@material-ui/icons/Unarchive';\r\nimport DeleteIcon                 from '@material-ui/icons/Delete';\r\nimport CheckIcon                  from '@material-ui/icons/Check';\r\nimport CancelIcon                 from '@material-ui/icons/Cancel';\r\nimport { makeStyles,\r\n         useTheme }               from '@material-ui/core/styles';\r\nimport clsx                       from 'clsx';\r\nimport gensym                     from '../lib/gensym';\r\nimport { KanbanDialogProps }      from '../types';\r\nimport { formatDate,\r\n         parseISODate }           from '../lib/datetime';\r\nimport ConfirmDialog              from '../components/ConfirmDialog';\r\nimport { parse as parseCsv }      from '../lib/csv';\r\n\r\n\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    formControl: {\r\n        minWidth: 220,\r\n    },\r\n    icon: {\r\n        margin: theme.spacing(1),\r\n        fontSize: 26,\r\n    },\r\n    fabDelete: {\r\n        position: 'absolute',\r\n        margin: theme.spacing(1),\r\n        right: theme.spacing(1),\r\n        top: theme.spacing(1),\r\n    },\r\n}));\r\n\r\n\r\nconst KanbanDialog: React.FC<KanbanDialogProps> = (props) => {\r\n    const classes = useStyles();\r\n    const theme = useTheme();\r\n\r\n    const [open, setOpen] = React.useState(props.open);\r\n    const [confirmOpen, setConfirmOpen] = React.useState(false);\r\n    const [description, setDescription] = React.useState(props.record.description);\r\n    const [barcode, setBarcode] = React.useState(props.record.barcode);\r\n    const [memo, setMemo] = React.useState(props.record.memo);\r\n    const [tags, setTags] = React.useState(props.record.tags ?\r\n        props.record.tags.map(x => x.includes(',') ? `\"${x.replace(/\"/g, '\"\"')}\"` : x).join(', ') : '');\r\n    const [flags, setFlags] = React.useState(props.record.flags ?\r\n        props.record.flags.map(x => x.includes(',') ? `\"${x.replace(/\"/g, '\"\"')}\"` : x).join(', ') : '');\r\n    const [dueDate, setDueDate] = React.useState<MaterialUiPickersDate>(parseISODate(props.record.dueDate));\r\n    const [taskStatus, setTaskStatus] = React.useState(props.record.taskStatus);\r\n    const [teamOrStory, setTeamOrStory] = React.useState(props.record.teamOrStory);\r\n\r\n    const formDialogTitleId = gensym();\r\n    const taskStatusesId = gensym();\r\n    const teamOrStoryId = gensym();\r\n\r\n    const archived = props.record.flags ? props.record.flags.includes('Archived') : false;\r\n\r\n    function handleCancelClick() {\r\n        setOpen(false);\r\n        props.onCancel();\r\n    }\r\n\r\n    function handleApplyClick() {\r\n        setOpen(false);\r\n\r\n        const tagsTrimmed = tags.trim();\r\n        const tagsParsed = tagsTrimmed ? parseCsv(tagsTrimmed) : [];\r\n\r\n        const flagsTrimmed = flags.trim();\r\n        const flagsParsed = flagsTrimmed ? parseCsv(flagsTrimmed) : [];\r\n\r\n        props.onApply(Object.assign({}, props.record, {\r\n            description,\r\n            barcode,\r\n            memo,\r\n            tags: (tagsParsed[0] || []).map(x => x.trim()).filter(x => x.length > 0),\r\n            flags: (flagsParsed[0] || []).map(x => x.trim()).filter(x => x.length > 0),\r\n            dueDate: (dueDate && !Number.isNaN(dueDate.getTime())) ? formatDate(dueDate) : '',\r\n            taskStatus,\r\n            teamOrStory,\r\n        }));\r\n    }\r\n\r\n    function handleArchiveOrDeleteClick() {\r\n        setConfirmOpen(true);\r\n    }\r\n\r\n    function handleDescriptionChange(event: React.ChangeEvent<HTMLTextAreaElement>) {\r\n        setDescription(event.target.value);\r\n    }\r\n\r\n    function handleDueDateChange(date: MaterialUiPickersDate) {\r\n        setDueDate(date);\r\n    }\r\n\r\n    function handleTaskStatusChange(event: React.ChangeEvent<{name?: string, value: unknown}>) {\r\n        if (! event.target.name) {\r\n            return;\r\n        }\r\n        setTaskStatus(event.target.value as string);\r\n    }\r\n\r\n    function handleTeamOrStoryChange(event: React.ChangeEvent<{name?: string, value: unknown}>) {\r\n        if (! event.target.name) {\r\n            return;\r\n        }\r\n        setTeamOrStory(event.target.value as string);\r\n    }\r\n\r\n    function handleTagsChange(event: React.ChangeEvent<HTMLTextAreaElement>) {\r\n        setTags(event.target.value);\r\n    }\r\n\r\n    function handleFlagsChange(event: React.ChangeEvent<HTMLTextAreaElement>) {\r\n        setFlags(event.target.value);\r\n    }\r\n\r\n    function handleBarcodeChange(event: React.ChangeEvent<HTMLTextAreaElement>) {\r\n        setBarcode(event.target.value);\r\n    }\r\n\r\n    function handleMemoChange(event: React.ChangeEvent<HTMLTextAreaElement>) {\r\n        setMemo(event.target.value);\r\n    }\r\n\r\n    function handleConfirmArchiving(apply: boolean) {\r\n        setConfirmOpen(false);\r\n        if (apply) {\r\n            setOpen(false);\r\n            props.onArchive(props.record._id);\r\n        }\r\n    }\r\n\r\n    function handleConfirmUnarchiving(apply: boolean) {\r\n        setConfirmOpen(false);\r\n        if (apply) {\r\n            setOpen(false);\r\n            props.onUnarchive(props.record._id);\r\n        }\r\n    }\r\n\r\n    function handleConfirmDeleting(apply: boolean) {\r\n        setConfirmOpen(false);\r\n        if (apply) {\r\n            setOpen(false);\r\n            props.onDelete(props.record._id);\r\n        }\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <Dialog open={open} onClose={handleCancelClick} aria-labelledby={formDialogTitleId}>\r\n                <DialogTitle id={formDialogTitleId} style={{paddingBottom: '0'}}>\r\n                    Edit Kanban\r\n                    <Button\r\n                        className={clsx(classes.fabDelete)}\r\n                        variant=\"outlined\"\r\n                        color={props.board.preferArchive ? 'default' : 'secondary'}\r\n                        onClick={handleArchiveOrDeleteClick} >\r\n                        {props.board.preferArchive ?\r\n                            (archived ? <UnarchiveIcon /> : <ArchiveIcon />) :\r\n                            <DeleteIcon color=\"secondary\" />}\r\n                        <Typography variant=\"body1\" color={props.board.preferArchive ? 'initial' : 'secondary'}\r\n                            style={{marginLeft: theme.spacing(1)}} >\r\n                            {props.board.preferArchive ?\r\n                                (archived ? 'Unarchive' : 'Archive') :\r\n                                'Delete'}\r\n                        </Typography>\r\n                    </Button>\r\n                </DialogTitle>\r\n                <DialogContent>\r\n                    <MuiPickersUtilsProvider utils={DateFnsUtils}>\r\n                        <div>\r\n                            <TextField\r\n                                margin=\"dense\"\r\n                                label=\"Description\"\r\n                                multiline\r\n                                rows={4}\r\n                                rowsMax={16}\r\n                                fullWidth\r\n                                value={description}\r\n                                onChange={handleDescriptionChange}\r\n                                helperText=\"Markdown syntax is available\"\r\n                                />\r\n                        </div>\r\n                        <div>\r\n                            <KeyboardDatePicker\r\n                                margin=\"dense\"\r\n                                label=\"Due date\"\r\n                                format=\"yyyy-MM-dd\"\r\n                                KeyboardButtonProps={{\r\n                                    'aria-label': 'change date',\r\n                                }}\r\n                                value={dueDate}\r\n                                onChange={handleDueDateChange}\r\n                                />\r\n                        </div>\r\n                        <div>\r\n                            <FormControl className={clsx(classes.formControl)} style={{marginTop: '5px'}}>\r\n                                <InputLabel htmlFor={taskStatusesId}>Status</InputLabel>\r\n                                <Select\r\n                                    value={taskStatus}\r\n                                    onChange={handleTaskStatusChange}\r\n                                    inputProps={{\r\n                                        name: 'taskStatus',\r\n                                        id: taskStatusesId,\r\n                                    }}\r\n                                    >\r\n                                    {props.taskStatuses.map(x => (\r\n                                        <MenuItem key={x.value} value={x.value}>{x.caption || x.value}</MenuItem>\r\n                                    ))}\r\n                                </Select>\r\n                            </FormControl>\r\n                            <FormControl className={clsx(classes.formControl)} style={{marginLeft: theme.spacing(1), marginTop: '5px'}}>\r\n                                <InputLabel htmlFor={teamOrStoryId}>Team / Story</InputLabel>\r\n                                <Select\r\n                                    value={teamOrStory}\r\n                                    onChange={handleTeamOrStoryChange}\r\n                                    inputProps={{\r\n                                        name: 'teamOrStory',\r\n                                        id: teamOrStoryId,\r\n                                    }}\r\n                                    >\r\n                                    {props.teamOrStories.map(x => (\r\n                                        <MenuItem key={x.value} value={x.value}>{x.caption || x.value}</MenuItem>\r\n                                    ))}\r\n                                </Select>\r\n                            </FormControl>\r\n                        </div>\r\n                        {props.board.displayTags && props.board.displayFlags ?\r\n                            <div>\r\n                                <FormControl className={clsx(classes.formControl)} style={{marginTop: '5px'}}>\r\n                                    <TextField\r\n                                        margin=\"dense\"\r\n                                        label=\"Tags\"\r\n                                        value={tags}\r\n                                        onChange={handleTagsChange}\r\n                                        helperText=\"Separate with commas (Excel CSV syntax)\"\r\n                                        />\r\n                                </FormControl>\r\n                                <FormControl className={clsx(classes.formControl)} style={{marginLeft: theme.spacing(1), marginTop: '5px'}}>\r\n                                    <TextField\r\n                                        margin=\"dense\"\r\n                                        label=\"Flags\"\r\n                                        value={flags}\r\n                                        onChange={handleFlagsChange}\r\n                                        helperText=\"Separate with commas (Excel CSV syntax)\"\r\n                                        />\r\n                                </FormControl>\r\n                            </div> :\r\n                            <></>\r\n                        }\r\n                        {props.board.displayTags && !props.board.displayFlags ?\r\n                            <div>\r\n                                <TextField\r\n                                    margin=\"dense\"\r\n                                    label=\"Tags\"\r\n                                    fullWidth\r\n                                    value={tags}\r\n                                    onChange={handleTagsChange}\r\n                                    helperText=\"Separate with commas (Excel CSV syntax)\"\r\n                                    />\r\n                            </div> :\r\n                            <></>\r\n                        }\r\n                        {props.board.displayFlags && !props.board.displayTags ?\r\n                            <div>\r\n                                <TextField\r\n                                    margin=\"dense\"\r\n                                    label=\"Flags\"\r\n                                    fullWidth\r\n                                    value={flags}\r\n                                    onChange={handleFlagsChange}\r\n                                    helperText=\"Separate with commas (Excel CSV syntax)\"\r\n                                    />\r\n                            </div> :\r\n                            <></>\r\n                        }\r\n                        {props.board.displayBarcode ?\r\n                            <div>\r\n                                <TextField\r\n                                    margin=\"dense\"\r\n                                    label=\"Barcode\"\r\n                                    multiline\r\n                                    rows={1}\r\n                                    rowsMax={16}\r\n                                    fullWidth\r\n                                    value={barcode}\r\n                                    onChange={handleBarcodeChange}\r\n                                    />\r\n                            </div> :\r\n                            <></>\r\n                        }\r\n                        {props.board.displayMemo ?\r\n                            <div>\r\n                                <TextField\r\n                                    margin=\"dense\"\r\n                                    label=\"Memo\"\r\n                                    multiline\r\n                                    rows={1}\r\n                                    rowsMax={16}\r\n                                    fullWidth\r\n                                    value={memo}\r\n                                    onChange={handleMemoChange}\r\n                                    />\r\n                            </div> :\r\n                            <></>\r\n                        }\r\n                    </MuiPickersUtilsProvider>\r\n                </DialogContent>\r\n                <DialogActions>\r\n                    <Button onClick={handleCancelClick} variant=\"outlined\" color=\"default\">\r\n                        <CancelIcon /><span style={{marginLeft: theme.spacing(1)}} />Cancel\r\n                    </Button>\r\n                    <Button onClick={handleApplyClick} variant=\"contained\" color=\"primary\">\r\n                        <CheckIcon /><span style={{marginLeft: theme.spacing(1)}} />Apply\r\n                    </Button>\r\n                </DialogActions>\r\n            </Dialog>\r\n            {confirmOpen ?\r\n                <ConfirmDialog\r\n                    open={true}\r\n                    title={props.board.preferArchive ?\r\n                        (archived ? 'Unarchive kanban' : 'Archive kanban') :\r\n                        'Delete kanban'}\r\n                    message={`Are you sure want to ${props.board.preferArchive ?\r\n                        (archived ? 'unarchive' : 'archive') :\r\n                        'delete'} the kanban?`}\r\n                    colorIsSecondary={props.board.preferArchive ? false : true}\r\n                    applyButtonCaption={props.board.preferArchive ?\r\n                        (archived ? 'Unarchive' : 'Archive') :\r\n                        'Delete'}\r\n                    fab={props.board.preferArchive ?\r\n                        (archived ?\r\n                            <Fab size=\"large\" variant=\"round\" aria-label=\"unarchive\" style={{margin: 'auto'}}>\r\n                                <UnarchiveIcon />\r\n                            </Fab> :\r\n                            <Fab size=\"large\" variant=\"round\" aria-label=\"archive\" style={{margin: 'auto'}}>\r\n                                <ArchiveIcon />\r\n                            </Fab>\r\n                        ) :\r\n                        <Fab size=\"large\" variant=\"round\" aria-label=\"delete\" color=\"secondary\" style={{margin: 'auto'}}>\r\n                            <DeleteIcon />\r\n                        </Fab>\r\n                    }\r\n                    onClose={props.board.preferArchive ?\r\n                        (archived ? handleConfirmUnarchiving : handleConfirmArchiving):\r\n                        handleConfirmDeleting} /> :\r\n                <></>\r\n            }\r\n        </>\r\n    );\r\n}\r\nexport default KanbanDialog;\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport React                      from 'react';\r\nimport { connect }                from 'react-redux';\r\nimport { RouteComponentProps }    from 'react-router-dom';\r\nimport { makeStyles,\r\n         useTheme }               from '@material-ui/core/styles';\r\nimport Typography                 from '@material-ui/core/Typography';\r\nimport IconButton                 from '@material-ui/core/IconButton';\r\nimport AddBoxIcon                 from '@material-ui/icons/AddBox';\r\nimport clsx                       from 'clsx';\r\nimport marked                     from 'marked';\r\nimport createDOMPurify            from 'dompurify';\r\nimport { Qr }                     from 'red-agate-barcode/modules/barcode/Qr';\r\nimport { LaneDef,\r\n         StatusLaneDef,\r\n         KanbanRecord,\r\n         KanbanBoardState, \r\n         KanbanBoardRecord }      from '../types';\r\nimport gensym                     from '../lib/gensym';\r\nimport { parseISODate }           from '../lib/datetime';\r\nimport { isDark }                 from '../lib/theme';\r\nimport { mapDispatchToProps,\r\n         mapStateToProps,\r\n         KanbanBoardActions }     from '../dispatchers/KanbanBoardDispatcher';\r\nimport KanbanDialog               from '../components/KanbanDialog';\r\nimport TextInputDialog            from '../components/TextInputDialog';\r\nimport { getConstructedAppStore } from '../store';\r\nimport                                 './KanbanBoardView.css';\r\n\r\n\r\n\r\ntype StickysProps = KanbanBoardActions & {\r\n    records: KanbanRecord[],\r\n    taskStatus: StatusLaneDef,\r\n    teamOrStory: LaneDef,\r\n    taskStatuses: StatusLaneDef[],\r\n    teamOrStories: LaneDef[],\r\n    board: KanbanBoardRecord,\r\n};\r\n\r\ntype StickyProps = KanbanBoardActions & {\r\n    record: KanbanRecord,\r\n    taskStatus: StatusLaneDef,\r\n    teamOrStory: LaneDef,\r\n    taskStatuses: StatusLaneDef[],\r\n    teamOrStories: LaneDef[],\r\n    board: KanbanBoardRecord,\r\n};\r\n\r\ntype KanbanBoardViewProps = KanbanBoardState & KanbanBoardActions & RouteComponentProps<{id: string}> & {\r\n};\r\n\r\n\r\nconst DOMPurify = createDOMPurify(window);\r\n\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    root: {},\r\n    smallIcon: {\r\n        width: '20px',\r\n        height: '20px',\r\n    },\r\n}));\r\n\r\n\r\nconst mapNeverStateToProps = () => ({});\r\n\r\nconst agent = window.navigator.userAgent.toLowerCase();\r\nconst firefox = (agent.indexOf('firefox') !== -1);\r\n\r\n\r\nconst Sticky_: React.FC<StickyProps> = (props) => {\r\n    const [open, setOpen] = React.useState(false);\r\n\r\n    const now = new Date();\r\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n    const dueDate = props.record.dueDate ? parseISODate(props.record.dueDate) : null;\r\n    const expired = (! props.taskStatus.completed) &&\r\n        (dueDate ? dueDate < today : false);\r\n\r\n    function handleOnDragStart(ev: React.DragEvent) {\r\n        ev.dataTransfer.setData('elId', (ev.target as any).id);\r\n    }\r\n\r\n    function handleEditApply(rec: KanbanRecord) {\r\n        props.updateSticky(rec);\r\n        setOpen(false);\r\n    }\r\n\r\n    function handleArchive(id: string) {\r\n        props.archiveSticky(id);\r\n        setOpen(false);\r\n    }\r\n\r\n    function handleUnarchive(id: string) {\r\n        props.unarchiveSticky(id);\r\n        setOpen(false);\r\n    }\r\n\r\n    function handleDelete(id: string) {\r\n        props.deleteSticky(id);\r\n        setOpen(false);\r\n    }\r\n\r\n    function handleEditCancel() {\r\n        setOpen(false);\r\n    }\r\n\r\n    return (\r\n        <>\r\n            {/* eslint-disable-next-line jsx-a11y/anchor-is-valid */}\r\n            <a\r\n                id={gensym()}\r\n                data-record-id={props.record._id || ''}\r\n                className=\"KanbanBoardView-sticky-link\"\r\n                draggable\r\n                onClick={ev => setOpen(true)}\r\n                onDragStart={handleOnDragStart}>\r\n                <div\r\n                    className={'KanbanBoardView-sticky-note' + (expired ? ' expired' : '')} >\r\n                    {props.board.displayTags && props.record.tags.length ?\r\n                        <ul className=\"KanbanBoardView-sticky-tags\">{\r\n                            props.record.tags.map((x, index) => {\r\n                                const tags = props.board.tags || [];\r\n                                const matched = tags.find(q => q.value === x);\r\n                                return (\r\n                                    <li key={props.record._id + '-tag-' + index}\r\n                                        className={matched ? matched.className : ''}>{x}</li>\r\n                                );\r\n                            })\r\n                        }</ul> :\r\n                        <></>\r\n                    }\r\n                    <div\r\n                        className=\"KanbanBoardView-sticky-description\"\r\n                        dangerouslySetInnerHTML={{__html: DOMPurify.sanitize(marked(props.record.description))}} />\r\n                    {props.board.displayBarcode && props.record.barcode ?\r\n                        <div className=\"KanbanBoardView-sticky-barcode\"\r\n                            dangerouslySetInnerHTML={{__html: new Qr({\r\n                            fill: true,\r\n                            fillColor: isDark ? '#fff' : '#000',\r\n                            cellSize: 2,\r\n                            unit: 'px',\r\n                            data: props.record.barcode,\r\n                        }).toImgTag()}} />\r\n                        : <></>\r\n                    }\r\n                    {props.record.flags.includes('Marked') ?\r\n                        <div className=\"marked\">{''}</div> :\r\n                        <></>\r\n                    }\r\n                    {props.record.dueDate ?\r\n                        <div className=\"due-date\">{(expired ? '' : '' ) + props.record.dueDate}</div> :\r\n                        <></>\r\n                    }\r\n                </div>\r\n            </a>\r\n            {open ?\r\n                <KanbanDialog\r\n                    open={true}\r\n                    record={props.record}\r\n                    teamOrStories={props.teamOrStories}\r\n                    taskStatuses={props.taskStatuses}\r\n                    board={props.board}\r\n                    onApply={handleEditApply}\r\n                    onArchive={handleArchive}\r\n                    onUnarchive={handleUnarchive}\r\n                    onDelete={handleDelete}\r\n                    onCancel={handleEditCancel} /> : <></>\r\n            }\r\n        </>\r\n    );\r\n}\r\nconst Sticky = connect(mapNeverStateToProps, mapDispatchToProps)(Sticky_);\r\n\r\n\r\nconst Stickys_: React.FC<StickysProps> = (props) => {\r\n    function handleOnDragOver(ev: React.DragEvent) {\r\n        ev.preventDefault();\r\n    }\r\n\r\n    function handleOnDrop(ev: React.DragEvent) {\r\n        try {\r\n            const elId = ev.dataTransfer.getData('elId');\r\n            const el = document.getElementById(elId);\r\n            props.updateStickyLanes({\r\n                kanbanId: (el as any).dataset.recordId,\r\n                taskStatusValue: props.taskStatus.value,\r\n                teamOrStoryValue: props.teamOrStory.value,\r\n            })\r\n        } catch (e) {\r\n            alert(e.message);\r\n        }\r\n        ev.preventDefault();\r\n    }\r\n\r\n    const filtered = props.records.filter(x => !x.flags || !x.flags.includes('Archived'));\r\n\r\n    return (\r\n        <div\r\n            className={\r\n                'KanbanBoardView-sticky-wrap ' + \r\n                (props.teamOrStory.className || '') + ' ' +\r\n                (props.taskStatus.className || '')}\r\n            data-status={props.taskStatus.value}\r\n            data-team-or-story={props.teamOrStory.value}\r\n            onDragOver={handleOnDragOver}\r\n            onDrop={handleOnDrop}\r\n            >\r\n            {filtered.map(record => (\r\n                <Sticky\r\n                    key={record._id || gensym()}\r\n                    teamOrStory={props.teamOrStory}\r\n                    taskStatus={props.taskStatus}\r\n                    teamOrStories={props.teamOrStories}\r\n                    taskStatuses={props.taskStatuses}\r\n                    board={props.board}\r\n                    record={record}/>\r\n            ))}\r\n            {(firefox && filtered.length === 0) ?\r\n                // NOTE: hack for the height of div becomes 0 in Firefox\r\n                <div style={{width: '100%', height: '100%'}}>&nbsp;</div> :\r\n                <></>\r\n            }\r\n        </div>\r\n    );\r\n}\r\nconst Stickys = connect(mapNeverStateToProps, mapDispatchToProps)(Stickys_);\r\n\r\n\r\nconst KanbanBoardView: React.FC<KanbanBoardViewProps> = (props) => {\r\n    const classes = useStyles();\r\n    const theme = useTheme();\r\n    const [textInputOpen, setTextInputOpen] = React.useState({\r\n        open: false,\r\n        title: '',\r\n        message: '',\r\n        fieldLabel: '',\r\n        value: '',\r\n        validator: (value: string) => value.trim().length <= 0,\r\n        onClose: handleCloseDialogEditBoardName,\r\n    });\r\n\r\n    function handleClickEditBoardName() {\r\n        const currentState = getConstructedAppStore().getState();\r\n        setTextInputOpen(Object.assign({}, textInputOpen, {\r\n            open: true,\r\n            title: 'Edit board name',\r\n            message: '',\r\n            fieldLabel: 'Board name',\r\n            value: currentState.kanbanBoard.activeBoard.name,\r\n        }));\r\n    }\r\n\r\n    function handleCloseDialogEditBoardName(apply: boolean, value?: string) {\r\n        setTextInputOpen(Object.assign({}, textInputOpen, { open: false }));\r\n        if (apply && value) {\r\n            const currentState = getConstructedAppStore().getState();\r\n            props.updateBoardName({ boardId: currentState.kanbanBoard.activeBoardId, boardName: value });\r\n        }\r\n    }\r\n\r\n    if (props.match.params.id) {\r\n        if (props.activeBoard._id !== props.match.params.id) {\r\n            const index = props.boards.findIndex(x => x._id === props.match.params.id);\r\n            props.changeActiveBoard(props.match.params.id);\r\n            return (\r\n                <div className=\"KanbanBoardView-content\">\r\n                    {index < 0 ?\r\n                        <>\r\n                            <Typography\r\n                                style={{marginTop: theme.spacing(10)}}\r\n                                variant=\"h4\" align=\"center\">\r\n                                No boards found.\r\n                            </Typography>\r\n                            <Typography\r\n                                style={{marginTop: theme.spacing(5), cursor: 'pointer', textDecoration: 'underline'}}\r\n                                variant=\"body1\" align=\"center\"\r\n                                onClick={ev => {props.history.push('/')}} >\r\n                                Click here to show main board.\r\n                            </Typography>\r\n                        </> :\r\n                        <></>\r\n                    }\r\n                </div>\r\n            );\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className=\"KanbanBoardView-content\">\r\n            <style dangerouslySetInnerHTML={{__html: props.activeBoard.boardStyle}}></style>\r\n            <Typography\r\n                variant=\"h6\" align=\"center\" style={{cursor: 'pointer'}}\r\n                onClick={handleClickEditBoardName} >{props.activeBoard.name}</Typography>\r\n            <table className=\"KanbanBoardView-board\">\r\n                <thead>\r\n                    <tr>\r\n                        <th className=\"KanbanBoardView-header-cell-add-sticky\">\r\n                            <IconButton style={{margin: 0, padding: 0}}\r\n                                        onClick={ev => props.addSticky()}>\r\n                                <AddBoxIcon className={clsx(classes.smallIcon)} />\r\n                            </IconButton>\r\n                        </th>\r\n                        {props.activeBoard.taskStatuses.map(taskStatus => (\r\n                            <th key={taskStatus.value}\r\n                                className={\r\n                                    'KanbanBoardView-header-cell-task-statuses ' +\r\n                                    (taskStatus.className || '')}>\r\n                                {taskStatus.caption || taskStatus.value}\r\n                            </th>\r\n                        ))}\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    {props.activeBoard.teamOrStories.map(teamOrStory => (\r\n                        <tr key={teamOrStory.value}>\r\n                            <th className={\r\n                                'KanbanBoardView-header-cell-team-or-stories ' +\r\n                                (teamOrStory.className || '')}>\r\n                                {teamOrStory.caption || teamOrStory.value}\r\n                            </th>\r\n                            {props.activeBoard.taskStatuses.map(taskStatus => (\r\n                                <td key={taskStatus.value}\r\n                                    className={\r\n                                        (teamOrStory.className || '') + ' ' +\r\n                                        (taskStatus.className || '')}>\r\n                                    <Stickys\r\n                                        teamOrStory={teamOrStory}\r\n                                        taskStatus={taskStatus}\r\n                                        teamOrStories={props.activeBoard.teamOrStories}\r\n                                        taskStatuses={props.activeBoard.taskStatuses}\r\n                                        board={props.activeBoard}\r\n                                        records={props.activeBoard.records.filter(\r\n                                            x => x.teamOrStory === teamOrStory.value &&\r\n                                                 x.taskStatus  === taskStatus.value)} />\r\n                                </td>\r\n                            ))}\r\n                        </tr>\r\n                    ))}\r\n                </tbody>\r\n            </table>\r\n            {props.activeBoard.boardNote ?\r\n                <div className=\"KanbanBoardView-board-note-wrap\">\r\n                    <div className=\"KanbanBoardView-board-note\"\r\n                        dangerouslySetInnerHTML={{__html : DOMPurify.sanitize(marked(props.activeBoard.boardNote))}} />\r\n                </div> :\r\n                <></>\r\n            }\r\n            {textInputOpen.open ?\r\n                <TextInputDialog\r\n                    open={true}\r\n                    title={textInputOpen.title}\r\n                    message={textInputOpen.message}\r\n                    fieldLabel={textInputOpen.fieldLabel}\r\n                    value={textInputOpen.value}\r\n                    validator={textInputOpen.validator}\r\n                    onClose={textInputOpen.onClose} /> :\r\n                <></>\r\n            }\r\n        </div>\r\n    );\r\n}\r\nexport default connect(mapStateToProps, mapDispatchToProps)(KanbanBoardView);\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport { Action }             from 'typescript-fsa';\r\nimport { Dispatch }           from 'redux';\r\nimport { KanbanRecord,\r\n         ConfirmDialogProps,\r\n         AppState }           from '../types';\r\nimport { AppEventsActions as AppEventsActions_,\r\n         appEventsActions }   from '../actions/AppEventsActions';\r\nimport { CalendarActions as CalendarActions_,\r\n         calendarActions }    from '../actions/CalendarActions';\r\nimport { KanbanBoardActions as KanbanBoardActions_,\r\n         kanbanBoardActions } from '../actions/KanbanBoardActions';\r\n\r\n\r\n\r\nexport type AppEventsActions = AppEventsActions_;\r\nexport type CalendarActions = CalendarActions_;\r\nexport type KanbanBoardActions = KanbanBoardActions_;\r\n\r\n\r\nexport function mapDispatchToProps(dispatch: Dispatch<Action<any>>) {\r\n    return {\r\n        showToday: () =>\r\n            dispatch(calendarActions.showToday()),\r\n        showNextMonth: () =>\r\n            dispatch(calendarActions.showNextMonth()),\r\n        showPreviousMonth: () =>\r\n            dispatch(calendarActions.showPreviousMonth()),\r\n        showNextYear: () =>\r\n            dispatch(calendarActions.showNextYear()),\r\n        showPreviousYear: () =>\r\n            dispatch(calendarActions.showPreviousYear()),\r\n\r\n        // from AppEventsActions\r\n        showAlertDialog: (v: ConfirmDialogProps) =>\r\n            dispatch(appEventsActions.showAlertDialog(v)),\r\n        closeAlertDialog: () =>\r\n            dispatch(appEventsActions.closeAlertDialog()),\r\n\r\n        // from KanbanBoardActions\r\n        changeActiveBoard: (boardId: string) =>\r\n            dispatch(kanbanBoardActions.startChangeActiveBoard(Object.assign({}, { boardId }, { dispatch }))),\r\n        updateBoardName: (v: {boardId: string, boardName: string}) =>\r\n            dispatch(kanbanBoardActions.startUpdateBoardName(v)),\r\n        updateSticky: (v: KanbanRecord) =>\r\n            dispatch(kanbanBoardActions.startUpdateSticky(Object.assign({}, v, { dispatch }))),\r\n        archiveSticky: (kanbanId: string) =>\r\n            dispatch(kanbanBoardActions.startArchiveSticky({ kanbanId })),\r\n        unarchiveSticky: (kanbanId: string) =>\r\n            dispatch(kanbanBoardActions.startUnarchiveSticky({ kanbanId })),\r\n        deleteSticky: (kanbanId: string) =>\r\n            dispatch(kanbanBoardActions.startDeleteSticky(Object.assign({}, { kanbanId }, { dispatch }))),\r\n    }\r\n}\r\n\r\n\r\nexport function mapStateToProps(appState: AppState) {\r\n    return Object.assign({}, { kanbanBoardState: appState.kanbanBoard }, appState.calendar);\r\n}\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport React                      from 'react';\r\nimport { connect }                from 'react-redux';\r\nimport { RouteComponentProps }    from 'react-router-dom';\r\nimport { makeStyles,\r\n         useTheme }               from '@material-ui/core/styles';\r\nimport Typography                 from '@material-ui/core/Typography';\r\nimport IconButton                 from '@material-ui/core/IconButton';\r\nimport ChevronLeftIcon            from '@material-ui/icons/ChevronLeft';\r\nimport ChevronRightIcon           from '@material-ui/icons/ChevronRight';\r\nimport SkipPreviousIcon           from '@material-ui/icons/SkipPrevious';\r\nimport SkipNextIcon               from '@material-ui/icons/SkipNext';\r\nimport CalendarTodayIcon          from '@material-ui/icons/CalendarToday';\r\nimport clsx                       from 'clsx';\r\nimport { KanbanRecord,\r\n         CalendarState,\r\n         KanbanBoardState, \r\n         KanbanBoardRecord }      from '../types';\r\nimport { parseISODate }           from '../lib/datetime';\r\nimport { mapDispatchToProps,\r\n         mapStateToProps,\r\n         CalendarActions }        from '../dispatchers/CalendarViewDispatcher';\r\nimport KanbanDialog               from '../components/KanbanDialog';\r\nimport TextInputDialog            from '../components/TextInputDialog';\r\nimport { getConstructedAppStore } from '../store';\r\nimport                                 './CalendarView.css';\r\n\r\n\r\n\r\ntype CalendarItemProps = CalendarState & CalendarActions &\r\n        { kanbanBoardState: KanbanBoardState } & {\r\n    board: KanbanBoardRecord,\r\n    record: KanbanRecord,\r\n};\r\n\r\n\r\ntype CalendarViewProps = CalendarState & CalendarActions &\r\n        { kanbanBoardState: KanbanBoardState } & RouteComponentProps<{id: string}> & {\r\n};\r\n\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    root: {\r\n        flexGrow: 1,\r\n        color: 'var(--main-text-color)',\r\n        backgroundColor: 'var(--main-bg-color)',\r\n    },\r\n    calendar: {\r\n        width: 'calc(100% - 30px)',\r\n        height: '100%',\r\n        margin: '15px',\r\n        border: 'solid 1px var(--main-text-color)',\r\n        borderCollapse: 'collapse',\r\n        tableLayout: 'fixed',\r\n    },\r\n    calendarTitle: {\r\n        position: 'relative',\r\n        height: '30px',\r\n    },\r\n    calendarTitleToolBar: {\r\n        position: 'absolute',\r\n        top: 0,\r\n        left: 0,\r\n        margin: '3px 3px 6px 4px',\r\n        overflow: 'hidden',\r\n        width: 'calc(100% - 30px)',\r\n        height: '39px',\r\n    },\r\n    calendarTopLeftHeader: {\r\n        border: 'solid 1px var(--main-text-color)',\r\n        borderCollapse: 'collapse',\r\n        padding: '5px',\r\n    },\r\n    calendarDaysHeader: {\r\n        border: 'solid 1px var(--main-text-color)',\r\n        borderCollapse: 'collapse',\r\n        padding: '5px',\r\n        width: '14%',\r\n    },\r\n    calendarSundayHeader: {\r\n        border: 'solid 1px var(--main-text-color)',\r\n        borderCollapse: 'collapse',\r\n        padding: '5px',\r\n        width: '14%',\r\n        backgroundColor: 'var(--weak-header-bg-color)',\r\n        color: 'var(--calendar-sunday-color)',\r\n    },\r\n    calendarSaturdayHeader: {\r\n        border: 'solid 1px var(--main-text-color)',\r\n        borderCollapse: 'collapse',\r\n        padding: '5px',\r\n        width: '14%',\r\n        backgroundColor: 'var(--weak-header-bg-color)',\r\n        color: 'var(--calendar-saturday-color)',\r\n    },\r\n    calendarCell: {\r\n        border: 'solid 1px var(--main-text-color)',\r\n        borderCollapse: 'collapse',\r\n        padding: '5px',\r\n        verticalAlign: 'top',\r\n    },\r\n    calendarWeekendCell: {\r\n        border: 'solid 1px var(--main-text-color)',\r\n        borderCollapse: 'collapse',\r\n        padding: '5px',\r\n        verticalAlign: 'top',\r\n        backgroundColor: 'var(--weak-data-bg-color)',\r\n    },\r\n    calendarCellCaptionToday: {\r\n        color: 'var(--calendar-today-color)',\r\n        backgroundColor: 'var(--calendar-today-bg-color)',\r\n        borderRadius: '10px',\r\n        border: 'solid 1.5px var(--calendar-today-bg-color)',\r\n    },\r\n    chip: {\r\n        fontSize: 'smaller',\r\n        borderRadius: '5px',\r\n        backgroundColor:'var(--sticky-blue-color)',\r\n        color: 'var(--main-text-color)',\r\n        width: '100%',\r\n        overflow: 'hidden',\r\n        whiteSpace: 'nowrap',\r\n        textOverflow: 'ellipsis',\r\n        marginBottom: '2px',\r\n        paddingLeft: '3px',\r\n        paddingRight: '3px',\r\n    },\r\n    chipWrap: {\r\n        '&:hover': {\r\n            cursor: 'pointer',\r\n        }\r\n    }\r\n}));\r\n\r\n\r\nconst CalendarItem_: React.FC<CalendarItemProps> = (props) => {\r\n    const classes = useStyles();\r\n    const [open, setOpen] = React.useState(false);\r\n\r\n    const teamOrStory = props.board.teamOrStories.find(x => x.value === props.record.teamOrStory);\r\n    const taskStatus = props.board.taskStatuses.find(x => x.value === props.record.taskStatus);\r\n\r\n    const now = new Date();\r\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n    const dueDate = props.record.dueDate ? parseISODate(props.record.dueDate) : null;\r\n    const expired = (! (taskStatus && taskStatus.completed)) &&\r\n        (dueDate ? dueDate < today : false);\r\n    const archived = props.record.flags && props.record.flags.includes('Archived');\r\n\r\n    function handleEditApply(rec: KanbanRecord) {\r\n        props.updateSticky(rec);\r\n        setOpen(false);\r\n    }\r\n\r\n    function handleArchive(id: string) {\r\n        props.archiveSticky(id);\r\n        setOpen(false);\r\n    }\r\n\r\n    function handleUnarchive(id: string) {\r\n        props.unarchiveSticky(id);\r\n        setOpen(false);\r\n    }\r\n\r\n    function handleDelete(id: string) {\r\n        props.deleteSticky(id);\r\n        setOpen(false);\r\n    }\r\n\r\n    function handleEditCancel() {\r\n        setOpen(false);\r\n    }\r\n\r\n    return (\r\n        <>\r\n            {/* eslint-disable-next-line jsx-a11y/anchor-is-valid */}\r\n            <a\r\n                className={clsx(classes.chipWrap)}\r\n                onClick={ev => setOpen(true)}>\r\n                <div className={clsx(classes.chip) + ' CalendarView-item-chip' +\r\n                    (teamOrStory ? ' ' + teamOrStory.className : '') +\r\n                    (taskStatus ? ' ' + taskStatus.className : '') +\r\n                    (expired ? ' expired' : '') +\r\n                    (archived ? ' archived' : '')}>\r\n                    {props.record.description.trim().replace(/\\n/g, ' ').replace(/#+/g, '').trim()}\r\n                </div>\r\n            </a>\r\n            {open ?\r\n                <KanbanDialog\r\n                    open={true}\r\n                    record={props.record}\r\n                    teamOrStories={props.kanbanBoardState.activeBoard.teamOrStories}\r\n                    taskStatuses={props.kanbanBoardState.activeBoard.taskStatuses}\r\n                    board={props.board}\r\n                    onApply={handleEditApply}\r\n                    onArchive={handleArchive}\r\n                    onUnarchive={handleUnarchive}\r\n                    onDelete={handleDelete}\r\n                    onCancel={handleEditCancel} /> : <></>\r\n            }\r\n        </>\r\n    );\r\n}\r\nconst CalendarItem = connect(mapStateToProps, mapDispatchToProps)(CalendarItem_);\r\n\r\nconst CalendarView: React.FC<CalendarViewProps> = (props) => {\r\n    const classes = useStyles();\r\n    const theme = useTheme();\r\n    const [textInputOpen, setTextInputOpen] = React.useState({\r\n        open: false,\r\n        title: '',\r\n        message: '',\r\n        fieldLabel: '',\r\n        value: '',\r\n        validator: (value: string) => value.trim().length <= 0,\r\n        onClose: handleCloseDialogEditBoardName,\r\n    });\r\n\r\n    function handleClickEditBoardName() {\r\n        const currentState = getConstructedAppStore().getState();\r\n        setTextInputOpen(Object.assign({}, textInputOpen, {\r\n            open: true,\r\n            title: 'Edit board name',\r\n            message: '',\r\n            fieldLabel: 'Board name',\r\n            value: currentState.kanbanBoard.activeBoard.name,\r\n        }));\r\n    }\r\n\r\n    function handleCloseDialogEditBoardName(apply: boolean, value?: string) {\r\n        setTextInputOpen(Object.assign({}, textInputOpen, { open: false }));\r\n        if (apply && value) {\r\n            const currentState = getConstructedAppStore().getState();\r\n            props.updateBoardName({ boardId: currentState.kanbanBoard.activeBoardId, boardName: value });\r\n        }\r\n    }\r\n\r\n    if (props.match.params.id) {\r\n        if (props.kanbanBoardState.activeBoard._id !== props.match.params.id) {\r\n            const index = props.kanbanBoardState.boards.findIndex(x => x._id === props.match.params.id);\r\n            props.changeActiveBoard(props.match.params.id);\r\n            return (\r\n                <div className={classes.root}>\r\n                    {index < 0 ?\r\n                        <>\r\n                            <Typography\r\n                                style={{marginTop: theme.spacing(10)}}\r\n                                variant=\"h4\" align=\"center\">\r\n                                No boards found.\r\n                            </Typography>\r\n                            <Typography\r\n                                style={{marginTop: theme.spacing(5), cursor: 'pointer', textDecoration: 'underline'}}\r\n                                variant=\"body1\" align=\"center\"\r\n                                onClick={ev => {props.history.push('/')}} >\r\n                                Click here to show main board.\r\n                            </Typography>\r\n                        </> :\r\n                        <></>\r\n                    }\r\n                </div>\r\n            );\r\n        }\r\n    }\r\n\r\n    const now = new Date();\r\n    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\r\n\r\n    const month = props.activeMonth;\r\n\r\n    const firstDateOfMonth = new Date(month.getFullYear(), month.getMonth(), 1);\r\n    const lastDateOfMonth = new Date(month.getFullYear(), month.getMonth() + 1, 0);\r\n    const firstDateOfCal = new Date(\r\n        firstDateOfMonth.getFullYear(), firstDateOfMonth.getMonth(),\r\n        1 - firstDateOfMonth.getDay());\r\n    const lastDateOfCal = new Date(\r\n        lastDateOfMonth.getFullYear(), lastDateOfMonth.getMonth(),\r\n        lastDateOfMonth.getDate() + (6 - lastDateOfMonth.getDay()));\r\n    const nextCalDate = new Date(\r\n        lastDateOfCal.getFullYear(), lastDateOfCal.getMonth(),\r\n        lastDateOfCal.getDate() + 1);\r\n\r\n    const dates: Array<Date[]> = [];\r\n    let week: Date[] = [];\r\n    dates.push(week);\r\n    for (let wd = firstDateOfCal;\r\n            wd.getTime() <= lastDateOfCal.getTime();\r\n            wd = new Date(wd.getFullYear(), wd.getMonth(), wd.getDate() + 1)) {\r\n        if (7 <= week.length) {\r\n            week = [];\r\n            dates.push(week);\r\n        }\r\n        week.push(wd);\r\n    }\r\n\r\n    const stickys = props.kanbanBoardState.activeBoard.records.filter(x => {\r\n        if (!x.dueDate) {\r\n            return false;\r\n        }\r\n        const d = new Date(x.dueDate);\r\n        if (firstDateOfCal <= d && d < nextCalDate) {\r\n            return true;\r\n        } else {\r\n            return false;\r\n        }\r\n    });\r\n\r\n    return (\r\n        <div className={clsx(classes.root)}>\r\n            <style dangerouslySetInnerHTML={{__html: props.kanbanBoardState.activeBoard.calendarStyle}}></style>\r\n            <div className={clsx(classes.calendarTitle)}>\r\n                <div className={clsx(classes.calendarTitleToolBar)}>\r\n                    <IconButton onClick={ev => props.showToday()}>\r\n                        <CalendarTodayIcon /><Typography variant=\"caption\" style={{marginLeft: '1em'}}>Today</Typography>\r\n                    </IconButton>\r\n                    <IconButton onClick={ev => props.showPreviousYear()}>\r\n                        <SkipPreviousIcon />\r\n                    </IconButton>\r\n                    <IconButton onClick={ev => props.showPreviousMonth()}>\r\n                        <ChevronLeftIcon />\r\n                    </IconButton>\r\n                    <IconButton onClick={ev => props.showNextMonth()}>\r\n                        <ChevronRightIcon />\r\n                    </IconButton>\r\n                    <IconButton onClick={ev => props.showNextYear()}>\r\n                        <SkipNextIcon />\r\n                    </IconButton>\r\n                    <Typography variant=\"h6\" display=\"inline\" style={{marginLeft: '2em'}}>{\r\n                        props.activeMonth.toLocaleDateString(\r\n                            (navigator as any).userLanguage || navigator.language || (navigator as any).browserLanguage || 'en',\r\n                            {year: 'numeric', month: 'long'})\r\n                    }</Typography>\r\n                    <Typography variant=\"h6\" display=\"inline\" style={{marginLeft: '3em', cursor: 'pointer'}}\r\n                        onClick={handleClickEditBoardName} >{\r\n                        props.kanbanBoardState.activeBoard.name}</Typography>\r\n                </div>\r\n            </div>\r\n            <table className={clsx(classes.calendar)}>\r\n                <thead>\r\n                    <tr>\r\n                        <th className={clsx(classes.calendarTopLeftHeader)}></th>\r\n                        <th className={clsx(classes.calendarSundayHeader)}>Sun</th>\r\n                        <th className={clsx(classes.calendarDaysHeader)}>Mon</th>\r\n                        <th className={clsx(classes.calendarDaysHeader)}>Tue</th>\r\n                        <th className={clsx(classes.calendarDaysHeader)}>Wed</th>\r\n                        <th className={clsx(classes.calendarDaysHeader)}>Thu</th>\r\n                        <th className={clsx(classes.calendarDaysHeader)}>Fri</th>\r\n                        <th className={clsx(classes.calendarSaturdayHeader)}>Sat</th>\r\n                    </tr>\r\n                </thead>\r\n                <tbody>\r\n                    {dates.map(week =>\r\n                        <tr key={week[0].getTime()}>\r\n                            <td className={clsx(classes.calendarCell)}></td>\r\n                            {week.map((wd: Date, index: number) => {\r\n                                const next = new Date(wd.getFullYear(), wd.getMonth(), wd.getDate() + 1);\r\n                                return (\r\n                                    <td key={wd.toISOString()}\r\n                                        className={clsx(index === 0 || index === 6 ? classes.calendarWeekendCell :classes.calendarCell)}>\r\n                                        <div style={{position: 'relative'}}>\r\n                                            <div\r\n                                                className={wd <= today && today < next ? clsx(classes.calendarCellCaptionToday) : ''}\r\n                                                style={{position: 'absolute', top: '0', right: '0'}}>\r\n                                                {wd.getDate()}\r\n                                            </div>\r\n                                            <div style={{paddingTop: '20px', minHeight: '80px'}}>\r\n                                                {stickys.filter(x => {\r\n                                                    const d = new Date(x.dueDate);\r\n                                                    if (wd <= d && d < next) {\r\n                                                        return true;\r\n                                                    } else {\r\n                                                        return false;\r\n                                                    }\r\n                                                }).map(x =>\r\n                                                    <CalendarItem\r\n                                                        board={props.kanbanBoardState.activeBoard}\r\n                                                        key={x._id}\r\n                                                        record={x} />\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    </td>\r\n                                );\r\n                            })}\r\n                        </tr>\r\n                    )}\r\n                </tbody>\r\n            </table>\r\n            {textInputOpen.open ?\r\n                <TextInputDialog\r\n                    open={true}\r\n                    title={textInputOpen.title}\r\n                    message={textInputOpen.message}\r\n                    fieldLabel={textInputOpen.fieldLabel}\r\n                    value={textInputOpen.value}\r\n                    validator={textInputOpen.validator}\r\n                    onClose={textInputOpen.onClose} /> :\r\n                <></>\r\n            }\r\n        </div>\r\n    );\r\n}\r\nexport default connect(mapStateToProps, mapDispatchToProps)(CalendarView);\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport {\r\n    KanbanBoardRecord,\r\n    KanbanRecord,\r\n    AppConfig\r\n} from '../types';\r\n\r\n\r\n\r\nexport function pickEditableStickyProps(sticky: KanbanRecord) {\r\n    return (Object.assign(sticky._id ? { _id: sticky._id } : {}, {\r\n        dueDate: sticky.dueDate || '',\r\n        taskStatus: sticky.taskStatus || '',\r\n        teamOrStory: sticky.teamOrStory || '',\r\n        flags: sticky.flags || [],\r\n        tags: sticky.tags || [],\r\n        description: sticky.description || '',\r\n        barcode: sticky.barcode || '',\r\n        memo: sticky.memo || '',\r\n    }));\r\n}\r\n\r\n\r\nexport function pickEditableBoardProps(board: KanbanBoardRecord) {\r\n    return ({\r\n        name: board.name || '',\r\n        taskStatuses: board.taskStatuses || [],\r\n        teamOrStories: board.teamOrStories || [],\r\n        tags: board.tags || [],\r\n        displayBarcode: !!board.displayBarcode,\r\n        displayMemo: !!board.displayMemo,\r\n        displayFlags: !!board.displayFlags,\r\n        displayTags: !!board.displayTags,\r\n        preferArchive: !!board.preferArchive,\r\n        boardStyle: board.boardStyle || '',\r\n        calendarStyle: board.calendarStyle || '',\r\n        boardNote: board.boardNote || '',\r\n        records: (board.records && board.records.map(x => pickEditableStickyProps(x))) || [],\r\n    });\r\n}\r\n\r\n\r\nexport function validateStickyProps(sticky: KanbanRecord) {\r\n    if (typeof sticky.dueDate !== 'string') {\r\n        throw new Error('string property \"dueDate\" is required.');\r\n    }\r\n    if (typeof sticky.taskStatus !== 'string') {\r\n        throw new Error('string property \"taskStatus\" is required.');\r\n    }\r\n    if (typeof sticky.teamOrStory !== 'string') {\r\n        throw new Error('string property \"teamOrStory\" is required.');\r\n    }\r\n    if (sticky.flags && Array.isArray(sticky.flags)) {\r\n        sticky.flags.forEach(x => {\r\n            if (typeof x !== 'string') {\r\n                throw new Error('property \"flags[x]\" should be string.');\r\n            }\r\n        });\r\n    } else {\r\n        throw new Error('array property \"flags\" is required.');\r\n    }\r\n    if (sticky.tags && Array.isArray(sticky.tags)) {\r\n        sticky.tags.forEach(x => {\r\n            if (typeof x !== 'string') {\r\n                throw new Error('property \"tags[x]\" should be string.');\r\n            }\r\n        });\r\n    } else {\r\n        throw new Error('array property \"tags\" is required.');\r\n    }\r\n    if (typeof sticky.description !== 'string') {\r\n        throw new Error('string property \"description\" is required.');\r\n    }\r\n    if (typeof sticky.barcode !== 'string') {\r\n        throw new Error('string property \"barcode\" is required.');\r\n    }\r\n    if (typeof sticky.memo !== 'string') {\r\n        throw new Error('string property \"memo\" is required.');\r\n    }\r\n    return sticky;\r\n}\r\n\r\n\r\nfunction checkStyleXSS(text: string) {\r\n    if (text.match(/<\\/style\\s*>/i) || text.match(/<script\\b/i)) {\r\n        throw new Error('bad style text is set.');\r\n    }\r\n}\r\n\r\n\r\nexport function validateBoardProps(board: KanbanBoardRecord) {\r\n    if (typeof board.name !== 'string') {\r\n        throw new Error('string property \"name\" is required.');\r\n    }\r\n    if (board.taskStatuses && Array.isArray(board.taskStatuses)) {\r\n        board.taskStatuses.forEach(x => {\r\n            if (x.caption !== null && x.caption !== void 0 && typeof x.caption !== 'string') {\r\n                throw new Error('property \"taskStatuses[x].caption\" should be string.');\r\n            }\r\n            if (x.className !== null && x.className !== void 0 && typeof x.className !== 'string') {\r\n                throw new Error('property \"taskStatuses[x].className\" should be string.');\r\n            }\r\n            if (x.completed !== null && x.completed !== void 0 && typeof x.completed !== 'boolean') {\r\n                throw new Error('property \"taskStatuses[x].completed\" should be boolean.');\r\n            }\r\n            if (typeof x.value !== 'string') {\r\n                throw new Error('string property \"taskStatuses[x].value\" is required.');\r\n            }\r\n        });\r\n    } else {\r\n        throw new Error('array property \"taskStatuses\" is required.');\r\n    }\r\n    if (board.teamOrStories && Array.isArray(board.teamOrStories)) {\r\n        board.teamOrStories.forEach(x => {\r\n            if (x.caption !== null && x.caption !== void 0 && typeof x.caption !== 'string') {\r\n                throw new Error('property \"teamOrStories[x].caption\" should be string.');\r\n            }\r\n            if (x.className !== null && x.className !== void 0 && typeof x.className !== 'string') {\r\n                throw new Error('property \"teamOrStories[x].className\" should be string.');\r\n            }\r\n            if (typeof x.value !== 'string') {\r\n                throw new Error('string property \"teamOrStories[x].value\" is required.');\r\n            }\r\n        });\r\n    } else {\r\n        throw new Error('array property \"teamOrStories\" is required.');\r\n    }\r\n    if (board.tags && Array.isArray(board.tags)) {\r\n        board.tags.forEach(x => {\r\n            if (x.className !== null && x.className !== void 0 && typeof x.className !== 'string') {\r\n                throw new Error('property \"tags[x].className\" should be string.');\r\n            }\r\n            if (typeof x.value !== 'string') {\r\n                throw new Error('string property \"tags[x].value\" is required.');\r\n            }\r\n        });\r\n    } else {\r\n        throw new Error('array property \"tags\" is required.');\r\n    }\r\n    if (typeof board.displayBarcode !== 'boolean') {\r\n        throw new Error('boolean property \"displayBarcode\" is required.');\r\n    }\r\n    if (typeof board.displayMemo !== 'boolean') {\r\n        throw new Error('boolean property \"displayMemo\" is required.');\r\n    }\r\n    if (typeof board.displayFlags !== 'boolean') {\r\n        throw new Error('boolean property \"displayFlags\" is required.');\r\n    }\r\n    if (typeof board.displayTags !== 'boolean') {\r\n        throw new Error('boolean property \"displayTags\" is required.');\r\n    }\r\n    if (typeof board.preferArchive !== 'boolean') {\r\n        throw new Error('boolean property \"preferArchive\" is required.');\r\n    }\r\n    if (typeof board.boardStyle !== 'string') {\r\n        throw new Error('string property \"boardStyle\" is required.');\r\n    }\r\n    checkStyleXSS(board.boardStyle);\r\n    if (typeof board.calendarStyle !== 'string') {\r\n        throw new Error('string property \"calendarStyle\" is required.');\r\n    }\r\n    checkStyleXSS(board.calendarStyle);\r\n    if (typeof board.boardNote !== 'string') {\r\n        throw new Error('string property \"boardNote\" is required.');\r\n    }\r\n\r\n    if (board.records && Array.isArray(board.records)) {\r\n        board.records.forEach(x => validateStickyProps(x));\r\n    } else {\r\n        throw new Error('array property \"records\" is required.');\r\n    }\r\n\r\n    return board;\r\n}\r\n\r\n\r\nexport function pickEditableConfigProps(conf: AppConfig) {\r\n    return ({\r\n        remote: {\r\n            endpointUrl: conf.remote && conf.remote.endpointUrl ?\r\n                conf.remote.endpointUrl : '',\r\n            user: conf.remote && conf.remote.user ?\r\n                conf.remote.user : '',\r\n            password: conf.remote && conf.remote.password ?\r\n                conf.remote.password : '',\r\n        },\r\n        display: {\r\n            autoUpdate: !!(conf.display && conf.display.autoUpdate),\r\n            autoUpdateInterval: conf.display && conf.display.autoUpdateInterval ?\r\n                conf.display.autoUpdateInterval : 10,\r\n            goAround: !!(conf.display && conf.display.goAround),\r\n        },\r\n    });\r\n}\r\n\r\n\r\nexport function validateConfigProps(conf: AppConfig) {\r\n    if (!conf.remote) {\r\n        throw new Error('object property \"remote\" is required.');\r\n    }\r\n    if (typeof conf.remote.endpointUrl !== 'string') {\r\n        throw new Error('string property \"remote.endpointUrl\" is required.');\r\n    }\r\n    if (typeof conf.remote.user !== 'string') {\r\n        throw new Error('string property \"remote.user\" is required.');\r\n    }\r\n    if (typeof conf.remote.password !== 'string') {\r\n        throw new Error('string property \"remote.password\" is required.');\r\n    }\r\n\r\n    if (!conf.display) {\r\n        throw new Error('object property \"display\" is required.');\r\n    }\r\n    if (typeof conf.display.autoUpdate !== 'boolean') {\r\n        throw new Error('boolean property \"display.autoUpdate\" is required.');\r\n    }\r\n    if (typeof conf.display.autoUpdateInterval !== 'number') {\r\n        throw new Error('number property \"display.autoUpdateInterval\" is required.');\r\n    }\r\n    if (conf.display.autoUpdateInterval < 10) {\r\n        throw new Error('number property \"display.autoUpdateInterval\" should 10 <= autoUpdateInterval (unit: sec).');\r\n    }\r\n    if (typeof conf.display.goAround !== 'boolean') {\r\n        throw new Error('boolean property \"display.goAround\" is required.');\r\n    }\r\n    return conf;\r\n}\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport React                          from 'react';\r\nimport { connect }                    from 'react-redux';\r\nimport { RouteComponentProps }        from 'react-router-dom';\r\nimport { makeStyles,\r\n         useTheme }                   from '@material-ui/core/styles';\r\nimport Button                         from '@material-ui/core/Button';\r\nimport CheckIcon                      from '@material-ui/icons/Check';\r\nimport DeleteIcon                     from '@material-ui/icons/Delete';\r\nimport Typography                     from '@material-ui/core/Typography';\r\nimport Fab                            from '@material-ui/core/Fab';\r\nimport clsx                           from 'clsx';\r\nimport { UnControlled as CodeMirror } from 'react-codemirror2';\r\nimport                                     'codemirror/lib/codemirror.css';\r\nimport                                     'codemirror/theme/material.css';\r\nimport                                     'codemirror/mode/yaml/yaml';\r\nimport jsYaml                         from 'js-yaml';\r\nimport { KanbanBoardState }           from '../types';\r\nimport { mapDispatchToProps,\r\n         mapStateToProps,\r\n         KanbanBoardActions }         from '../dispatchers/KanbanBoardDispatcher';\r\nimport ConfirmDialog                  from '../components/ConfirmDialog';\r\nimport { pickEditableBoardProps,\r\n         validateBoardProps }         from '../lib/validation';\r\nimport                                     './EditorView.css';\r\n\r\n\r\n\r\ntype EditorViewProps = KanbanBoardState & KanbanBoardActions & RouteComponentProps<{id: string}> & {\r\n};\r\n\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    root: {\r\n        flexGrow: 1,\r\n        color: 'var(--main-text-color)',\r\n        backgroundColor: 'var(--main-bg-color)',\r\n        width: '100%',\r\n        height: '100%',\r\n    },\r\n    header: {\r\n        height: '45px',\r\n        position: 'relative',\r\n    },\r\n    codemirror: {\r\n        display: 'grid',\r\n        width: 'calc(100% - 20px)',\r\n        height: 'calc(100vh - 65px)',\r\n    },\r\n    fabSave: {\r\n        position: 'absolute',\r\n        margin: theme.spacing(1),\r\n        left: theme.spacing(1),\r\n        top: theme.spacing(1) / 10,\r\n    },\r\n    fabDelete: {\r\n        position: 'absolute',\r\n        margin: theme.spacing(1),\r\n        right: theme.spacing(1),\r\n        top: theme.spacing(1) / 10,\r\n    },\r\n}));\r\n\r\n\r\nconst EditorView: React.FC<EditorViewProps> = (props) => {\r\n    const classes = useStyles();\r\n    const theme = useTheme();\r\n    const [confirmDeletingOpen, setConfirmDeletingOpen] = React.useState(false);\r\n    const [editorValue, setEditorValue] = React.useState('');\r\n    const [editCount, setEditCount] = React.useState(0);\r\n    // NOTE: codeMirror.current.props.value is NOT updated after onChange event.\r\n    // const codeMirror = useRef((null as any) as CodeMirror);\r\n\r\n    function handleSaveClick() {\r\n        try {\r\n            const data = jsYaml.safeLoad(editorValue);\r\n            if (data) {\r\n                validateBoardProps(data);\r\n                props.editBoardAndStickys(Object.assign({}, data, { _id: props.activeBoard._id }));\r\n            } else {\r\n                //\r\n            }\r\n        } catch (e) {\r\n            props.showAlertDialog({\r\n                open: true,\r\n                title: 'Error',\r\n                message: e.message || String(e),\r\n                singleButton: true,\r\n                colorIsSecondary: true,\r\n                onClose: () => props.closeAlertDialog(),\r\n            });\r\n        }\r\n    }\r\n\r\n    function handleConfirmDeleting(apply: boolean) {\r\n        setConfirmDeletingOpen(false);\r\n        if (apply) {\r\n            props.deleteBoard(props.activeBoard._id);\r\n        }\r\n    }\r\n\r\n    function handleEditorChange(editor: any, data: any, value: string) {\r\n        setEditorValue(value);\r\n        setEditCount(editCount + 1);\r\n    }\r\n\r\n    if (props.match.params.id) {\r\n        if (props.activeBoard._id !== props.match.params.id) {\r\n            const index = props.boards.findIndex(x => x._id === props.match.params.id);\r\n            props.changeActiveBoard(props.match.params.id);\r\n\r\n            // NOTE: dirty hack\r\n            setTimeout(() => {\r\n                setEditCount(0);\r\n            }, 30);\r\n\r\n            return (\r\n                <div className={classes.root}>\r\n                    {index < 0 ?\r\n                        <>\r\n                            <Typography\r\n                                style={{marginTop: theme.spacing(10)}}\r\n                                variant=\"h4\" align=\"center\">\r\n                                No boards found.\r\n                            </Typography>\r\n                            <Typography\r\n                                style={{marginTop: theme.spacing(5), cursor: 'pointer', textDecoration: 'underline'}}\r\n                                variant=\"body1\" align=\"center\"\r\n                                onClick={ev => {props.history.push('/')}} >\r\n                                Click here to show main board.\r\n                            </Typography>\r\n                        </> :\r\n                        <></>\r\n                    }\r\n                </div>\r\n            );\r\n        }\r\n    }\r\n\r\n    return (\r\n        <div className={clsx(classes.root)}>\r\n            <div className={clsx(classes.header)}>\r\n                <Typography variant=\"h6\" align=\"center\" style={{marginTop: '0px'}}>{props.activeBoard.name}</Typography>\r\n                <Button\r\n                    className={clsx(classes.fabSave)}\r\n                    variant=\"contained\"\r\n                    color=\"primary\"\r\n                    disabled={editCount === 0}\r\n                    onClick={handleSaveClick} >\r\n                    <CheckIcon />\r\n                    <Typography variant=\"body1\" style={{marginLeft: theme.spacing(1)}} >\r\n                        Save\r\n                    </Typography>\r\n                </Button>\r\n                {props.boards.length > 1 ?\r\n                    <Button\r\n                        className={clsx(classes.fabDelete)}\r\n                        variant=\"outlined\"\r\n                        color=\"secondary\"\r\n                        onClick={ev => setConfirmDeletingOpen(true)} >\r\n                        <DeleteIcon color=\"secondary\" />\r\n                        <Typography variant=\"body1\" color=\"secondary\" style={{marginLeft: theme.spacing(1)}} >\r\n                            Delete\r\n                        </Typography>\r\n                    </Button> :\r\n                    <></>\r\n                }\r\n            </div>\r\n            <div>\r\n                <CodeMirror\r\n                    className={clsx(classes.codemirror)}\r\n                    value={`# Board settings\\n\\n${\r\n                        jsYaml.safeDump(pickEditableBoardProps(props.activeBoard), {lineWidth: 1000})\r\n                    }`}\r\n                    options={{\r\n                        mode: 'yaml',\r\n                        theme: 'material',\r\n                        lineNumbers: true,\r\n                        lineWrapping: true,\r\n                    }}\r\n                    onChange={handleEditorChange}\r\n                />\r\n            </div>\r\n            {confirmDeletingOpen ?\r\n                <ConfirmDialog\r\n                    open={confirmDeletingOpen}\r\n                    title=\"Delete board\"\r\n                    message=\"Are you sure want to delete the board?\"\r\n                    colorIsSecondary={true}\r\n                    applyButtonCaption=\"Delete\"\r\n                    confirmingTextLabel={'Type \"Delete board\" to delete this board.'}\r\n                    confirmingTextValue=\"Delete board\"\r\n                    fab={\r\n                        <Fab size=\"large\" variant=\"round\" aria-label=\"delete\" color=\"secondary\" style={{margin: 'auto'}}>\r\n                            <DeleteIcon />\r\n                        </Fab>\r\n                    }\r\n                    onClose={handleConfirmDeleting} /> :\r\n                <></>\r\n            }\r\n        </div>\r\n    );\r\n}\r\nexport default connect(mapStateToProps, mapDispatchToProps)(EditorView);\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport React                          from 'react';\r\nimport { connect }                    from 'react-redux';\r\nimport { RouteComponentProps }        from 'react-router-dom';\r\nimport { makeStyles,\r\n         useTheme }                   from '@material-ui/core/styles';\r\nimport Button                         from '@material-ui/core/Button';\r\nimport CheckIcon                      from '@material-ui/icons/Check';\r\nimport DeleteIcon                     from '@material-ui/icons/Delete';\r\nimport Typography                     from '@material-ui/core/Typography';\r\nimport Fab                            from '@material-ui/core/Fab';\r\nimport clsx                           from 'clsx';\r\nimport { UnControlled as CodeMirror } from 'react-codemirror2';\r\nimport                                     'codemirror/lib/codemirror.css';\r\nimport                                     'codemirror/theme/material.css';\r\nimport                                     'codemirror/mode/yaml/yaml';\r\nimport jsYaml                         from 'js-yaml';\r\nimport { AppEventsState }             from '../types';\r\nimport { mapDispatchToProps,\r\n         mapStateToProps,\r\n         AppEventsActions }           from '../dispatchers/AppEventsDispatcher';\r\nimport ConfirmDialog                  from '../components/ConfirmDialog';\r\nimport { pickEditableConfigProps,\r\n         validateConfigProps }        from '../lib/validation';\r\nimport                                     './SettingsView.css';\r\n\r\n\r\n\r\ntype SettingsViewProps = AppEventsState & AppEventsActions & RouteComponentProps<{id: string}> & {\r\n};\r\n\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    root: {\r\n        flexGrow: 1,\r\n        color: 'var(--main-text-color)',\r\n        backgroundColor: 'var(--main-bg-color)',\r\n        width: '100%',\r\n        height: '100%',\r\n    },\r\n    header: {\r\n        height: '45px',\r\n        position: 'relative',\r\n    },\r\n    codemirror: {\r\n        display: 'grid',\r\n        width: 'calc(100% - 20px)',\r\n        height: 'calc(100vh - 65px)',\r\n    },\r\n    fabSave: {\r\n        position: 'absolute',\r\n        margin: theme.spacing(1),\r\n        left: theme.spacing(1),\r\n        top: theme.spacing(1) / 10,\r\n    },\r\n    fabDelete: {\r\n        position: 'absolute',\r\n        margin: theme.spacing(1),\r\n        right: theme.spacing(1),\r\n        top: theme.spacing(1) / 10,\r\n    },\r\n}));\r\n\r\n\r\nconst SettingsView: React.FC<SettingsViewProps> = (props) => {\r\n    const classes = useStyles();\r\n    const theme = useTheme();\r\n    const [confirmResetAppOpen, setConfirmResetAppOpen] = React.useState(false);\r\n    const [editorValue, setEditorValue] = React.useState('');\r\n    const [editCount, setEditCount] = React.useState(0);\r\n\r\n    function handleSaveClick() {\r\n        try {\r\n            const data = jsYaml.safeLoad(editorValue);\r\n            if (data) {\r\n                validateConfigProps(data);\r\n                props.updateAppConfig(Object.assign({}, data));\r\n            } else {\r\n                throw new Error('object property \"remote\" is required.');\r\n            }\r\n        } catch (e) {\r\n            props.showAlertDialog({\r\n                open: true,\r\n                title: 'Error',\r\n                message: e.message || String(e),\r\n                singleButton: true,\r\n                colorIsSecondary: true,\r\n                onClose: () => props.closeAlertDialog(),\r\n            });\r\n        }\r\n    }\r\n\r\n    function handleConfirmResetApplication(apply: boolean) {\r\n        setConfirmResetAppOpen(false);\r\n        if (apply) {\r\n            props.resetApplication();\r\n        }\r\n    }\r\n\r\n    function handleEditorChange(editor: any, data: any, value: string) {\r\n        setEditorValue(value);\r\n        setEditCount(editCount + 1);\r\n    }\r\n\r\n    return (\r\n        <div className={clsx(classes.root)}>\r\n            <div className={clsx(classes.header)}>\r\n                <Typography variant=\"h6\" align=\"center\" style={{marginTop: '0px'}}>{'Application Settings'}</Typography>\r\n                <Button\r\n                    className={clsx(classes.fabSave)}\r\n                    variant=\"contained\"\r\n                    color=\"primary\"\r\n                    disabled={editCount === 0}\r\n                    onClick={handleSaveClick} >\r\n                    <CheckIcon />\r\n                    <Typography variant=\"body1\" style={{marginLeft: theme.spacing(1)}} >\r\n                        Save\r\n                    </Typography>\r\n                </Button>\r\n                <Button\r\n                    className={clsx(classes.fabDelete)}\r\n                    variant=\"outlined\"\r\n                    color=\"secondary\"\r\n                    onClick={ev => setConfirmResetAppOpen(true)} >\r\n                    <DeleteIcon color=\"secondary\" />\r\n                    <Typography variant=\"body1\" color=\"secondary\" style={{marginLeft: theme.spacing(1)}} >\r\n                        Reset application\r\n                    </Typography>\r\n                </Button>\r\n            </div>\r\n            <div>\r\n                <CodeMirror\r\n                    className={clsx(classes.codemirror)}\r\n                    value={`# App settings\\n\\n${\r\n                        jsYaml.safeDump(pickEditableConfigProps(props.appConfig), {lineWidth: 1000})\r\n                    }`}\r\n                    options={{\r\n                        mode: 'yaml',\r\n                        theme: 'material',\r\n                        lineNumbers: true,\r\n                        lineWrapping: true,\r\n                    }}\r\n                    onChange={handleEditorChange}\r\n                />\r\n            </div>\r\n            {confirmResetAppOpen ?\r\n                <ConfirmDialog\r\n                    open={confirmResetAppOpen}\r\n                    title=\"Reset application\"\r\n                    message={'Are you sure want to reset application?\\nAll local data and configurations will be REMOVED!'}\r\n                    colorIsSecondary={true}\r\n                    applyButtonCaption=\"Reset\"\r\n                    confirmingTextLabel={'Type \"Reset application\" to remove all data.'}\r\n                    confirmingTextValue=\"Reset application\"\r\n                    fab={\r\n                        <Fab size=\"large\" variant=\"round\" aria-label=\"reset application\" color=\"secondary\" style={{margin: 'auto'}}>\r\n                            <DeleteIcon />\r\n                        </Fab>\r\n                    }\r\n                    onClose={handleConfirmResetApplication} /> :\r\n                <></>\r\n            }\r\n        </div>\r\n    );\r\n}\r\nexport default connect(mapStateToProps, mapDispatchToProps)(SettingsView);\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport React,\r\n{\r\n    useEffect,\r\n    useRef\r\n} from 'react';\r\nimport { connect } from 'react-redux';\r\nimport {\r\n    Route,\r\n    Switch\r\n} from \"react-router-dom\";\r\nimport CssBaseline from '@material-ui/core/CssBaseline';\r\nimport { makeStyles } from '@material-ui/core/styles';\r\nimport { ThemeProvider } from '@material-ui/styles';\r\nimport clsx from 'clsx';\r\nimport { AppEventsState } from './types';\r\nimport { restartSync } from './lib/db';\r\nimport { theme } from './lib/theme';\r\nimport { getCurrentView } from './lib/util';\r\nimport {\r\n    mapDispatchToProps,\r\n    mapStateToProps,\r\n    AppEventsActions\r\n} from './dispatchers/AppEventsDispatcher';\r\nimport {\r\n    getConstructedAppStore,\r\n    history\r\n} from './store';\r\nimport AppDrawer from './components/AppDrawer';\r\nimport KanbanBoardView from './views/KanbanBoardView';\r\nimport CalendarView from './views/CalendarView';\r\nimport EditorView from './views/EditorView';\r\nimport SettingsView from './views/SettingsView';\r\nimport ConfirmDialog from './components/ConfirmDialog';\r\n\r\n\r\n\r\ntype AppProps = AppEventsState & AppEventsActions;\r\n\r\n\r\nconst useStyles = makeStyles(theme => ({\r\n    app: {\r\n        display: 'flex',\r\n    },\r\n}));\r\n\r\n\r\n// https://overreacted.io/making-setinterval-declarative-with-react-hooks/\r\nfunction useInterval(callback: () => void, delay: number | null) {\r\n    const savedCallback = useRef() as React.MutableRefObject<any>;\r\n\r\n    // Remember the latest callback.\r\n    useEffect(() => {\r\n        savedCallback.current = callback;\r\n\r\n        /* eslint-disable-next-line react-hooks/exhaustive-deps */\r\n    }, [callback]);\r\n\r\n    // Set up the interval.\r\n    useEffect(() => {\r\n        function tick() {\r\n            savedCallback.current();\r\n        }\r\n        if (delay !== null) {\r\n            let id = setInterval(tick, delay);\r\n\r\n            // Clean up the timer when unmount or before re-calling.\r\n            return () => clearInterval(id);\r\n        }\r\n\r\n        /* eslint-disable-next-line react-hooks/exhaustive-deps */\r\n    }, [delay]);\r\n}\r\n\r\n\r\nconst App: React.FC<AppProps> = (props) => {\r\n    const classes = useStyles();\r\n\r\n    // Update periodic\r\n    useInterval(\r\n        () => {\r\n            if (props.appConfig) {\r\n                console.log('periodic timer:' + new Date());\r\n                restartSync()\r\n                    .then(() => {\r\n                        let goAround = false;\r\n                        let nextActiveBoardId = '';\r\n                        const store = getConstructedAppStore();\r\n                        if (store && props.appConfig.display) {\r\n                            const state = store.getState();\r\n                            if (props.appConfig.display.goAround && state.kanbanBoard.boards.length > 1) {\r\n                                const index = (Math.max(0, state.kanbanBoard.boards\r\n                                    .findIndex(x => x._id === state.kanbanBoard.activeBoardId)) + 1) %\r\n                                    state.kanbanBoard.boards.length;\r\n                                goAround = true;\r\n                                nextActiveBoardId = state.kanbanBoard.boards[index]._id;\r\n                            }\r\n                        }\r\n                        const viewName = getCurrentView(history);\r\n                        if (viewName !== 'config' && viewName !== 'edit') {\r\n                            if (goAround) {\r\n                                history.push(`/${viewName}/${nextActiveBoardId}`);\r\n                            } else {\r\n                                props.refreshActiveBoard();\r\n                            }\r\n                        }\r\n                    })\r\n                    .catch(err => {\r\n                        console.log(err.message);\r\n                    });\r\n            }\r\n        },\r\n        props.appConfig && props.appConfig.display &&\r\n            props.appConfig.display.autoUpdate ?\r\n            (props.appConfig.display.autoUpdateInterval || 20) * 1000 :\r\n            null\r\n    );\r\n\r\n    // Update only first time (apply synchronized data to renderer)\r\n    // NOTE: The first board displayed is not up-to-date with the remote database\r\n    useEffect(() => {\r\n        // run once\r\n        setTimeout(() => {\r\n            props.refreshActiveBoard();\r\n        }, 3000);\r\n\r\n        /* eslint-disable-next-line react-hooks/exhaustive-deps */\r\n    }, []);\r\n\r\n    return (\r\n        <div className={clsx(classes.app)}>\r\n            <CssBaseline />\r\n            <ThemeProvider theme={theme}>\r\n                <AppDrawer />\r\n                <Switch>\r\n                    <Route path=\"/\" exact component={KanbanBoardView} />\r\n                    <Route path=\"/kanban/:id?\" component={KanbanBoardView} />\r\n                    <Route path=\"/calendar/:id?\" component={CalendarView} />\r\n                    <Route path=\"/edit/:id?\" component={EditorView} />\r\n                    <Route path=\"/config/\" component={SettingsView} />\r\n                </Switch>\r\n                {props.alertDialog.open ?\r\n                    <ConfirmDialog {...props.alertDialog} /> :\r\n                    <></>\r\n                }\r\n            </ThemeProvider>\r\n        </div>\r\n    );\r\n}\r\nexport default connect(mapStateToProps, mapDispatchToProps)(App);\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(\r\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\r\n      window.location.href\r\n    );\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","// Copyright (c) 2019 Shellyl_N and Authors\r\n// license: ISC\r\n// https://github.com/shellyln\r\n\r\nimport React                    from 'react';\r\nimport ReactDOM                 from 'react-dom';\r\nimport { Provider }             from 'react-redux';\r\nimport { ConnectedRouter }      from 'connected-react-router'\r\nimport { getLocalDb }           from './lib/db'\r\nimport                               './index.css';\r\nimport App                      from './App';\r\nimport * as serviceWorker       from './serviceWorker';\r\nimport getAppStore,\r\n       { history }              from './store';\r\n\r\n\r\n\r\n(async () => {\r\n    getLocalDb();\r\n\r\n    ReactDOM.render(\r\n        <Provider store={await getAppStore()}>\r\n            <ConnectedRouter history={history}>\r\n                <App />\r\n            </ConnectedRouter>\r\n        </Provider>,\r\n        document.getElementById('root'));\r\n\r\n})();\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\n\r\n// serviceWorker.unregister();\r\nserviceWorker.register();\r\n"],"sourceRoot":""}